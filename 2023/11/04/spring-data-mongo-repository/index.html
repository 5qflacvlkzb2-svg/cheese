
<!DOCTYPE html>
<html lang="ko">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Yun Blog">
    <title>Spring Data MongoDB Repository 확장 - Yun Blog</title>
    <meta name="author" content="Yun">
    
        <meta name="keywords" content="Node,Spring,Spring Boot,Spring Batch,Kotlin,기술 블로그,JPA,Mongo,MySQL,OOP,">
    
    
    
        
            <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss2.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg"},"articleBody":"Spring Data JPA에서 흔히 사용하는 Repository 확장 패턴을 Spring Data MongoDB에도 적용할 수 있습니다. 이 패턴은 ‘CustomRepository’와 ‘CustomRepositoryImpl’의 조합으로 구성되며, Spring-JPA Best Practices step-15에서 이전에 포스팅한적 있습니다. 이 방법을 사용하면 복잡한 조회 작업을 ‘CustomRepositoryImpl’에서 처리할 수 있게 됩니다. 이 구조를 사용하면, 사용자는 Repository 인터페이스만을 이용하여 데이터를 조회할 수 있게 되어 코드의 간결성과 유지보수성이 향상됩니다. 예를 들어, CustomRepositoryImpl에서 복잡한 쿼리 로직을 구현하면, 상위 레벨에서는 이러한 구현 디테일을 신경 쓰지 않고 데이터 접근 로직을 단순화할 수 있습니다. Spring Data MongoDB에서 동일하게 적용하는 방법을 살펴보겠습니다.\nCustom RepositoryCustom Repository 구성1234567891011121314@Document(collection = &quot;members&quot;)class Member(    @Field(name = &quot;name&quot;)    val name: String,    @Field(name = &quot;email&quot;)    val email: String) : Auditable()interface MemberRepository : MongoRepository&lt;Member, ObjectId&gt;, MemberCustomRepository, QuerydslPredicateExecutor&lt;Member&gt;interface MemberCustomRepositoryclass MemberCustomRepositoryImpl(private val mongoTemplate: MongoTemplate) : MemberCustomRepository\n\n코드의 각 부분은 MongoDB를 사용하는 스프링 애플리케이션에서 도메인 객체를 정의하고, 저장소를 구성하는 데 필요한 요소들을 포함하고 있습니다. 아래는 코드 구조를 기반으로 한 정리입니다:\n\nMember - MongoDB의 members 컬렉션에 매핑되는 도메인 객체입니다. name과 email 필드를 가지고 있으며, 각 필드는 MongoDB의 문서 필드에 맞추어 @Field 애노테이션을 사용하여 지정되어 있습니다.\nMemberRepository - MongoDB의 기본 CRUD 작업을 위한 MongoRepository와 사용자 정의 쿼리를 위한 MemberCustomRepository, Querydsl 지원을 위한 QuerydslPredicateExecutor를 확장하는 저장소 인터페이스입니다. 이로 인해 Member 객체에 대한 표준 데이터 접근 패턴과 함께 복잡한 쿼리 기능을 제공합니다.\nMemberCustomRepository - 사용자 정의 쿼리를 위한 인터페이스로, 실제 사용자 정의 로직을 위한 메소드의 시그니처를 포함할 수 있습니다.\nMemberCustomRepositoryImpl - MemberCustomRepository의 구현체로, 실제 사용자 정의 쿼리 로직을 실행하는 메소드를 포함합니다. MongoTemplate을 주입받아 MongoDB의 복잡한 작업을 처리하는 데 사용됩니다.\n\n이 구성을 통해, 애플리케이션은 MongoDB에 대한 데이터 액세스를 추상화하고 효율적으로 관리할 수 있으며, MemberRepository를 통해 비즈니스 로직에 맞는 복잡한 데이터 접근 패턴을 구현할 수 있어 애플리케이션의 유연성을 증가시키고 코드의 관리를 간소화합니다.\nMemberCustomRepositoryImpl 구현12345678910111213141516interface MemberCustomRepository &#123;    fun findByName(name: String): List&lt;Member&gt;    fun findByEmail(email: String): List&lt;Member&gt;&#125;class MemberCustomRepositoryImpl(private val mongoTemplate: MongoTemplate) : MemberCustomRepository &#123;    override fun findByName(name: String): List&lt;Member&gt; &#123;        val query = Query(Criteria.where(&quot;name&quot;).`is`(name))        return mongoTemplate.find(query, Member::class.java)    &#125;    override fun findByEmail(email: String): List&lt;Member&gt; &#123;        val query = Query(Criteria.where(&quot;email&quot;).`is`(email))        return mongoTemplate.find(query, Member::class.java)    &#125;&#125;\n\nMemberCustomRepositoryImpl 클래스에서는 MemberCustomRepository 인터페이스에 선언된 메소드의 구체적인 구현이 이루어집니다. 처음에는 override 키워드 없이 구현을 시작할 수 있습니다. 구현을 완료한 후, IntelliJ의 Refactoring 메뉴에서 Pull Members Up... 옵션을 선택함으로써 해당 메소드를 상위 인터페이스로 이동시킬 수 있습니다.\n\n인터페이스의 메서드 시그니처를 처음부터 명확히 정의하지 않고, 구현 클래스에서 메서드의 세부 구현을 확정한 후에 이를 상위 인터페이스로 옮기는 방식을 개인적으로 선호합니다.\nCustomRepositoryImpl를 서포트하는 MongoCustomRepositorySupportMongoCustomRepositorySupport 구현체Querydsl Repository Support 활용 포스팅에서는 QuerydslRepositorySupport를 사용해 CustomRepositoryImpl의 반복적이고 복잡한 쿼리 로직을 단순화한 방법을 소개했습니다. 이와 유사하게, MongoCustomRepositorySupport를 생성하여 CustomRepositoryImpl에 공통 메서드를 중앙화시키면, 코드 중복을 줄이고 재사용성을 높일 수 있습니다. 이러한 방식은 Mongo DB 환경에서도 Querydsl의 장점을 활용하게 해주며, 코드 관리 및 유지보수의 효율성을 향상시킵니다. 대표적으로 페이징 처리 관련된 기능들을 통합해서 제공해줄 수 있습니다.\n12345678910111213141516171819202122232425262728293031323334abstract class MongoCustomRepositorySupport&lt;T&gt;(    protected val documentClass: Class&lt;T&gt;,    protected val mongoTemplate: MongoTemplate) &#123;    private val logger by logger()    protected fun logQuery(        query: Query,        name: String? = null,    ) &#123;        if (logger.isDebugEnabled) &#123;            logger.debug(&quot;Executing MongoDB $name Query: $query&quot;)        &#125;    &#125;    protected fun &lt;S : T&gt; applyPagination(        pageable: Pageable,        contentQuery: (Query) -&gt; List&lt;S&gt;,        countQuery: (Query) -&gt; Long    ) = runBlocking &#123;        val content = async &#123; contentQuery(Query().with(pageable)) &#125;        val totalCount = async &#123; countQuery(Query()) &#125;        PageImpl(content.await(), pageable, totalCount.await())    &#125;    protected fun &lt;S : T&gt; applySlicePagination(        pageable: Pageable,        contentQuery: (Query) -&gt; List&lt;S&gt;    ): Slice&lt;S&gt; &#123;        val content = contentQuery(Query().with(pageable))        val hasNext = content.size &gt;= pageable.pageSize        return SliceImpl(content, pageable, hasNext)    &#125;&#125;\n\n\nJPA 페이징 성능을 향상시키는 방법으로, 내용을 담은 콘텐츠 쿼리와 개수를 세는 카운트 쿼리를 분리하여 구현하는 것이 유익하다는 내용을 JPA 페이징 Performance 향상 방법에서 다루었습니다. 이 두 쿼리는 상호 의존적이지 않아 병렬 처리를 함으로써 성능을 높일 수 있습니다. 또한, 슬라이스 쿼리의 경우, ‘다음 페이지가 있는지’를 확인하는 hasNext 메서드를 포함한 공통된 로직을 사용함으로써 코드 중복을 방지하고 재사용성을 극대화합니다. MongoCustomRepositorySupport 클래스는 이러한 공통 기능을 제공하여 효율적인 데이터 조회와 페이지 처리를 가능하게 합니다.”\nMongoCustomRepositorySupport1234567891011121314151617181920212223242526272829303132333435363738394041interface MemberCustomRepository &#123;    ...    fun findPageBy(        pageable: Pageable,        name: String?,        email: String?    ): Page&lt;Member&gt;&#125;class MemberCustomRepositoryImpl(mongoTemplate: MongoTemplate) : MemberCustomRepository, MongoCustomRepositorySupport&lt;Member&gt;(    Member::class.java,    mongoTemplate) &#123;    ...    override fun findPageBy(        pageable: Pageable,        name: String?,        email: String?    ): Page&lt;Member&gt; &#123;        val queryBuilder: (Query) -&gt; Query = &#123; query -&gt;            val criteria = Criteria().apply &#123;                name?.let &#123; and(&quot;name&quot;).regex(&quot;.*$it.*&quot;, &quot;i&quot;) &#125;                email?.let &#123; and(&quot;email&quot;).regex(&quot;.*$it.*&quot;, &quot;i&quot;) &#125;            &#125;            query.addCriteria(criteria)        &#125;        return applyPagination(            pageable = pageable,            contentQuery = &#123; query -&gt;                mongoTemplate.find(queryBuilder(query), documentClass)            &#125;,            countQuery = &#123; query -&gt;                mongoTemplate.count(queryBuilder(query), documentClass)            &#125;        )    &#125;&#125;\n\nMemberCustomRepositoryImpl 클래스는 MongoCustomRepositorySupport 추상 클래스를 상속받아, MongoDB와의 데이터 교환을 더 효율적으로 관리하는 특수한 저장소 구현을 제공합니다. MongoCustomRepositorySupport는 몽고디비의 mongoTemplate와 작업할 클래스 타입을 받아 초기화합니다. 이는 MemberRepository 구현에 필수적인 기반 구조를 제공하여 보일러플레이트 코드를 줄이고 코드의 재사용성을 향상시킵니다.\n","dateCreated":"2023-11-04T18:04:32+09:00","dateModified":"2025-01-31T04:41:33+09:00","datePublished":"2023-11-04T18:04:32+09:00","description":"Spring Data JPA에서 흔히 사용하는 Repository 확장 패턴을 Spring Data MongoDB에도 적용할 수 있습니다.","headline":"Spring Data MongoDB Repository 확장","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://cheese10yun.github.io/2023/11/04/spring-data-mongo-repository/"},"publisher":{"@type":"Organization","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg","logo":{"@type":"ImageObject","url":"yun-icon.jpg"}},"url":"https://cheese10yun.github.io/2023/11/04/spring-data-mongo-repository/","keywords":"Coroutines, Mongo"}</script>
    <meta name="description" content="Spring Data JPA에서 흔히 사용하는 Repository 확장 패턴을 Spring Data MongoDB에도 적용할 수 있습니다.">
<meta property="og:type" content="blog">
<meta property="og:title" content="Spring Data MongoDB Repository 확장">
<meta property="og:url" content="https://cheese10yun.github.io/2023/11/04/spring-data-mongo-repository/index.html">
<meta property="og:site_name" content="Yun Blog">
<meta property="og:description" content="Spring Data JPA에서 흔히 사용하는 Repository 확장 패턴을 Spring Data MongoDB에도 적용할 수 있습니다.">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/mongo-study/images/custom-01.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/mongo-study/images/query-result.png">
<meta property="article:published_time" content="2023-11-04T09:04:32.144Z">
<meta property="article:modified_time" content="2025-01-30T19:41:33.770Z">
<meta property="article:author" content="Yun">
<meta property="article:tag" content="Coroutines">
<meta property="article:tag" content="Mongo">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/mongo-study/images/custom-01.png">
    
    
        
    
    
        <meta property="og:image" content="https://cheese10yun.github.io/assets/images/yun-icon.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90907312-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90907312-1');
    </script>


    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Yun Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="링크 열기: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="저자에 대해 더 알아보기"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
                </a>
                <h4 class="sidebar-profile-name">Yun</h4>
                
                    <h5 class="sidebar-profile-bio"><p>기술 블로그</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="카테고리"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">카테고리</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="태그"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">태그</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="아카이브"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">아카이브</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="검색"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">검색</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/cheese10yun"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/rss2.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Spring Data MongoDB Repository 확장
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2023-11-04T18:04:32+09:00">
	
		    2023/11/04
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>Spring Data JPA에서 흔히 사용하는 Repository 확장 패턴을 Spring Data MongoDB에도 적용할 수 있습니다. 이 패턴은 ‘CustomRepository’와 ‘CustomRepositoryImpl’의 조합으로 구성되며, <a href="https://cheese10yun.github.io/spring-jpa-best-15/">Spring-JPA Best Practices step-15</a>에서 이전에 포스팅한적 있습니다. 이 방법을 사용하면 복잡한 조회 작업을 ‘CustomRepositoryImpl’에서 처리할 수 있게 됩니다. 이 구조를 사용하면, 사용자는 Repository 인터페이스만을 이용하여 데이터를 조회할 수 있게 되어 코드의 간결성과 유지보수성이 향상됩니다. 예를 들어, CustomRepositoryImpl에서 복잡한 쿼리 로직을 구현하면, 상위 레벨에서는 이러한 구현 디테일을 신경 쓰지 않고 데이터 접근 로직을 단순화할 수 있습니다. Spring Data MongoDB에서 동일하게 적용하는 방법을 살펴보겠습니다.</p>
<h2 id="Custom-Repository"><a href="#Custom-Repository" class="headerlink" title="Custom Repository"></a>Custom Repository</h2><h3 id="Custom-Repository-구성"><a href="#Custom-Repository-구성" class="headerlink" title="Custom Repository 구성"></a>Custom Repository 구성</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Document(collection = <span class="string">&quot;members&quot;</span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Member</span>(</span><br><span class="line">    <span class="meta">@Field(name = <span class="string">&quot;name&quot;</span>)</span></span><br><span class="line">    <span class="keyword">val</span> name: String,</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Field(name = <span class="string">&quot;email&quot;</span>)</span></span><br><span class="line">    <span class="keyword">val</span> email: String</span><br><span class="line">) : Auditable()</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MemberRepository</span> : <span class="type">MongoRepository</span>&lt;<span class="type">Member, ObjectId</span>&gt;, <span class="type">MemberCustomRepository</span>, <span class="type">QuerydslPredicateExecutor</span>&lt;<span class="type">Member</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MemberCustomRepository</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MemberCustomRepositoryImpl</span>(<span class="keyword">private</span> <span class="keyword">val</span> mongoTemplate: MongoTemplate) : MemberCustomRepository</span><br></pre></td></tr></table></figure>

<p>코드의 각 부분은 MongoDB를 사용하는 스프링 애플리케이션에서 도메인 객체를 정의하고, 저장소를 구성하는 데 필요한 요소들을 포함하고 있습니다. 아래는 코드 구조를 기반으로 한 정리입니다:</p>
<ol>
<li><strong><code>Member</code></strong> - MongoDB의 <code>members</code> 컬렉션에 매핑되는 도메인 객체입니다. <code>name</code>과 <code>email</code> 필드를 가지고 있으며, 각 필드는 MongoDB의 문서 필드에 맞추어 <code>@Field</code> 애노테이션을 사용하여 지정되어 있습니다.</li>
<li><strong><code>MemberRepository</code></strong> - MongoDB의 기본 CRUD 작업을 위한 <code>MongoRepository</code>와 사용자 정의 쿼리를 위한 <code>MemberCustomRepository</code>, Querydsl 지원을 위한 <code>QuerydslPredicateExecutor</code>를 확장하는 저장소 인터페이스입니다. 이로 인해 <code>Member</code> 객체에 대한 표준 데이터 접근 패턴과 함께 복잡한 쿼리 기능을 제공합니다.</li>
<li><strong><code>MemberCustomRepository</code></strong> - 사용자 정의 쿼리를 위한 인터페이스로, 실제 사용자 정의 로직을 위한 메소드의 시그니처를 포함할 수 있습니다.</li>
<li><strong><code>MemberCustomRepositoryImpl</code></strong> - <code>MemberCustomRepository</code>의 구현체로, 실제 사용자 정의 쿼리 로직을 실행하는 메소드를 포함합니다. <code>MongoTemplate</code>을 주입받아 MongoDB의 복잡한 작업을 처리하는 데 사용됩니다.</li>
</ol>
<p>이 구성을 통해, 애플리케이션은 MongoDB에 대한 데이터 액세스를 추상화하고 효율적으로 관리할 수 있으며, <code>MemberRepository를</code> 통해 비즈니스 로직에 맞는 복잡한 데이터 접근 패턴을 구현할 수 있어 애플리케이션의 유연성을 증가시키고 코드의 관리를 간소화합니다.</p>
<h3 id="MemberCustomRepositoryImpl-구현"><a href="#MemberCustomRepositoryImpl-구현" class="headerlink" title="MemberCustomRepositoryImpl 구현"></a>MemberCustomRepositoryImpl 구현</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MemberCustomRepository</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">findByName</span><span class="params">(name: <span class="type">String</span>)</span></span>: List&lt;Member&gt;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">findByEmail</span><span class="params">(email: <span class="type">String</span>)</span></span>: List&lt;Member&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MemberCustomRepositoryImpl</span>(<span class="keyword">private</span> <span class="keyword">val</span> mongoTemplate: MongoTemplate) : MemberCustomRepository &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">findByName</span><span class="params">(name: <span class="type">String</span>)</span></span>: List&lt;Member&gt; &#123;</span><br><span class="line">        <span class="keyword">val</span> query = Query(Criteria.<span class="keyword">where</span>(<span class="string">&quot;name&quot;</span>).`<span class="keyword">is</span>`(name))</span><br><span class="line">        <span class="keyword">return</span> mongoTemplate.find(query, Member::<span class="keyword">class</span>.java)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">findByEmail</span><span class="params">(email: <span class="type">String</span>)</span></span>: List&lt;Member&gt; &#123;</span><br><span class="line">        <span class="keyword">val</span> query = Query(Criteria.<span class="keyword">where</span>(<span class="string">&quot;email&quot;</span>).`<span class="keyword">is</span>`(email))</span><br><span class="line">        <span class="keyword">return</span> mongoTemplate.find(query, Member::<span class="keyword">class</span>.java)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>MemberCustomRepositoryImpl</code> 클래스에서는 <code>MemberCustomRepository</code> 인터페이스에 선언된 메소드의 구체적인 구현이 이루어집니다. 처음에는 <code>override</code> 키워드 없이 구현을 시작할 수 있습니다. 구현을 완료한 후, IntelliJ의 <code>Refactoring</code> 메뉴에서 <code>Pull Members Up...</code> 옵션을 선택함으로써 해당 메소드를 상위 인터페이스로 이동시킬 수 있습니다.</p>
<p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/mongo-study/images/custom-01.png"></p>
<p>인터페이스의 메서드 시그니처를 처음부터 명확히 정의하지 않고, 구현 클래스에서 메서드의 세부 구현을 확정한 후에 이를 상위 인터페이스로 옮기는 방식을 개인적으로 선호합니다.</p>
<h2 id="CustomRepositoryImpl를-서포트하는-MongoCustomRepositorySupport"><a href="#CustomRepositoryImpl를-서포트하는-MongoCustomRepositorySupport" class="headerlink" title="CustomRepositoryImpl를 서포트하는 MongoCustomRepositorySupport"></a>CustomRepositoryImpl를 서포트하는 MongoCustomRepositorySupport</h2><h3 id="MongoCustomRepositorySupport-구현체"><a href="#MongoCustomRepositorySupport-구현체" class="headerlink" title="MongoCustomRepositorySupport 구현체"></a>MongoCustomRepositorySupport 구현체</h3><p><a href="https://cheese10yun.github.io/querydsl-support/">Querydsl Repository Support 활용</a> 포스팅에서는 <code>QuerydslRepositorySupport</code>를 사용해 <code>CustomRepositoryImpl</code>의 반복적이고 복잡한 쿼리 로직을 단순화한 방법을 소개했습니다. 이와 유사하게, <code>MongoCustomRepositorySupport</code>를 생성하여 <code>CustomRepositoryImpl</code>에 공통 메서드를 중앙화시키면, 코드 중복을 줄이고 재사용성을 높일 수 있습니다. 이러한 방식은 Mongo DB 환경에서도 Querydsl의 장점을 활용하게 해주며, 코드 관리 및 유지보수의 효율성을 향상시킵니다. 대표적으로 페이징 처리 관련된 기능들을 통합해서 제공해줄 수 있습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">MongoCustomRepositorySupport</span>&lt;<span class="type">T</span>&gt;(</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">val</span> documentClass: Class&lt;T&gt;,</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">val</span> mongoTemplate: MongoTemplate</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> logger <span class="keyword">by</span> logger()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="title">logQuery</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        query: <span class="type">Query</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        name: <span class="type">String</span>? = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isDebugEnabled) &#123;</span><br><span class="line">            logger.debug(<span class="string">&quot;Executing MongoDB <span class="variable">$name</span> Query: <span class="variable">$query</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;S : T&gt;</span> <span class="title">applyPagination</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        pageable: <span class="type">Pageable</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        contentQuery: (<span class="type">Query</span>) -&gt; <span class="type">List</span>&lt;<span class="type">S</span>&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">        countQuery: (<span class="type">Query</span>) -&gt; <span class="type">Long</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> = runBlocking &#123;</span><br><span class="line">        <span class="keyword">val</span> content = async &#123; contentQuery(Query().with(pageable)) &#125;</span><br><span class="line">        <span class="keyword">val</span> totalCount = async &#123; countQuery(Query()) &#125;</span><br><span class="line">        PageImpl(content.await(), pageable, totalCount.await())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;S : T&gt;</span> <span class="title">applySlicePagination</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        pageable: <span class="type">Pageable</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        contentQuery: (<span class="type">Query</span>) -&gt; <span class="type">List</span>&lt;<span class="type">S</span>&gt;</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: Slice&lt;S&gt; &#123;</span><br><span class="line">        <span class="keyword">val</span> content = contentQuery(Query().with(pageable))</span><br><span class="line">        <span class="keyword">val</span> hasNext = content.size &gt;= pageable.pageSize</span><br><span class="line">        <span class="keyword">return</span> SliceImpl(content, pageable, hasNext)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/mongo-study/images/query-result.png"></p>
<p>JPA 페이징 성능을 향상시키는 방법으로, 내용을 담은 콘텐츠 쿼리와 개수를 세는 카운트 쿼리를 분리하여 구현하는 것이 유익하다는 내용을 <a href="https://cheese10yun.github.io/page-performance/">JPA 페이징 Performance 향상 방법</a>에서 다루었습니다. 이 두 쿼리는 상호 의존적이지 않아 병렬 처리를 함으로써 성능을 높일 수 있습니다. 또한, 슬라이스 쿼리의 경우, ‘다음 페이지가 있는지’를 확인하는 <code>hasNext</code> 메서드를 포함한 공통된 로직을 사용함으로써 코드 중복을 방지하고 재사용성을 극대화합니다. <code>MongoCustomRepositorySupport</code> 클래스는 이러한 공통 기능을 제공하여 효율적인 데이터 조회와 페이지 처리를 가능하게 합니다.”</p>
<h3 id="MongoCustomRepositorySupport"><a href="#MongoCustomRepositorySupport" class="headerlink" title="MongoCustomRepositorySupport"></a>MongoCustomRepositorySupport</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MemberCustomRepository</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">findPageBy</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        pageable: <span class="type">Pageable</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        name: <span class="type">String</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">        email: <span class="type">String</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: Page&lt;Member&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MemberCustomRepositoryImpl</span>(mongoTemplate: MongoTemplate) : MemberCustomRepository, MongoCustomRepositorySupport&lt;Member&gt;(</span><br><span class="line">    Member::<span class="keyword">class</span>.java,</span><br><span class="line">    mongoTemplate</span><br><span class="line">) &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">findPageBy</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        pageable: <span class="type">Pageable</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        name: <span class="type">String</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">        email: <span class="type">String</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: Page&lt;Member&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> queryBuilder: (Query) -&gt; Query = &#123; query -&gt;</span><br><span class="line">            <span class="keyword">val</span> criteria = Criteria().apply &#123;</span><br><span class="line">                name?.let &#123; and(<span class="string">&quot;name&quot;</span>).regex(<span class="string">&quot;.*<span class="variable">$it</span>.*&quot;</span>, <span class="string">&quot;i&quot;</span>) &#125;</span><br><span class="line">                email?.let &#123; and(<span class="string">&quot;email&quot;</span>).regex(<span class="string">&quot;.*<span class="variable">$it</span>.*&quot;</span>, <span class="string">&quot;i&quot;</span>) &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            query.addCriteria(criteria)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> applyPagination(</span><br><span class="line">            pageable = pageable,</span><br><span class="line">            contentQuery = &#123; query -&gt;</span><br><span class="line">                mongoTemplate.find(queryBuilder(query), documentClass)</span><br><span class="line">            &#125;,</span><br><span class="line">            countQuery = &#123; query -&gt;</span><br><span class="line">                mongoTemplate.count(queryBuilder(query), documentClass)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>MemberCustomRepositoryImpl</code> 클래스는 <code>MongoCustomRepositorySupport</code> 추상 클래스를 상속받아, MongoDB와의 데이터 교환을 더 효율적으로 관리하는 특수한 저장소 구현을 제공합니다. <code>MongoCustomRepositorySupport</code>는 몽고디비의 <code>mongoTemplate</code>와 작업할 클래스 타입을 받아 초기화합니다. 이는 <code>MemberRepository</code> 구현에 필수적인 기반 구조를 제공하여 보일러플레이트 코드를 줄이고 코드의 재사용성을 향상시킵니다.</p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">태그</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/Coroutines/" rel="tag">Coroutines</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Mongo/" rel="tag">Mongo</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2023/11/12/spring-data-mongo-test-setup/"
                    data-tooltip="MongoDB 다양한 테스트 케이스를 커버할 수 있는 테스트 데이터 셋업 방법"
                    aria-label="이전: MongoDB 다양한 테스트 케이스를 커버할 수 있는 테스트 데이터 셋업 방법"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2023/09/05/page-performance/"
                    data-tooltip="JPA 페이징 Performance 향상 방법"
                    aria-label="다음: JPA 페이징 Performance 향상 방법"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/2023/11/04/spring-data-mongo-repository/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/2023/11/04/spring-data-mongo-repository/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://cheese10yun.github.io/2023/11/04/spring-data-mongo-repository/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>


<!-- Comment -->
<!--  utteranc comment -->

<script src="https://utteranc.es/client.js"
        repo="cheese10yun/blog-comment"
        issue-term="title"
        label="Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Yun. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2023/11/12/spring-data-mongo-test-setup/"
                    data-tooltip="MongoDB 다양한 테스트 케이스를 커버할 수 있는 테스트 데이터 셋업 방법"
                    aria-label="이전: MongoDB 다양한 테스트 케이스를 커버할 수 있는 테스트 데이터 셋업 방법"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2023/09/05/page-performance/"
                    data-tooltip="JPA 페이징 Performance 향상 방법"
                    aria-label="다음: JPA 페이징 Performance 향상 방법"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/2023/11/04/spring-data-mongo-repository/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/2023/11/04/spring-data-mongo-repository/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://cheese10yun.github.io/2023/11/04/spring-data-mongo-repository/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/2023/11/04/spring-data-mongo-repository/"
                        aria-label="Facebook에 공유하기"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Facebook에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/2023/11/04/spring-data-mongo-repository/"
                        aria-label="Twitter에 공유하기"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Twitter에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://cheese10yun.github.io/2023/11/04/spring-data-mongo-repository/"
                        aria-label="Google+에 공유하기"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Google+에 공유하기</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
            <h4 id="about-card-name">Yun</h4>
        
            <div id="about-card-bio"><p>기술 블로그</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
