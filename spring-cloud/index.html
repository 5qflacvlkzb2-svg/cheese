
<!DOCTYPE html>
<html lang="ko">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="naver-site-verification" content="a37ea649edf26e70c3de94f9cb034f9d6e11de3f" />
    <meta name="generator" content="Yun Blog">
    <title>Spring Cloud 살펴보기 - Yun Blog</title>
    <meta name="author" content="Yun">
    
        <meta name="keywords" content="Node,Spring,Spring Boot,Spring Batch,Kotlin,기술 블로그,JPA,Mongo,MySQL,OOP,">
    
    
    
        
            <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss2.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg"},"articleBody":"Spring Cloud Config스프링 클라우드 컨피그는 중앙 집중식 마이크로서비스 구성을 지원한다. 여기서 두 가지 중요한 구성 요소의 조합이다.\n\n스프링 클라우드 컨피그 서버 : 버전 관리 리포지토리로 백업된 중앙 집중식 구성 노출을 지원한다.\n스프링 클라우드 컨피그 클라이언트 : 애플리케이션이 스프링 클라우드 컨피그 서버에 연결하도록 지원한다.\n\nGitHub Repository 연결\nGitHub Repository에 \n\nmicoroservice-a-default.yml\nmicoroservice-a-dev.yml\n\n아래 처럼 작성합니다.\n12application:  message: &quot;Message From &#123;ENV&#125; Local Git Repository&quot;\n&#123;ENV&#125;에 ddefault, dev 환경에 맞는 값을 작성합니다.\nConfig Server12implementation &#x27;org.springframework.cloud:spring-cloud-config-server&#x27;implementation &#x27;org.springframework.boot:spring-boot-starter-actuator&#x27;\nconfig server 의존 성을 추가합니다. actuator도 편의를 위해서 추가합니다.\n12345678910111213server:  port: 8888spring:  application:    name: &quot;config-server&quot;  cloud:    config:      server:        git:          uri: &quot;https://github.com/cheese10yun/msa-study-sample&quot;\n\nconfig server는 8888 port를 사용하는 관례가 있어 port를 8888로 지정합니다. Github Repository URI 주소를 입력합니다.\n123456789@SpringBootApplication@EnableConfigServerpublic class ConfigServerApplication &#123;  public static void main(String[] args) &#123;    SpringApplication.run(ConfigServerApplication.class, args);  &#125;&#125;\n@EnableConfigServer 어노테이션을 추가만 하면 별다른 설정없이 Config Server가 설정됩니다. \nactuator 의존성이 있으면 IntellJ Endpoints -&gt; Mappings에서 현재 서버의 API mapping 정보를 쉽게 확인할 수 있습니다.\n마우스 왼쪽 클릭을 한 이후에 Open In Http Request…를 클릭하면 쉽게 HTTP 콜을 할 수 있습니다.\n\nURL 형식은 &#x2F;{appliation-name}&#x2F;{profile}&#x2F;{label}입니다. 위에서 등록한 micoroservice-a-default.yml을 확인해보기 위해서 http://localhost:8888/microservice-a/default을 호출합니다.\n1234567891011121314151617&#123;  &quot;name&quot;: &quot;microservice-a&quot;,  &quot;profiles&quot;: [    &quot;default&quot;  ],  &quot;label&quot;: null,  &quot;version&quot;: &quot;c03eecc5d8eabefc4b2a8f085789f42bd5317366&quot;,  &quot;state&quot;: null,  &quot;propertySources&quot;: [    &#123;      &quot;name&quot;: &quot;https://github.com/cheese10yun/msa-study-sample/microservice-a-default.yml&quot;,      &quot;source&quot;: &#123;        &quot;application.message&quot;: &quot;Message From Default Local Git Repository&quot;      &#125;    &#125;  ]&#125;\n응답 값을 보면 해당 properties를 잘 읽어 오는 것을 확인할 수 있습니다. \nhttp://localhost:8888/microservice-a/dev을 호출하면 micoroservice-a-dev.yml의 값을 제대로 읽어 오는지 확인할 수 있습니다.\n1234567891011121314151617&#123;  &quot;name&quot;: &quot;microservice-a&quot;,  &quot;profiles&quot;: [    &quot;dev&quot;  ],  &quot;label&quot;: null,  &quot;version&quot;: &quot;c03eecc5d8eabefc4b2a8f085789f42bd5317366&quot;,  &quot;state&quot;: null,  &quot;propertySources&quot;: [    &#123;      &quot;name&quot;: &quot;https://github.com/cheese10yun/msa-study-sample/microservice-a-dev.yml&quot;,      &quot;source&quot;: &#123;        &quot;application.message&quot;: &quot;Message From Default Dev Git Repository&quot;      &#125;    &#125;  ]&#125;\n\nClient1234dependencies &#123;    implementation &#x27;org.springframework.cloud:spring-cloud-config-client&#x27;    implementation &#x27;org.springframework.boot:spring-boot-starter-actuator&#x27;&#125;\n필요한 의존성을 추가합니다.\n12345678910@Component@ConfigurationProperties(&quot;application&quot;)@Getter@Setterpublic class ApplicationConfiguration &#123;  private String message;&#125;\n프로퍼티를 읽을 ConfigurationProperties 객체를 만듭니다.\n12345678910111213141516@RestController@RequiredArgsConstructorpublic class WelcomeController &#123;  private final ApplicationConfiguration applicationConfiguration;  @GetMapping(&quot;/message&quot;)  public Map&lt;String, String&gt; welcome() &#123;    final Map&lt;String, String&gt; map = new HashMap&lt;&gt;();    map.put(&quot;message&quot;, applicationConfiguration.getMessage());    return map;  &#125;&#125;\n해당 메시지를 확인할 수 있는 컨트롤러를 만듭니다. getMessage() 메시지는 각 환경마다 다른 메시지를 출력합니다.\n1234567891011spring:  profiles:    active: &#123;ENV&#125;  cloud:    config:      uri: http://localhost:8888  application:    name: microservice-a\n파일명은 bootstrap.yml으로 지정합니다. active는 각 환경마다 지정합니다. dev으로 지정하고 http://127.0.0.1:8080/message API를 호출해보겠습니다.\n\n이것도 인텔리제이를 이용해서 호출하면 간편합니다.\n123&#123;  &quot;message&quot;: &quot;Message From Default Dev Git Repository&quot;&#125;\n\nDev 메시지가 출력되는 것을 확인 할 수 있습니다. profiles을 default 으로 지정하면 메시지에는 local 이라는 문자가 출력됩니다.\nRefresh마이크로서비스 A의 properties의 변경이 생겼을 경우 Refresh API를 호출해서 설정을 변경할 수 있다.\n\nmessage API를 호출하면 기존 메시지가 그대로 출력된다.\n123# microservice-a-default.ymlapplication:  message: &quot;Message From Default Local Git Repository (Properties update...)&quot;\nmicroservice-a-default.yml 메시지를 위와 같이 변경한 이후에 \nPOST http://127.0.0.1:8080/actuator/refresh을 호출하면\n1234[  &quot;config.client.version&quot;,  &quot;application.message&quot;]\n\nResponse으로 application.message의 변경을 알려준다. 이후 message api를 호출하면 아래 그림처럼 변경된 Response를 확인 할 수 있다.\n\n정리Github Repository와 같은 버전 관리 리포지토리로 백업된 중앙 집중 구성으로 properties를 제공해줍니다. 또 Properties 설정 및 단순한 설정으로 클라이언트 애플리케이션이 스프링 클라우드 컨피그 서버에 쉽게 연결되도록 지원해줍니다.\nSpring Cloud Bus프로덕션 환경에서 실행중인 마이크로서비스 A의 인스턴스가 N대가 있을 경우에는 설정을 변경하기 위해서는 POST http://127.0.0.1:8080/actuator/refresh 요청을 N대의 인스턴스 서버에 N번의 refresh API를 호출 해야한다. 이는 번거러울 뿐만 아니라 실수를 유발하기 쉬운 구조이다.\n스프링 클라우드 버스를 시용한 변경 전파스프링 클라우 버스를 사용해서 Rabbit MQ 같은 메시지 브로커를 통해 변경 사항을 여러 인스턴스에 전달할 수 있다.\n각 마이크로서비스의 인스턴스는 애플리케이션 구동시에 스프링 클라우드 버스에 등록한다. 마이크로서비스의 인스턴스 중 하나에 refresh가 호출되면 스프링 클라우드 버스는 모든 마이크로서비스 인스턴스에 변경 이벤트를 전달하게 된다. \nRabbit MQ 설치123456789.├── config-server├── docker-compose.yaml├── microservice-a├── microservice-a-default.yml├── microservice-a-dev.yml├── service-consumer├── static└── volumes\n프로젝트 루트 디렉토리에 volumes 디렉토리를 만들고, gitginore를 추가 해줍니다. 해당 디렉토리에 docker rabbmit mq가 저장됩니다.\ndocker-compose.yaml  파일은 아래와 같이 준비 해줍니다.\n123456789101112131415version: &quot;3&quot;services:  rabbitmq:    container_name: bus.rabbitmq    image: rabbitmq:3.7-management    ports:      - &quot;5672:5672&quot;      - &quot;15672:15672&quot;    environment:      - RABBITMQ_DEFAULT_USER = user      - RABBITMQ_DEFAULT_PASS = user    hostname: bus    volumes:      - ./volumes/bus-rabbitmq:/var/lib/rabbitmq\n\n\n12$ cd 프로젝트 루트 디렉토리$ docker-compose -up -d\n\nClient123dependencies &#123;    implementation &#x27;org.springframework.cloud:spring-cloud-starter-bus-amqp&#x27;&#125;\n필요한 의존성을 추가합니다.\n서버가 시작될때 스프링 클라우드 버스에 등록되고, 클라우드 버스의 이벤트를 수신하게 됩니다. Rabbmit MQ 커넥션은 자동으로 연결됩니다. (스프링 너란 자식….)\n\n포트를 8080, 8081을 설정해서 2대의 서버를 구동 시킵니다.\nBus Refresh\nmicroservice-a-default.yml을 아래처럼 변경합니다.\n12application:  message: &quot;Message From Default Local Git Repository (Spring Cloud Bus)&quot;\n\n/bus/refresh API가 추가되 었습니다. 해당 API를 호출합니다. (8081을 호출해도 됩니다.)\n1curl -X POST http://localhost:8080/bus/refresh\n\nrefresh 호출 이후에 message를 호출합니다.\n1curl -X GET http://localhost:8081/message\n8080 refresh를 호출하더라도 다른 8081 서버도 반영되는 것을 확인할 수 있습니다.\n\nEureka네임 서버마이크로서비스 아키텍처는 서로 상호 작용하는 더 작은 마이크로서비스가 필요 하다. 이 밖에도 각 마이크로서비스의 인스턴스가 여러 개 있을 수 있다. 마이크로서비스의 새로운 인스턴스가 동적으로 생성되고 파괴되면 외부 서비스의 연결 및 구성을 수동으로 유지하는 것이 어려울 수 있다. 네임 서버는 서비스 등록 및 서비스 검색 기능을 제공한다. 네임 서버는 마이크서비스가 이들 자신을 등록할 수 있게 하고, 상호 작용하고자 하는 다른 마이크러서비스에 대한 URL을 찾을 수 있게 도와준다.\nURL 하드 코딩의 한계123microservice-a:  ribbon:    listOfServers: http://localhost:8080,http://localhost:8081\n\n마이크로서비스 A의 새 인스턴스가 생성된다.\n마이크로서비스 A의 기존 인스턴스는 더 이상 사용할 수 없다.\n마이크로서비스 A가 다른 서버로 이동됐다.\n\n이런 모든 경우에 구성을 업데이트해야 하며, 변경 사항을 적용하기 위해서는 마이크로서비스가 새로 고쳐져야 한다.\n네임 서버 작동\n\n모든 마이크로서비스는 각 마이크로서비스가 시작될때 네임 서버에 등록한다.\n서비스 소비자가 특정 마이크로 서비스의 위치를 얻으려면 네임 서버를 요청해야한다.\n고유한 마이크로서비스 ID가 각 마이크로서비스에 지정된다. 이것을 등록 요청 및 검색 요청에서 키로 사용된다.\n마이크로서비스는 자동으로 등록 및 등록 취소할 수 있다.\n서비스 소비자가 마이크로서비스ID로 네임 서버를 찾을 때마다 해당 특정 마이크로서비스의 인스턴스 목록을 가져온다.\n\n구현유레카 서버 설정123dependencies &#123;    implementation &#x27;org.springframework.cloud:spring-cloud-starter-netflix-eureka-client&#x27;&#125;\n\n필요한 디펜던시를 추가합니다.\n\n123456789@SpringBootApplication@EnableEurekaServerpublic class EurekaServerApplication &#123;  public static void main(String[] args) &#123;    SpringApplication.run(EurekaServerApplication.class, args);  &#125;&#125;\n\n1234567server:  port: 8761eureka:  client:    fetch-registry: false    register-with-eureka: false\n\n유레카 마이크로 서비스 등록기존에 서비스들을 유레카 서버에게 접속할 수있도록 서비스 등록 작업을 진행합니다.\n123dependencies &#123;    implementation &#x27;org.springframework.cloud:spring-cloud-starter-netflix-eureka-client&#x27;&#125;\n\n123456789@SpringBootApplication@EnableDiscoveryClientpublic class MicroserviceAApplication &#123;  public static void main(String[] args) &#123;    SpringApplication.run(MicroserviceAApplication.class, args);  &#125;&#125;\n의존성 추가 및 @EnableDiscoveryClient 어노테이션 추가합니다. \n유레카와 마이크로 서비스 연결123#microservice-a:#  ribbon:#    listOfServers: http://localhost:8080,http://localhost:8081\n\n12345678910@SpringBootApplication@EnableFeignClients(&quot;com.cloud.serviceconsumer&quot;) // 어노테이션 추가@EnableDiscoveryClientpublic class ServiceConsumerApplication &#123;  public static void main(String[] args) &#123;    SpringApplication.run(ServiceConsumerApplication.class, args);  &#125;&#125;\n\n마이크로서비스A의 URL을 하드 코딩했을 경우 추가적인 서버 증성작업이 어렵다. 서비스 소비자 마이크로서비스가 유레카 서비스로부터 URL을 알아낼 수 있어야한다. 하드코딩된 URL정보를 주석처리 하고 아래의 어노테이션을 추가하면 된다.\n1234567@FeignClient(name = &quot;microservice-a&quot;)@RibbonClient(name = &quot;microservice-a&quot;)public interface RandomServiceProxy &#123;  @GetMapping(&quot;/random&quot;)  List&lt;Integer&gt; getRandomNumbers();&#125;\n\n동작 순서\n마이크로서비스 A의 각 인스턴스가 시작되면 유레카 네임 서버에 등록한다.\n서비스 소비자 마이크로서비스는 마이크로서비스 A의 인스턴스에 대해 유레카 네임 서버를 요청한다.\n서비스 소비자 마이크로서비스는 립본 클라이언트-클라이언트 로드 밸런서를 사용해 소출할 마이크로서비스 A의 특정 인스턴스를 결정한다.\n서비스 소비자 마이크로서비스는 마이크로서비스 A의 특정 인스턴스를 호출한다.\n\n유레카의 가장 큰 장점은 서비스 소비자 마이크로서비스가 마이크로서비스 A와 분리된다는 것이다. 서비스 소비자 마이크로서비스는 마이크로서비스 A의 새로운 인스턴스가 나타나거나 기존 인스턴스가 디운될 때마다 재구성할 필요가 없다.\n유레카 데시보드에서 여러 마이크로서비스를 확인 할 수 있다.\nRibbon로드 밸런싱마이크로서비스는 클라우드-네이티브 아키텍처의 가장 중요한 빌딩 블록이다. 마이크로서비스 인스턴스는 특정 마이크로서비스의 로드에 따라 확대 및 축소된다. 부하가 마이크로서비스의 다른 인스턴스 간에 똑같이 분산되도록 하려면 로드밸런싱의 기술피 필수이다. 로드 밸런싱은 로드가 마이크로서비스의 다른 인스턴스간에 균등하게 분배하도록 도와준다.\nRibbon 구성\n스프링 클라우드 넷플릭스 립본은 마이크로서비스의 다른 인스턴스 간에 라운드 로빈 실행을 사용해 클라이언트-사이드 로드 밸런싱을 제공한다.\n123dependencies &#123;    implementation &#x27;org.springframework.cloud:spring-cloud-starter-netflix-ribbon&#x27;&#125;\n필요한 의존성을 추가 합니다.\n123456789@FeignClient(name = &quot;microservice-a&quot;)@RibbonClient(name = &quot;microservice-a&quot;)public interface RandomServiceProxy &#123;  @GetMapping(&quot;/random&quot;)  List&lt;Integer&gt; getRandomNumbers();&#125;\n기존에 작성했던 RandomServiceProxy 인터페이스를 위와 같이 작성합니다. FeignClient도 서비스 네임만 기술합니다.\n123microservice-a:  ribbon:    listOfServers: http://localhost:8080,http://localhost:8081\nmicroservice-a의 서비스 url을 입력합니다.\n\nGET http://127.0.0.1:8100/add을 호추랗면 아래와 같은 결과값을 응답 받습니다.\n\n라운드 로빈 방식으로 random API 호출이 http://localhost:8080, http://localhost:8081으로 분산되어 호출됩니다.\n\n위과 같은 아키텍처 구성을 가지게 됩니다.\n선언적 Rest 클라이언트 - Feign페인은 최소한의 구성과 코드로, REST 서비스를 위한 REST 클라이언트를 쉽게 작성할 수 있습니다. 간단한 인터페이스로, 적절한 어노테이션을 사용하는 것이 특징입니다. \n페인은 립본 및 유레카와 통합하여 사용하면 더욱 효율성이 높아지게 됩니다.\n123dependencies &#123;    implementation &#x27;org.springframework.cloud:spring-cloud-starter-openfeign&#x27;&#125;\n필요한 의존성을 추가합니다.\n123456@FeignClient(name = &quot;micoservice-a&quot;, url = &quot;localhost:8080&quot;)public interface RandomServiceProxy &#123;  @GetMapping(&quot;/random&quot;)  public List&lt;Integer&gt; getRandomNumbers();&#125;\n\n서비스의 이름과 URL을 하드코딩 합니다. (유레카를 통해서 하드코딩된 부분을 제거할 수 있습니다.)\nController 코드를 작성하듯이 작성합니다.\n중요한 것은 이것은 인터페이스이며, 적절한 어노테이션 기반으로 동작한다는 것입니다.\n\n1234567891011121314151617@RestController@Slf4j@RequiredArgsConstructorpublic class NumberAddController &#123;  private final RandomServiceProxy randomServiceProxy;  @GetMapping(&quot;/add&quot;)  public Long add() &#123;    final List&lt;Integer&gt; numbers = randomServiceProxy.getRandomNumbers();    final long sum = numbers.stream().mapToInt(number -&gt; number).asLongStream().sum();    log.warn(&quot;returning &quot; + sum);    return sum;  &#125;&#125;\n\nRandomServiceProxy 의존성을 받아 사용합니다.\n\nFeign 응답값을 확인할 수 있습니다.\nAPI 게이트웨이마이크로 서비스의 문제점\n인증, 권한 부여 및 보안 : 모놀리식 서버에서는 인증 인가를 한 서버에서 책임지면 되는데 여러 서비스가 존재하는 마이크로서비스에서는 올바른 엑세스 보장을 어떻게할 것인가?\n동적 라우팅은 어떻게 할 것인가?\n내결합성: 하나의 마이크로서비스에서 오류가 발생해도 전체 시스템이 중단되지 않도록하면 어떻게 해야하는가 ?\n\n이러한 문제는 마이크로서비스가 서로 직접 대화할 때 개별 마이크로서비스에 의해 해결돼야한다. 하지만 이런 아키텍처들은 위 우려들을 각 마이크로서비스가 다르게 처리할 수 있기 때문에 유지 관리가 어려울 수 있다.\n이려한 문제를 해결하기 가장 쉬운 것이 API 게이트웨이이다. 다음은 API 게이트가 제공하는 기능이다.\n\n인증 및 보안\n속도 제한\n모니터링\n동적 라우팅 및 정적 응답 처리\n로드 차단\n여러 가지 서비스의 응답 집계\n\n주울로 클라이언트 - 사이드 로드 밸런싱 구현주을은 스프링 클라우드 넷플릭스 프로젝트의 일부다. 동적 라우팅, 모니터링, 필터링, 보안 등의 기능을 제공하는 API 게이트웨이 서비스다.\n1234dependencies &#123;    implementation &#x27;org.springframework.cloud:spring-cloud-starter-netflix-eureka-client&#x27;    implementation &#x27;org.springframework.cloud:spring-cloud-starter-netflix-zuul&#x27;&#125;\n\n12345678910@EnableZuulProxy@EnableDiscoveryClient@SpringBootApplicationpublic class ApiGatewayApplication &#123;  public static void main(String[] args) &#123;    SpringApplication.run(ApiGatewayApplication.class, args);  &#125;&#125;\n\n12345678910111213spring:  application:    name: &quot;zuul-api-gateway&quot;eureka:  client:    service-url:      defaultZone: http://localhost:8761/eurekaserver:  port: 8765\n\n필요한 의존성, 유레카 클라이언트, API 게이트웨이 등록을 진행한다.\n서버를 실행하면 유레카에 등록된 것을 확인 할 수있다.\n12345678910111213141516171819202122232425262728293031@Component@Slf4jpublic class SimpleLoggingFilter extends ZuulFilter &#123;    @Override  public String filterType() &#123;    return &quot;pre&quot;; // pre 사전 필터, route 원본으로 라우팅하기, post필터를 포스트라우팅, error 에러 처리  &#125;  @Override  public int filterOrder() &#123;    return 1; // 필터 우선순위  &#125;  @Override  public boolean shouldFilter() &#123;    return true; // 조건에 따른 필터 동작 여부, 해당 코드에서는 동작하기 위해서 true 리턴  &#125;    @Override  public Object run() &#123; // 필터에 대한 로직을 구현하는 방식, 아래 예제는 단순하게 로깅용    final RequestContext context = RequestContext.getCurrentContext();    final HttpServletRequest request = context.getRequest();    log.info(MessageFormat        .format(&quot;Request Method : &#123;0&#125; \\n URL : &#123;1&#125; &quot;, request.getMethod(),            request.getRequestURI()));    return null;  &#125;&#125;\n\n\n12345GET http://127.0.0.1:8765/microservice-a/randomAccept: application/jsonGET http://127.0.0.1:8765/service-consumer/addAccept: application/json\nservice-name&#x2F;url 을 호출할 경우 유레카에 등록되있는 서비스 정보를 기반으로 호출하게된다.\nSimpleLoggingFilter 잘 동작하는지 확인할 수 있다.\n필터\n사전 필터: 주울에서 목표 대상에 대한 실제 요청이 발생하기 전에 호출된다. 일반적으로 사전 필터는 서비스의 일관된 메세지형식(HTTP 헤더의 포함여부)을 확이하는 작업을 수행하거나 서비스를 이용하는 사용자가 인증 및 인가되었는지 확인하는 게이이트키퍼 역할을 한다.\n사후 필터: 대상 서비스를 호추랗고 응답을 클라이언트로 전송한 후 호출된다. 일반적으로 사후 필터는 대상 서비스의 응답을 로깅하거나 에러 처리, 민감정보에 대한 응답을 감시하는 목적으로 구현된다.\n경로 필터: 대상 서비스가 호출되기 전에 호출을 가로체는 데 사용된다. 일반적으로 경로 필터는 일정 수준의 동적 라우팅 필요 여부를 결정하는 데 사용된다. 예를 들어 이 장 뒷부분에서 동일 서비스의 다른 두 버전을 라우팅할 수 있는 경로 단위 핉를 사용해 작은 호출 비율만 새 버전의 서비스로 라우팅할 수 있다.\n\n필터 적용 패턴\nTrackingFilter: 주울에서 보내는 모든 요청에 연관된 상관관계 ID 여부를 확인하는 사전 필터다, 상관관계 ID는 고객 요청을 수행할 때 실행할 때 실행되는 모든 마이크로서비스에 전달되는 고유 ID이다. 상관관계 ID를 사용하면 특정 호출이 일련의 마이크로서비스를 통과할 때 발생하는 모든 이벤트 체인을 추적할 수 있다.\nSpecialRoutesFilter: 유입되는 경로를 확인하고 해당 경로에 A&#x2F;B 테스팅 수행 여부를 결정하는 주울의 경로 필터다. \nResponseFilter: 서비스 호출과 연관된 상관관계 ID를 클라이언트 회신하는 HTTP 응답 헤더에 삽입하는 사후 필터다. 일반적으로 클라이언트는 호출한 요청과 연관된 상관관계 ID에 엑세스할 수 있다.\n\n참고\n스프링 5.0 마스터\n스프링 마이크로 서비스 코딩 공작소\n\n","dateCreated":"2020-08-01T00:00:00+09:00","dateModified":"2025-01-31T06:29:31+09:00","datePublished":"2020-08-01T00:00:00+09:00","description":"스프링 클라우드 컨피그는 중앙 집중식 마이크로서비스 구성을 지원한다. 여기서 두 가지 중요한 구성 요소의 조합이다.","headline":"Spring Cloud 살펴보기","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://cheese10yun.github.io/spring-cloud/"},"publisher":{"@type":"Organization","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg","logo":{"@type":"ImageObject","url":"yun-icon.jpg"}},"url":"https://cheese10yun.github.io/spring-cloud/","keywords":"Spring, MSA"}</script>
    <meta name="description" content="스프링 클라우드 컨피그는 중앙 집중식 마이크로서비스 구성을 지원한다. 여기서 두 가지 중요한 구성 요소의 조합이다.">
<meta property="og:type" content="blog">
<meta property="og:title" content="Spring Cloud 살펴보기">
<meta property="og:url" content="https://cheese10yun.github.io/spring-cloud/index.html">
<meta property="og:site_name" content="Yun Blog">
<meta property="og:description" content="스프링 클라우드 컨피그는 중앙 집중식 마이크로서비스 구성을 지원한다. 여기서 두 가지 중요한 구성 요소의 조합이다.">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/github-img.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/intellj-actuator.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/http-call.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/message-call.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/json-1.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/json-2.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/bus-log.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/intellj-port-2.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/bus-mapping.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/8081-result.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/name-server.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/eureka-dashboard.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/ribbon.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/ribbon-result.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/ribbon-result2.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/msa-simple.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/fegin-result.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/api-gateway-eureka.png">
<meta property="og:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/api-gateway-eureka-result.png">
<meta property="article:published_time" content="2020-07-31T15:00:00.000Z">
<meta property="article:modified_time" content="2025-01-30T21:29:31.819Z">
<meta property="article:author" content="Yun">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="MSA">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/cheese10yun/msa-study-sample/raw/master/static/github-img.png">
    
    
        
    
    
        <meta property="og:image" content="https://cheese10yun.github.io/assets/images/yun-icon.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90907312-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90907312-1');
    </script>


    

    
        
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5813739623204880" crossorigin="anonymous"></script>
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Yun Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="링크 열기: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="저자에 대해 더 알아보기"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
                </a>
                <h4 class="sidebar-profile-name">Yun</h4>
                
                    <h5 class="sidebar-profile-bio"><p>기술 블로그</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="카테고리"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">카테고리</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="태그"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">태그</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="아카이브"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">아카이브</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="검색"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">검색</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/cheese10yun"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/rss2.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Spring Cloud 살펴보기
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2020-08-01T00:00:00+09:00">
	
		    2020/08/01
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <h1 id="Spring-Cloud-Config"><a href="#Spring-Cloud-Config" class="headerlink" title="Spring Cloud Config"></a>Spring Cloud Config</h1><p>스프링 클라우드 컨피그는 중앙 집중식 마이크로서비스 구성을 지원한다. 여기서 두 가지 중요한 구성 요소의 조합이다.</p>
<ul>
<li>스프링 클라우드 컨피그 서버 : 버전 관리 리포지토리로 백업된 중앙 집중식 구성 노출을 지원한다.</li>
<li>스프링 클라우드 컨피그 클라이언트 : 애플리케이션이 스프링 클라우드 컨피그 서버에 연결하도록 지원한다.</li>
</ul>
<h2 id="GitHub-Repository-연결"><a href="#GitHub-Repository-연결" class="headerlink" title="GitHub Repository 연결"></a>GitHub Repository 연결</h2><p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/github-img.png"></p>
<p>GitHub Repository에 </p>
<ul>
<li>micoroservice-a-default.yml</li>
<li>micoroservice-a-dev.yml</li>
</ul>
<p>아래 처럼 작성합니다.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">application:</span></span><br><span class="line">  <span class="attr">message:</span> <span class="string">&quot;Message From &#123;ENV&#125; Local Git Repository&quot;</span></span><br></pre></td></tr></table></figure>
<p><code>&#123;ENV&#125;</code>에 ddefault, dev 환경에 맞는 값을 작성합니다.</p>
<h2 id="Config-Server"><a href="#Config-Server" class="headerlink" title="Config Server"></a>Config Server</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;org.springframework.cloud:spring-cloud-config-server&#x27;</span></span><br><span class="line">implementation <span class="string">&#x27;org.springframework.boot:spring-boot-starter-actuator&#x27;</span></span><br></pre></td></tr></table></figure>
<p>config server 의존 성을 추가합니다. actuator도 편의를 위해서 추가합니다.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8888</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;config-server&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">server:</span></span><br><span class="line">        <span class="attr">git:</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">&quot;https://github.com/cheese10yun/msa-study-sample&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>config server는 8888 port를 사용하는 관례가 있어 port를 8888로 지정합니다. Github Repository URI 주소를 입력합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigServerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    SpringApplication.run(ConfigServerApplication.class, args);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@EnableConfigServer</code> 어노테이션을 추가만 하면 별다른 설정없이 Config Server가 설정됩니다. </p>
<p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/intellj-actuator.png"><br>actuator 의존성이 있으면 IntellJ Endpoints -&gt; Mappings에서 현재 서버의 API mapping 정보를 쉽게 확인할 수 있습니다.</p>
<p>마우스 왼쪽 클릭을 한 이후에 Open In Http Request…를 클릭하면 쉽게 HTTP 콜을 할 수 있습니다.</p>
<p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/http-call.png"></p>
<p>URL 형식은 &#x2F;{appliation-name}&#x2F;{profile}&#x2F;{label}입니다. 위에서 등록한 <code>micoroservice-a-default.yml</code>을 확인해보기 위해서 <code>http://localhost:8888/microservice-a/default</code>을 호출합니다.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;microservice-a&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;profiles&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;default&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c03eecc5d8eabefc4b2a8f085789f42bd5317366&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;state&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;propertySources&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://github.com/cheese10yun/msa-study-sample/microservice-a-default.yml&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;application.message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Message From Default Local Git Repository&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>응답 값을 보면 해당 properties를 잘 읽어 오는 것을 확인할 수 있습니다. </p>
<p><code>http://localhost:8888/microservice-a/dev</code>을 호출하면 <code>micoroservice-a-dev.yml</code>의 값을 제대로 읽어 오는지 확인할 수 있습니다.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;microservice-a&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;profiles&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;dev&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c03eecc5d8eabefc4b2a8f085789f42bd5317366&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;state&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;propertySources&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://github.com/cheese10yun/msa-study-sample/microservice-a-dev.yml&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;application.message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Message From Default Dev Git Repository&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    implementation <span class="string">&#x27;org.springframework.cloud:spring-cloud-config-client&#x27;</span></span><br><span class="line">    implementation <span class="string">&#x27;org.springframework.boot:spring-boot-starter-actuator&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>필요한 의존성을 추가합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;application&quot;)</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>프로퍼티를 읽을 ConfigurationProperties 객체를 만듭니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WelcomeController</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> ApplicationConfiguration applicationConfiguration;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/message&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">welcome</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;message&quot;</span>, applicationConfiguration.getMessage());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>해당 메시지를 확인할 수 있는 컨트롤러를 만듭니다. <code>getMessage()</code> 메시지는 각 환경마다 다른 메시지를 출력합니다.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> &#123;<span class="string">ENV</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">http://localhost:8888</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">microservice-a</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>파일명은 <code>bootstrap.yml</code>으로 지정합니다. <code>active</code>는 각 환경마다 지정합니다. dev으로 지정하고 <code>http://127.0.0.1:8080/message</code> API를 호출해보겠습니다.</p>
<p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/message-call.png"></p>
<p>이것도 인텔리제이를 이용해서 호출하면 간편합니다.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Message From Default Dev Git Repository&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><code>Dev</code> 메시지가 출력되는 것을 확인 할 수 있습니다. <code>profiles</code>을 <code>default</code> 으로 지정하면 메시지에는 local 이라는 문자가 출력됩니다.</p>
<h2 id="Refresh"><a href="#Refresh" class="headerlink" title="Refresh"></a>Refresh</h2><p>마이크로서비스 A의 properties의 변경이 생겼을 경우 Refresh API를 호출해서 설정을 변경할 수 있다.</p>
<p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/json-1.png"></p>
<p>message API를 호출하면 기존 메시지가 그대로 출력된다.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># microservice-a-default.yml</span></span><br><span class="line"><span class="attr">application:</span></span><br><span class="line">  <span class="attr">message:</span> <span class="string">&quot;Message From Default Local Git Repository (Properties update...)&quot;</span></span><br></pre></td></tr></table></figure>
<p><code>microservice-a-default.yml</code> 메시지를 위와 같이 변경한 이후에 </p>
<p>POST <a target="_blank" rel="noopener" href="http://127.0.0.1:8080/actuator/refresh%EC%9D%84">http://127.0.0.1:8080/actuator/refresh을</a> 호출하면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &quot;config.client.version&quot;,</span><br><span class="line">  &quot;application.message&quot;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>Response으로 application.message의 변경을 알려준다. 이후 message api를 호출하면 아래 그림처럼 변경된 Response를 확인 할 수 있다.</p>
<p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/json-2.png"></p>
<h2 id="정리"><a href="#정리" class="headerlink" title="정리"></a>정리</h2><p>Github Repository와 같은 버전 관리 리포지토리로 백업된 중앙 집중 구성으로 properties를 제공해줍니다. 또 Properties 설정 및 단순한 설정으로 클라이언트 애플리케이션이 스프링 클라우드 컨피그 서버에 쉽게 연결되도록 지원해줍니다.</p>
<h1 id="Spring-Cloud-Bus"><a href="#Spring-Cloud-Bus" class="headerlink" title="Spring Cloud Bus"></a>Spring Cloud Bus</h1><p>프로덕션 환경에서 실행중인 마이크로서비스 A의 인스턴스가 N대가 있을 경우에는 설정을 변경하기 위해서는 <code>POST http://127.0.0.1:8080/actuator/refresh</code> 요청을 N대의 인스턴스 서버에 N번의 refresh API를 호출 해야한다. 이는 번거러울 뿐만 아니라 실수를 유발하기 쉬운 구조이다.</p>
<h2 id="스프링-클라우드-버스를-시용한-변경-전파"><a href="#스프링-클라우드-버스를-시용한-변경-전파" class="headerlink" title="스프링 클라우드 버스를 시용한 변경 전파"></a>스프링 클라우드 버스를 시용한 변경 전파</h2><p>스프링 클라우 버스를 사용해서 Rabbit MQ 같은 메시지 브로커를 통해 변경 사항을 여러 인스턴스에 전달할 수 있다.</p>
<p>각 마이크로서비스의 인스턴스는 애플리케이션 구동시에 스프링 클라우드 버스에 등록한다. 마이크로서비스의 인스턴스 중 하나에 refresh가 호출되면 스프링 클라우드 버스는 모든 마이크로서비스 인스턴스에 변경 이벤트를 전달하게 된다. </p>
<h2 id="Rabbit-MQ-설치"><a href="#Rabbit-MQ-설치" class="headerlink" title="Rabbit MQ 설치"></a>Rabbit MQ 설치</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── config-server</span><br><span class="line">├── docker-compose.yaml</span><br><span class="line">├── microservice-a</span><br><span class="line">├── microservice-a-default.yml</span><br><span class="line">├── microservice-a-dev.yml</span><br><span class="line">├── service-consumer</span><br><span class="line">├── static</span><br><span class="line">└── volumes</span><br></pre></td></tr></table></figure>
<p>프로젝트 루트 디렉토리에 volumes 디렉토리를 만들고, gitginore를 추가 해줍니다. 해당 디렉토리에 docker rabbmit mq가 저장됩니다.</p>
<p><code>docker-compose.yaml</code>  파일은 아래와 같이 준비 해줍니다.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">bus.rabbitmq</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">rabbitmq:3.7-management</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5672:5672&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;15672:15672&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_USER</span> <span class="string">=</span> <span class="string">user</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_PASS</span> <span class="string">=</span> <span class="string">user</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">bus</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./volumes/bus-rabbitmq:/var/lib/rabbitmq</span></span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd 프로젝트 루트 디렉토리</span><br><span class="line">$ docker-compose -up -d</span><br></pre></td></tr></table></figure>

<h2 id="Client-1"><a href="#Client-1" class="headerlink" title="Client"></a>Client</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    implementation <span class="string">&#x27;org.springframework.cloud:spring-cloud-starter-bus-amqp&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>필요한 의존성을 추가합니다.</p>
<p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/bus-log.png"><br>서버가 시작될때 스프링 클라우드 버스에 등록되고, 클라우드 버스의 이벤트를 수신하게 됩니다. Rabbmit MQ 커넥션은 자동으로 연결됩니다. (스프링 너란 자식….)</p>
<p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/intellj-port-2.png"></p>
<p>포트를 8080, 8081을 설정해서 2대의 서버를 구동 시킵니다.</p>
<h2 id="Bus-Refresh"><a href="#Bus-Refresh" class="headerlink" title="Bus Refresh"></a>Bus Refresh</h2><p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/bus-mapping.png"></p>
<p><code>microservice-a-default.yml</code>을 아래처럼 변경합니다.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">application:</span></span><br><span class="line">  <span class="attr">message:</span> <span class="string">&quot;Message From Default Local Git Repository (Spring Cloud Bus)&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>/bus/refresh</code> API가 추가되 었습니다. 해당 API를 호출합니다. (8081을 호출해도 됩니다.)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://localhost:8080/bus/refresh</span><br></pre></td></tr></table></figure>

<p>refresh 호출 이후에 message를 호출합니다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET http://localhost:8081/message</span><br></pre></td></tr></table></figure>
<p>8080 refresh를 호출하더라도 다른 8081 서버도 반영되는 것을 확인할 수 있습니다.</p>
<p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/8081-result.png"></p>
<h1 id="Eureka"><a href="#Eureka" class="headerlink" title="Eureka"></a>Eureka</h1><h2 id="네임-서버"><a href="#네임-서버" class="headerlink" title="네임 서버"></a>네임 서버</h2><p>마이크로서비스 아키텍처는 서로 상호 작용하는 더 작은 마이크로서비스가 필요 하다. 이 밖에도 각 마이크로서비스의 인스턴스가 여러 개 있을 수 있다. 마이크로서비스의 새로운 인스턴스가 동적으로 생성되고 파괴되면 외부 서비스의 연결 및 구성을 수동으로 유지하는 것이 어려울 수 있다. <strong>네임 서버는 서비스 등록 및 서비스 검색 기능을 제공한다.</strong> 네임 서버는 마이크서비스가 이들 자신을 등록할 수 있게 하고, 상호 작용하고자 하는 다른 마이크러서비스에 대한 URL을 찾을 수 있게 도와준다.</p>
<h2 id="URL-하드-코딩의-한계"><a href="#URL-하드-코딩의-한계" class="headerlink" title="URL 하드 코딩의 한계"></a>URL 하드 코딩의 한계</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">microservice-a:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">listOfServers:</span> <span class="string">http://localhost:8080,http://localhost:8081</span></span><br></pre></td></tr></table></figure>
<ul>
<li>마이크로서비스 A의 새 인스턴스가 생성된다.</li>
<li>마이크로서비스 A의 기존 인스턴스는 더 이상 사용할 수 없다.</li>
<li>마이크로서비스 A가 다른 서버로 이동됐다.</li>
</ul>
<p>이런 모든 경우에 구성을 업데이트해야 하며, 변경 사항을 적용하기 위해서는 마이크로서비스가 새로 고쳐져야 한다.</p>
<h2 id="네임-서버-작동"><a href="#네임-서버-작동" class="headerlink" title="네임 서버 작동"></a>네임 서버 작동</h2><p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/name-server.png"></p>
<ul>
<li><strong>모든 마이크로서비스는 각 마이크로서비스가 시작될때 네임 서버에 등록한다.</strong></li>
<li>서비스 소비자가 특정 마이크로 서비스의 위치를 얻으려면 네임 서버를 요청해야한다.</li>
<li>고유한 마이크로서비스 ID가 각 마이크로서비스에 지정된다. 이것을 등록 요청 및 검색 요청에서 키로 사용된다.</li>
<li>마이크로서비스는 자동으로 등록 및 등록 취소할 수 있다.</li>
<li>서비스 소비자가 마이크로서비스ID로 네임 서버를 찾을 때마다 해당 특정 마이크로서비스의 인스턴스 목록을 가져온다.</li>
</ul>
<h2 id="구현"><a href="#구현" class="headerlink" title="구현"></a>구현</h2><h3 id="유레카-서버-설정"><a href="#유레카-서버-설정" class="headerlink" title="유레카 서버 설정"></a>유레카 서버 설정</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation &#x27;org.springframework.cloud:spring-cloud-starter-netflix-eureka-client&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>필요한 디펜던시를 추가합니다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EurekaServerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    SpringApplication.run(EurekaServerApplication.class, args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8761</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h3 id="유레카-마이크로-서비스-등록"><a href="#유레카-마이크로-서비스-등록" class="headerlink" title="유레카 마이크로 서비스 등록"></a>유레카 마이크로 서비스 등록</h3><p>기존에 서비스들을 유레카 서버에게 접속할 수있도록 서비스 등록 작업을 진행합니다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation &#x27;org.springframework.cloud:spring-cloud-starter-netflix-eureka-client&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MicroserviceAApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    SpringApplication.run(MicroserviceAApplication.class, args);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>의존성 추가 및 <code>@EnableDiscoveryClient</code> 어노테이션 추가합니다. </p>
<h3 id="유레카와-마이크로-서비스-연결"><a href="#유레카와-마이크로-서비스-연결" class="headerlink" title="유레카와 마이크로 서비스 연결"></a>유레카와 마이크로 서비스 연결</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#microservice-a:</span></span><br><span class="line"><span class="comment">#  ribbon:</span></span><br><span class="line"><span class="comment">#    listOfServers: http://localhost:8080,http://localhost:8081</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients(&quot;com.cloud.serviceconsumer&quot;)</span> <span class="comment">// 어노테이션 추가</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceConsumerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    SpringApplication.run(ServiceConsumerApplication.class, args);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>마이크로서비스A의 URL을 하드 코딩했을 경우 추가적인 서버 증성작업이 어렵다. 서비스 소비자 마이크로서비스가 유레카 서비스로부터 URL을 알아낼 수 있어야한다. 하드코딩된 URL정보를 주석처리 하고 아래의 어노테이션을 추가하면 된다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(name = &quot;microservice-a&quot;)</span></span><br><span class="line"><span class="meta">@RibbonClient(name = &quot;microservice-a&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RandomServiceProxy</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/random&quot;)</span></span><br><span class="line">  List&lt;Integer&gt; <span class="title function_">getRandomNumbers</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="동작-순서"><a href="#동작-순서" class="headerlink" title="동작 순서"></a>동작 순서</h3><ol>
<li>마이크로서비스 A의 각 인스턴스가 시작되면 유레카 네임 서버에 등록한다.</li>
<li>서비스 소비자 마이크로서비스는 마이크로서비스 A의 인스턴스에 대해 유레카 네임 서버를 요청한다.</li>
<li>서비스 소비자 마이크로서비스는 립본 클라이언트-클라이언트 로드 밸런서를 사용해 소출할 마이크로서비스 A의 특정 인스턴스를 결정한다.</li>
<li>서비스 소비자 마이크로서비스는 마이크로서비스 A의 특정 인스턴스를 호출한다.</li>
</ol>
<p>유레카의 가장 큰 장점은 서비스 소비자 마이크로서비스가 마이크로서비스 A와 분리된다는 것이다. 서비스 소비자 마이크로서비스는 마이크로서비스 A의 새로운 인스턴스가 나타나거나 기존 인스턴스가 디운될 때마다 재구성할 필요가 없다.</p>
<p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/eureka-dashboard.png"><br>유레카 데시보드에서 여러 마이크로서비스를 확인 할 수 있다.</p>
<h1 id="Ribbon"><a href="#Ribbon" class="headerlink" title="Ribbon"></a>Ribbon</h1><h2 id="로드-밸런싱"><a href="#로드-밸런싱" class="headerlink" title="로드 밸런싱"></a>로드 밸런싱</h2><p>마이크로서비스는 클라우드-네이티브 아키텍처의 가장 중요한 빌딩 블록이다. 마이크로서비스 인스턴스는 특정 마이크로서비스의 로드에 따라 확대 및 축소된다. 부하가 마이크로서비스의 다른 인스턴스 간에 똑같이 분산되도록 하려면 로드밸런싱의 기술피 필수이다. 로드 밸런싱은 로드가 마이크로서비스의 다른 인스턴스간에 균등하게 분배하도록 도와준다.</p>
<h2 id="Ribbon-구성"><a href="#Ribbon-구성" class="headerlink" title="Ribbon 구성"></a>Ribbon 구성</h2><p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/ribbon.png"></p>
<p>스프링 클라우드 넷플릭스 립본은 마이크로서비스의 다른 인스턴스 간에 라운드 로빈 실행을 사용해 <strong>클라이언트-사이드 로드 밸런싱을 제공한다.</strong></p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    implementation <span class="string">&#x27;org.springframework.cloud:spring-cloud-starter-netflix-ribbon&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>필요한 의존성을 추가 합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(name = &quot;microservice-a&quot;)</span></span><br><span class="line"><span class="meta">@RibbonClient(name = &quot;microservice-a&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RandomServiceProxy</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/random&quot;)</span></span><br><span class="line">  List&lt;Integer&gt; <span class="title function_">getRandomNumbers</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>기존에 작성했던 RandomServiceProxy 인터페이스를 위와 같이 작성합니다. <code>FeignClient</code>도 서비스 네임만 기술합니다.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">microservice-a:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">listOfServers:</span> <span class="string">http://localhost:8080,http://localhost:8081</span></span><br></pre></td></tr></table></figure>
<p><code>microservice-a</code>의 서비스 url을 입력합니다.</p>
<p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/ribbon-result.png"></p>
<p>GET <a target="_blank" rel="noopener" href="http://127.0.0.1:8100/add%EC%9D%84">http://127.0.0.1:8100/add을</a> 호추랗면 아래와 같은 결과값을 응답 받습니다.</p>
<p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/ribbon-result2.png"></p>
<p>라운드 로빈 방식으로 random API 호출이 <a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a>, <a href="http://localhost:8081으로">http://localhost:8081으로</a> 분산되어 호출됩니다.</p>
<p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/msa-simple.png"></p>
<p>위과 같은 아키텍처 구성을 가지게 됩니다.</p>
<h1 id="선언적-Rest-클라이언트-Feign"><a href="#선언적-Rest-클라이언트-Feign" class="headerlink" title="선언적 Rest 클라이언트 - Feign"></a>선언적 Rest 클라이언트 - Feign</h1><p>페인은 최소한의 구성과 코드로, REST 서비스를 위한 REST 클라이언트를 쉽게 작성할 수 있습니다. 간단한 인터페이스로, 적절한 어노테이션을 사용하는 것이 특징입니다. </p>
<p>페인은 립본 및 유레카와 통합하여 사용하면 더욱 효율성이 높아지게 됩니다.</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    implementation <span class="string">&#x27;org.springframework.cloud:spring-cloud-starter-openfeign&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>필요한 의존성을 추가합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(name = &quot;micoservice-a&quot;, url = &quot;localhost:8080&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RandomServiceProxy</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/random&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">getRandomNumbers</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>서비스의 이름과 URL을 하드코딩 합니다. (유레카를 통해서 하드코딩된 부분을 제거할 수 있습니다.)</li>
<li>Controller 코드를 작성하듯이 작성합니다.</li>
<li>중요한 것은 이것은 인터페이스이며, 적절한 어노테이션 기반으로 동작한다는 것입니다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NumberAddController</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> RandomServiceProxy randomServiceProxy;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/add&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Long <span class="title function_">add</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> List&lt;Integer&gt; numbers = randomServiceProxy.getRandomNumbers();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> numbers.stream().mapToInt(number -&gt; number).asLongStream().sum();</span><br><span class="line">    log.warn(<span class="string">&quot;returning &quot;</span> + sum);</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>RandomServiceProxy 의존성을 받아 사용합니다.</li>
</ul>
<p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/fegin-result.png"><br>Feign 응답값을 확인할 수 있습니다.</p>
<h1 id="API-게이트웨이"><a href="#API-게이트웨이" class="headerlink" title="API 게이트웨이"></a>API 게이트웨이</h1><h2 id="마이크로-서비스의-문제점"><a href="#마이크로-서비스의-문제점" class="headerlink" title="마이크로 서비스의 문제점"></a>마이크로 서비스의 문제점</h2><ul>
<li>인증, 권한 부여 및 보안 : 모놀리식 서버에서는 인증 인가를 한 서버에서 책임지면 되는데 여러 서비스가 존재하는 마이크로서비스에서는 올바른 엑세스 보장을 어떻게할 것인가?</li>
<li>동적 라우팅은 어떻게 할 것인가?</li>
<li>내결합성: 하나의 마이크로서비스에서 오류가 발생해도 전체 시스템이 중단되지 않도록하면 어떻게 해야하는가 ?</li>
</ul>
<p>이러한 문제는 마이크로서비스가 서로 직접 대화할 때 개별 마이크로서비스에 의해 해결돼야한다. <strong>하지만 이런 아키텍처들은 위 우려들을 각 마이크로서비스가 다르게 처리할 수 있기 때문에 유지 관리가 어려울 수 있다.</strong></p>
<p>이려한 문제를 해결하기 가장 쉬운 것이 API 게이트웨이이다. 다음은 API 게이트가 제공하는 기능이다.</p>
<ul>
<li>인증 및 보안</li>
<li>속도 제한</li>
<li>모니터링</li>
<li>동적 라우팅 및 정적 응답 처리</li>
<li>로드 차단</li>
<li>여러 가지 서비스의 응답 집계</li>
</ul>
<h2 id="주울로-클라이언트-사이드-로드-밸런싱-구현"><a href="#주울로-클라이언트-사이드-로드-밸런싱-구현" class="headerlink" title="주울로 클라이언트 - 사이드 로드 밸런싱 구현"></a>주울로 클라이언트 - 사이드 로드 밸런싱 구현</h2><p>주을은 스프링 클라우드 넷플릭스 프로젝트의 일부다. 동적 라우팅, 모니터링, 필터링, 보안 등의 기능을 제공하는 API 게이트웨이 서비스다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation &#x27;org.springframework.cloud:spring-cloud-starter-netflix-eureka-client&#x27;</span><br><span class="line">    implementation &#x27;org.springframework.cloud:spring-cloud-starter-netflix-zuul&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableZuulProxy</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiGatewayApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    SpringApplication.run(ApiGatewayApplication.class, args);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;zuul-api-gateway&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8761/eureka</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8765</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>필요한 의존성, 유레카 클라이언트, API 게이트웨이 등록을 진행한다.</p>
<p><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/api-gateway-eureka.png"><br>서버를 실행하면 유레카에 등록된 것을 확인 할 수있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleLoggingFilter</span> <span class="keyword">extends</span> <span class="title class_">ZuulFilter</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">filterType</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;pre&quot;</span>; <span class="comment">// pre 사전 필터, route 원본으로 라우팅하기, post필터를 포스트라우팅, error 에러 처리</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">filterOrder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// 필터 우선순위</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">shouldFilter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 조건에 따른 필터 동작 여부, 해당 코드에서는 동작하기 위해서 true 리턴</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">run</span><span class="params">()</span> &#123; <span class="comment">// 필터에 대한 로직을 구현하는 방식, 아래 예제는 단순하게 로깅용</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">RequestContext</span> <span class="variable">context</span> <span class="operator">=</span> RequestContext.getCurrentContext();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> context.getRequest();</span><br><span class="line"></span><br><span class="line">    log.info(MessageFormat</span><br><span class="line">        .format(<span class="string">&quot;Request Method : &#123;0&#125; \n URL : &#123;1&#125; &quot;</span>, request.getMethod(),</span><br><span class="line">            request.getRequestURI()));</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET http://127.0.0.1:8765/microservice-a/random</span><br><span class="line">Accept: application/json</span><br><span class="line"></span><br><span class="line">GET http://127.0.0.1:8765/service-consumer/add</span><br><span class="line">Accept: application/json</span><br></pre></td></tr></table></figure>
<p>service-name&#x2F;url 을 호출할 경우 유레카에 등록되있는 서비스 정보를 기반으로 호출하게된다.<br><img src="https://github.com/cheese10yun/msa-study-sample/raw/master/static/api-gateway-eureka-result.png"></p>
<p><code>SimpleLoggingFilter</code> 잘 동작하는지 확인할 수 있다.</p>
<h2 id="필터"><a href="#필터" class="headerlink" title="필터"></a>필터</h2><ul>
<li>사전 필터: 주울에서 목표 대상에 대한 실제 요청이 발생하기 전에 호출된다. 일반적으로 사전 필터는 서비스의 일관된 메세지형식(HTTP 헤더의 포함여부)을 확이하는 작업을 수행하거나 서비스를 이용하는 사용자가 인증 및 인가되었는지 확인하는 게이이트키퍼 역할을 한다.</li>
<li>사후 필터: 대상 서비스를 호추랗고 응답을 클라이언트로 전송한 후 호출된다. 일반적으로 사후 필터는 대상 서비스의 응답을 로깅하거나 에러 처리, 민감정보에 대한 응답을 감시하는 목적으로 구현된다.</li>
<li>경로 필터: 대상 서비스가 호출되기 전에 호출을 가로체는 데 사용된다. 일반적으로 경로 필터는 일정 수준의 동적 라우팅 필요 여부를 결정하는 데 사용된다. 예를 들어 이 장 뒷부분에서 동일 서비스의 다른 두 버전을 라우팅할 수 있는 경로 단위 핉를 사용해 작은 호출 비율만 새 버전의 서비스로 라우팅할 수 있다.</li>
</ul>
<h3 id="필터-적용-패턴"><a href="#필터-적용-패턴" class="headerlink" title="필터 적용 패턴"></a>필터 적용 패턴</h3><ul>
<li>TrackingFilter: 주울에서 보내는 모든 요청에 연관된 상관관계 ID 여부를 확인하는 사전 필터다, 상관관계 ID는 고객 요청을 수행할 때 실행할 때 실행되는 모든 마이크로서비스에 전달되는 고유 ID이다. 상관관계 ID를 사용하면 특정 호출이 일련의 마이크로서비스를 통과할 때 발생하는 모든 이벤트 체인을 추적할 수 있다.</li>
<li>SpecialRoutesFilter: 유입되는 경로를 확인하고 해당 경로에 A&#x2F;B 테스팅 수행 여부를 결정하는 주울의 경로 필터다. </li>
<li>ResponseFilter: 서비스 호출과 연관된 상관관계 ID를 클라이언트 회신하는 HTTP 응답 헤더에 삽입하는 사후 필터다. 일반적으로 클라이언트는 호출한 요청과 연관된 상관관계 ID에 엑세스할 수 있다.</li>
</ul>
<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><ul>
<li><a target="_blank" rel="noopener" href="http://acornpub.co.kr/book/mastering-spring-5.0">스프링 5.0 마스터</a></li>
<li><a target="_blank" rel="noopener" href="http://www.yes24.com/Product/Goods/67473377">스프링 마이크로 서비스 코딩 공작소</a></li>
</ul>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">태그</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/MSA/" rel="tag">MSA</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Spring/" rel="tag">Spring</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/spring-transacion-same-bean/"
                    data-tooltip="Spring 동일한 Bean(Class)에서 @Transactional 동작 방식"
                    aria-label="이전: Spring 동일한 Bean(Class)에서 @Transactional 동작 방식"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/intellij-code-review/"
                    data-tooltip="인텔리제이 Github Code Review"
                    aria-label="다음: 인텔리제이 Github Code Review"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-cloud/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-cloud/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://cheese10yun.github.io/spring-cloud/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>


<!-- Comment -->
<!--  utteranc comment -->

<script src="https://utteranc.es/client.js"
        repo="cheese10yun/blog-comment"
        issue-term="title"
        label="Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Yun. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/spring-transacion-same-bean/"
                    data-tooltip="Spring 동일한 Bean(Class)에서 @Transactional 동작 방식"
                    aria-label="이전: Spring 동일한 Bean(Class)에서 @Transactional 동작 방식"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/intellij-code-review/"
                    data-tooltip="인텔리제이 Github Code Review"
                    aria-label="다음: 인텔리제이 Github Code Review"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-cloud/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-cloud/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://cheese10yun.github.io/spring-cloud/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-cloud/"
                        aria-label="Facebook에 공유하기"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Facebook에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-cloud/"
                        aria-label="Twitter에 공유하기"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Twitter에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://cheese10yun.github.io/spring-cloud/"
                        aria-label="Google+에 공유하기"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Google+에 공유하기</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
            <h4 id="about-card-name">Yun</h4>
        
            <div id="about-card-bio"><p>기술 블로그</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
