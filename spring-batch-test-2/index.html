
<!DOCTYPE html>
<html lang="ko">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="naver-site-verification" content="a37ea649edf26e70c3de94f9cb034f9d6e11de3f" />
    <meta name="generator" content="Yun Blog">
    <title>Spring Batch Test 작성 방법 및 고찰 - Yun Blog</title>
    <meta name="author" content="Yun">
    
        <meta name="keywords" content="Node,Spring,Spring Boot,Spring Batch,Kotlin,기술 블로그,JPA,Mongo,MySQL,OOP,">
    
    
    
        
            <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss2.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg"},"articleBody":"Spring Batch Test Code\n스프링 배치 애플리케이션 테스트 코드를 작성하면서 만났던 이슈와 그에 따른 나름의 고찰을 정리한 포스팅 내용입니다. 배치를 사용하지 않더라도 스프링 기반으로 테스트를 작성하는 경우에도 도움 되는 내용들이 있습니다.\n@SpringBatchTest\nSpring Batch 4.1 버전 부터는 @SpringBatchTest Annotation을 지원합니다.\n123456789101112131415161718192021222324252627282930313233@RunWith(SpringRunner.class)@SpringBatchTest@ContextConfiguration(classes = &#123;JobConfiguration.class&#125;)public class JobTest &#123;    @Autowired    private JobLauncherTestUtils jobLauncherTestUtils;    @Autowired    private JobRepositoryTestUtils jobRepositoryTestUtils;    @Before    public void clearMetadata() &#123;        jobRepositoryTestUtils.removeJobExecutions();    &#125;    @Test    public void testJob() throws Exception &#123;        // given        JobParameters jobParameters =            jobLauncherTestUtils.getUniqueJobParameters();        // when        JobExecution jobExecution =            jobLauncherTestUtils.launchJob(jobParameters);        // then        Assert.assertEquals(ExitStatus.COMPLETED,            jobExecution.getExitStatus());    &#125;&#125;\n\nJobLauncherTestUtils : 스프링 배치 테스트에 필요한 유틸 기능\nJobRepositoryTestUtils : 데이터베이스에 저장된 JobExcution을 생성/삭제 지원\nStepScopeTestExecutionListener : 배치 단위 테스트 시 StepScope 컨텍스트를 생성, 해당 컨텍스트를 통해 JobParamerter 등을 단위 테스트에서 DI 받을 수 있음\nJobSopceTestExecutionListener : 배치 단위 테스트 시 JobScope 컨텍스트를 생성, 해당 컨텍스트를 통해 JobParameter 등을 단위 테스트에서 DI 받을 수 있음\n\n@SpringBatchTest으로 위 코드를 자동으로 구성할 수 있습니다.\nSpring Batch Test Support 만들기\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778@SpringBootTest@SpringBatchTest@TestInstance(TestInstance.Lifecycle.PER_CLASS)@TestConstructor(autowireMode = TestConstructor.AutowireMode.ALL)@ActiveProfiles(&quot;test&quot;)abstract class BatchTestSupport &#123;    @Autowired    protected lateinit var entityManagerFactory: EntityManagerFactory    @Autowired    protected lateinit var jobLauncherTestUtils: JobLauncherTestUtils    protected val entityManager by lazy &#123; entityManagerFactory.createEntityManager() &#125;    protected var jobExecution: JobExecution? = null    protected val query: JPAQueryFactory by lazy &#123; JPAQueryFactory(entityManager) &#125;    protected fun launchJob(        job: Job,        jobParameters: JobParameters = jobLauncherTestUtils.uniqueJobParameters    ) &#123;        jobLauncherTestUtils.job = job        this.jobExecution = jobLauncherTestUtils.launchJob(jobParameters)    &#125;    protected fun launchStep(        stepName: String,        jobParameters: JobParameters = jobLauncherTestUtils.uniqueJobParameters,        executionContext: ExecutionContext? = null    ) &#123;        this.jobExecution = jobLauncherTestUtils.launchStep(stepName, jobParameters, executionContext)    &#125;    protected fun thenBatchCompleted() &#123;        then(BatchStatus.COMPLETED).isEqualTo(jobExecution?.status)    &#125;    protected fun thenBatchStatus(batchStatus: BatchStatus) &#123;        then(batchStatus).isEqualTo(jobExecution?.status)    &#125;    protected fun &lt;T&gt; save(entity: T): T &#123;        entityManager.transaction.let &#123; transaction -&gt;            transaction.begin()            entityManager.persist(entity)            transaction.commit()            entityManager.clear()        &#125;        return entity    &#125;    protected fun &lt;T&gt; saveAll(entities: List&lt;T&gt;): List&lt;T&gt; &#123;        val entityManager = entityManagerFactory.createEntityManager()        entityManager.transaction.let &#123; transaction -&gt;            transaction.begin()            for (entity in entities) &#123;                entityManager.persist(entity)            &#125;            transaction.commit()            entityManager.clear()        &#125;        return entities    &#125;    protected fun &lt;E&gt; List&lt;E&gt;.persist() &#123;        saveAll(this)    &#125;    protected fun &lt;T&gt; deleteAll(path: EntityPath&lt;T&gt;) &#123;        entityManager.transaction.let &#123; transaction -&gt;            transaction.begin()            query.delete(path).execute()            transaction.commit()        &#125;    &#125;&#125;\n배치 애플리케이션의 테스트를 도와주는 유틸성 클래스, 테스트 코드를 효율적으로 작성할 수 있게 지원합니다. 어떤 기능들이 있고, 이 기능들이 어떤 불편한 점 때문에 추가했는지에 대해서 설명을 진행하겠습니다.\n테스트 Job 실행은?\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748abstract class BatchTestSupport &#123;    @Autowired    protected lateinit var jobLauncherTestUtils: JobLauncherTestUtils    ...    protected fun launchJob(        job: Job,        jobParameters: JobParameters = jobLauncherTestUtils.uniqueJobParameters    ) &#123;        jobLauncherTestUtils.job = job        this.jobExecution = jobLauncherTestUtils.launchJob(jobParameters)    &#125;&#125;internal class CsvWriterConfigurationTest(    private val csvWriterJob: Job,) : BatchTestSupport() &#123;    @Test    internal fun `csvWriterJob test`() &#123;        //given        ...        //when        launchJob(csvWriterJob)        //then        ...    &#125;    @Autowired    protected lateinit var jobLauncherTestUtils: JobLauncherTestUtils    @Test    internal fun `csvWriterJob test 슈퍼 클래스에 없는 경우 직접 DI 받아 job을 실헹 해야한다`() &#123;        //given        ...        //when        jobLauncherTestUtils.job = job        jobLauncherTestUtils.launchJob(job)        //then        ...    &#125;&#125;\n배치 테스트를 위해서는 Job을 실행시켜야 합니다. 이것을 편리하게 도와주는 것이 launchJob()메서드입니다. JobLauncherTestUtils의 launchJob() 메서드를 한 번 감싸서 사용하는 용도로 특별하건 없습니다. 슈퍼 클래스에서 의존성을 주입받지 않으면 실제 테스트에 계속 DI를 받아 사용해야 하기 때문에 슈퍼 클래스에서 해당 기능을 제공합니다. JobParameters가 필요한 경우 JobParameters를 전달하면 됩니다. 그렇지 않은 경우에는 스프링 배치에서 자체적으로 유니크한 JobParameters을 생성하는 기본값을 지정했습니다.\n특정 Step만 테스트하고 싶은 경우는 ?\n123456789101112131415161718@Beanfun sampleJob(    jobBuilderFactory: JobBuilderFactory,    step1: Step,    step2: Step,    step3: Step,    step4: Step,    step5: Step,): Job =    jobBuilderFactory[&quot;csvWriterJob&quot;]        .incrementer(RunIdIncrementer())        .listener(JobReportListener())        .start(step1)        .next(step2)        .next(step3)        .next(step4)        .next(step5)        .build()\n단순한 Job의 경우에는 Step이 여러개로 구성되어 있는 경우는 특정 Step만 테스트를 진행하는 단위 테스트가 필요할 수 있습니다.\n12345678910111213141516171819202122232425262728abstract class BatchTestSupport &#123;    ...    protected fun launchStep(        job: Job,        stepName: String,        jobParameters: JobParameters = jobLauncherTestUtils.uniqueJobParameters,        executionContext: ExecutionContext? = null    ) &#123;        this.jobExecution = jobLauncherTestUtils.launchStep(stepName, jobParameters, executionContext)    &#125;&#125;internal class CsvWriterConfigurationTest(    private val csvWriterJob: Job,) : BatchTestSupport() &#123;        @Test    internal fun `csvWriterStep test`() &#123;        //given        ...        //when        launchStep(csvWriterJob, &quot;csvWriterStep&quot;)        //then        ...    &#125;&#125;\nStep 테스트도 마찬가지로 jobLauncherTestUtils.launchStep() 메서드를 활용해서 특정 Step을 실행할 수 있습니다. 개인적으로는 launchStep() 테스트를 진행하는 것은 좋아하지는 않습니다.\n\nJob name이 name=TestJob 이것을 확인할 수 있습니다. Step을 테스트하기 위해서는 반드시 Job이 있어야 하기 때문에 TestJob으로 연결해서 테스트를 진행하는 것입니다. 이렇게 테스트가 진행되게 되면 문제가 있을 수 있습니다.\n1234567891011121314151617181920212223242526class SimpleJobListener : JobExecutionListener &#123;    private val log by logger()    override fun beforeJob(jobExecution: JobExecution) &#123;        log.info(&quot;beforeJob&quot;)    &#125;    override fun afterJob(jobExecution: JobExecution) &#123;        log.info(&quot;afterJob&quot;)    &#125;&#125;@Configurationclass CsvWriterJobConfiguration &#123;    @Bean    fun csvWriterJob(        jobBuilderFactory: JobBuilderFactory,        csvWriterStep: Step    ): Job =        jobBuilderFactory[&quot;csvWriterJob&quot;]            .incrementer(RunIdIncrementer())            .listener(SimpleJobListener())            .start(csvWriterStep)            .build()&#125;\n위 코드처럼 SimpleJobListener로 Job 시작 이전, 이후로 log를 찍는 리스너를 추가하고 launchStep(&quot;csvWriterStep&quot;) Step을 실행시키면 리스너는 동작하지 않습니다. 반면 launchJob(csvWriterJob)은 잘 동작합니다.\n\nlaunchJob(csvWriterJob) Log\n\n\n\nlaunchStep(“csvWriterStep”) Log\n\n\n리스너는 Job에 연결이 된다는 것이지 Step에 연결돼있는 것은 아니며, 위에서 언급했듯 launchStep()은 name=TestJob으로 Job을 실행시키기 때문에 해당 잡에는 리스너가 없어 당연한 결과입니다.\n해당 코드는 단순하게 리스너로 로직을 것이지만 해당 Step에 필요한 리스너라면 예상했던 테스트 결과와 다르게 동작할 수 있습니다. 이러한 문제 때문에 저는 아래와 같은 방식으로 Step 테스트합니다.\n123456789101112131415161718192021222324internal class CsvWriterConfigurationTest(    private val csvWriterJob: Job,    csvWriterStep: Step,    jobBuilderFactory: JobBuilderFactory,) : BatchTestSupport() &#123;    private val job = jobBuilderFactory[&quot;csvWriterStepForTestJob&quot;]        .incrementer(RunIdIncrementer())        .listener(SimpleJobListener())        .start(csvWriterStep)        .build()    @Test    internal fun `csvWriterStep job을 직접 생성해서 테스트`() &#123;        //given        ...        //when        launchJob(job)        //then        ...    &#125;&#125;\n위 코드는 실제 Job을 생성하고 해당 Job으로 launchJob()메서드를 통해서 Job을 실행시키고 있습니다.\n\n해당 결과 리스너의 로그 및 Job name이 name=csvWriterStepForTestJob으로 테스트를 진행하는 것을 확인할 수 있습니다.\n그 밖에도 Job을 직접 생성할 수 있으니 다양한 방법으로 테스트를 진행할 수 있습니다. 예를 들어 특정 step 몇 개를 연결해서 단위 테스트해볼 수 있으며, Flow와 같은 배치 Step의 순서에 대한 Flow를 직접 정의해서 테스트할 수 있습니다.\n테스트 데이터 세팅은?\n배치 애플리케이션 여러 여러 테이블의 데이터를 읽어 오고, 여러 테이블에 데이터를 저장하는 경우가 빈번합니다. 이런 경우 테스트를 작성하기 위한 given절에 해당하는 데이터 세팅이 많이 번거롭습니다.\nJPA 기반 세팅\n테스트를 진행할 때 given을 JPA 기반으로 작성하기 위해서는 Repositroy를 주입받아 save 해서 테스트하는 것이 일반적입니다. 위에서도 언급했지만 여러 테이블의 조회가 필요하니 그 필요한 테이블만큼 Repositroy를 주입 받아야 하는데 이것이 생각보다 귀찮고 코딩의 흐름을 방해합니다.\n테스트 코드를 작성하다 ‘아 데이터가 필요하네…’ 하고 다시 테스트 클래스 상위로 올라가 필요한 Repositroy를 주입받고 다시 save를 진행하는 것은 코딩의 흐름을 많이 방해한다고 생각합니다.\n123456789101112131415161718192021222324252627282930abstract class BatchTestSupport &#123;    @Autowired    protected lateinit var entityManagerFactory: EntityManagerFactory    protected val entityManager by lazy &#123; entityManagerFactory.createEntityManager() &#125;    protected fun &lt;T&gt; save(entity: T): T &#123;        entityManager.transaction.let &#123; transaction -&gt;            transaction.begin()            entityManager.persist(entity)            transaction.commit()            entityManager.clear()        &#125;        return entity    &#125;    protected fun &lt;T&gt; saveAll(entities: List&lt;T&gt;): List&lt;T&gt; &#123;        val entityManager = entityManagerFactory.createEntityManager()        entityManager.transaction.let &#123; transaction -&gt;            transaction.begin()            for (entity in entities) &#123;                entityManager.persist(entity)            &#125;            transaction.commit()            entityManager.clear()        &#125;        return entities    &#125;&#125;\n위에서 언급한 문제를 해결하기 위해서 BatchTestSupport는 해당 기능을 제공합니다. EntityManagerFactory를 주입받아 EntityManager를 직접 생성하여 해당 매니저로 트랜잭션을 진행시켜 필요한 데이터를 세팅합니다.\n12345678910111213141516171819202122232425262728293031323334353637383940414243internal class CsvWriterConfigurationTest(    private val csvWriterJob: Job,    private val paymentRepository: PaymentRepository    ...) : BatchTestSupport() &#123;    @Test     internal fun `csvWriterJob repositroy를 DI 받아 테스트 진행`() &#123;        //given        (1..10).map &#123;            Payment(                amount = it.toBigDecimal(),                orderId = it.toLong()            )        &#125;            .also &#123;                paymentRepository.saveAll(it)            &#125;        //when        launchJob(csvWriterJob)        //then        ...    &#125;    @Test    internal fun `csvWriterJob test`() &#123;        //given        (1..10).map &#123;            Payment(                amount = it.toBigDecimal(),                orderId = it.toLong()            )        &#125;            .persist()        //when        launchJob(csvWriterJob)        //then        ...    &#125;\n위 테스트 코드는 Repositroy를 주입받아 테스트, BatchTestSupport를 기반으로 테스트하는 코드입니다. 해당 코드는 단순하지만 테스트에 필요한 Repositroy가 많아지면 BatchTestSupport 기반으로 테스트하는 것이 효율적입니다.\nSQL 기반 세팅\n프로젝트가 JPA 기반으로 진행하고 있다면 코드 냥이 많아 지나더라도 JPA 기반으로 테스트하는 것이 장기적으로 좋다고 생각한다. 하지만 JPA로 데이터 셋업이 번거롭고, 특정 시점으로 데이터를 Set Up 하기에는 어려운 부분이 있다. 그런 경우 유용한 방법이 @Sql을 기반으로 데이터를 세팅하는 것이다.\n123456insert into payment (amount, order_id)values (100, 1),       ...       (100, 1),       (100, 1);\n12345678910111213@Test@Sql(&quot;/csv-setup.sql&quot;)internal fun `csvWriterJob sql 테스트 진행`() &#123;    //given    //when    launchJob(csvWriterJob)    //then    thenBatchCompleted()    deleteAll(QPayment.payment)&#125;\n/test/resources/csv-setup.sql 해당 경로에 SQL 파일을 위치시키고 @Sql으로 해당 경로를 지정하면 해당 SQL 기반으로 데이터를 세팅합니다. @Sql는 테스트 메서드 단위로 실행되기 때문에 편리하지만 SQL의 단순 문자열 기반으로 관리되기 때문에 엔티티가 변경되는 경우 유지 보수가 어려운 부분들이 있습니다. 해당 엔티티가 변경될 일이 거의 없거나. 데이터의 특정 시점을 객체 기반으로 만들기 어려운 경우 사용하는 것을 권장합니다.\n테스트 검증은?\n테스트 검증 시 여러 테이블에 대한 변경 작업이 발생했을 경우 모든 변경에 대한 테스트를 작성해야 합니다. 우선 then에서 검증할 엔티티의 개수만큼 Repositroy를 주입받아야 합니다. 이는 위에서도 언급했듯이 코딩의 흐름에 악영향을 미칩니다. 무엇보다 테스트 검증을 위한 조회를 Repositroy를 의존하게 되면 오직 테스트 코드 검증을 위한 조회 로직이 필요하게 됩니다.\n12345678910111213@Testinternal fun `csvWriterJob 테스트 코드만을 위한 코드`() &#123;    //given    //when    launchJob(csvWriterJob)    //then    thenBatchCompleted()    paymentRepository.findByxxxxx() // 오직 테스트 코드엑서만 사용한다    deleteAll(QPayment.payment)&#125;\n위 테스트의 검증은 paymentRepository 기반으로 진행하고 있습니다. 그런데 검증을 위해 조회 코드가 없어 만들려고 하는데 이 코드는 오직 테스트 검증 시에만 사용하게 되는 코드입니다. 이렇게 테스트를 위해서 특정 메서드가 테스트 스코프가 아닌 영역에 있다는 거 자체가 좋지 않은 패턴, 설계라고 생각합니다.\n이렇게 어려운 부분들을 해결하기 위해서 Query DSL 기반으로 조회를 진행할 수 있는 JPAQueryFactory를 BatchTestSupport에서 지원하고 있습니다.\n1234567891011121314151617181920212223242526272829303132333435363738394041internal class CsvReaderJobConfigurationTest(    private val csvReaderJob: Job,    private val paymentRepository: PaymentRepository) : BatchTestSupport() &#123;    @Test    internal fun `csvReaderJob repository 기반 테스트`() &#123;        //given        //when        launchJob(csvReaderJob)        //then        thenBatchCompleted()        val payments = paymentRepository.findByOrderId(1L)        then(payments).hasSize(9)        deleteAll(QPayment.payment)    &#125;    @Test    internal fun `csvReaderJob JPAQueryFactory 기반 테스트`() &#123;        //given        //when        launchJob(csvReaderJob)        //then        thenBatchCompleted()        val payments = query.selectFrom(QPayment.payment)            .where(QPayment.payment.orderId.eq(1L))            .fetch()        then(payments).hasSize(9)        deleteAll(QPayment.payment)    &#125;&#125;\nrepository 기반으로 테스트 진행할 할 때, 당연하지만 해당 Repositroy를 주입받아야 하며 검증 조회 메서드가 없는 경우 오직 테스트 코드에서 사용하기 위해서 메서드를 구현해야 합니다. 검증할 엔티티가 많아지면 그만큼 위 작업을 반복해야 합니다.\nJPAQueryFactory 기반으로 테스트는 Query DSL 방식으로 검증을 진행하기 때문에 불필요한 DI, 조회 검증 메서드는 테스트에서 직접 구현해서 이런 문제를 해결할 수 있습니다.\n테스트 검증 이후 데이터 제거는 ?\n스프링 배치 애플리케이션은 @Transactional으로 시작할 수 없습니다. 그 결과 테스트 메서드가 끝난 이후에 자동으로 해당 데이터가 롤백 되지 않으며 데이터가 남아 있어 다른 테스트 코드에 영향을 주게 됩니다. 그러기 때문에 테스트가 끝난 이후에 데이터를 제거하는 작업을 해야 합니다. 반복적인 이야기이지만 Repositroy 기반으로 해당 작업을 하기 위해서는 의존성을 주입받아야 합니다. 이것들을 쉽게 처리할 수 있게 BatchTestSupport에서 deleteAll() 메서드를 지원합니다.\n12345678910111213141516171819202122232425abstract class BatchTestSupport &#123;    @Autowired    protected lateinit var entityManagerFactory: EntityManagerFactory    protected val entityManager by lazy &#123; entityManagerFactory.createEntityManager() &#125;    protected fun &lt;T&gt; deleteAll(path: EntityPath&lt;T&gt;) &#123;        entityManager.transaction.let &#123; transaction -&gt;            transaction.begin()            query.delete(path).execute()            transaction.commit()        &#125;    &#125;&#125;internal class CsvReaderJobConfigurationTest(    private val csvReaderJob: Job) : BatchTestSupport() &#123;    @AfterEach    internal fun deleteAll() &#123;        deleteAll(QPayment.payment)    &#125;&#125;\nBatchTestSupport에서 엔티티 매니저를 직접 생성해서 JPAQueryFactory 기반으로 데이터를 제거합니다.\n\n실제 delete 쿼리가 동작하는 것을 확인할 수 있습니다.\n왜 배치에서는 @Transactional을 물고 시작할 수 없을까?\n1234567891011121314@Transactionalinternal class CsvReaderJobConfigurationTest(    private val csvReaderJob: Job) : BatchTestSupport() &#123;    @AfterEach    internal fun deleteAll() &#123;        deleteAll(QPayment.payment)    &#125;    @Test    @Test    internal fun `@Transactional 물고 시작하는 경우 테스트는 정상 동작하지 않습니다`() &#123;&#125;&#125;\n\n트랜잭션을 물고 시작하면 위와 같은 에러가 발생합니다. 일단 실패하는 것은 확인했고 그 이유에 대해서 정리해 해보겠습니다. 해당 내용은 제가 이해한 내용으로 설명한 드린 부분이기 때문에 맞지 않을 수도 있습니다. 비판적으로 읽어주세요.\n\n\n이미지 출처 spring-batch\n\n스프링 배치에서는 배치에 대한 메타 정보를 저장하기 위해서 Meta-Data Schema를 이용합니다. 결과 적으로 해당 정보를 데이터베이스에 저장하기 위해서는 트랜잭잭션이 필요합니다.\n12@Transactionalinternal class CsvReaderJobConfigurationTest() &#123;...&#125;\n\n테스트 코드에서 트랜잭션을 물고 시작하면 위와 같은 트랜잭션 원자성이 하나로 묶이게 됩니다. 그렇다면 문제가 생겨서 롤백이 발생하면 어떻게 될까요? 하나의 원자성을 가지고 있기 때문에 Meta-Data Schema에 저장돼있는 데이터까지 모두 롤백 되게 됩니다. 해당 저장소에는 배치에 실패에 대한 기록도 남겨야 하기 때문에 이는 문제가 되기 때문에 이러한 경우 예외가 발생하는 것이라고 생각합니다.\n그동안 배치 테스트를 작성하면서 느낀 점들\n그동안 스프링 배치 테스트 코드 작성에 대한 나름의 고찰을 정리해 보았습니다. 배치 애플리케이션 테스트 코드도 다른 환경에서의 테스트 코드 작성 방식과 전체적인 방향성은 크게 다르지 않다고 생각합니다. 스프링 배치라는 프레임워크를 통해서 조금 더 쉽고 안전하게 테스트할 수 있는 방향성에 대해서 포스팅해보았습니다.\n스프링 배치 프레임워크를 사용하기 때문에 테스트 코드 작성 시에도 제약사항을 받는 부분이 있었고 이를 원천적으로 해결하기에는 아직도 역량이 많이 부족하다는 생각이 들었습니다. 그래도 이러한 부분들에 대해서 정리가 저와 같은 고민을 했던 분들에게 조금이라도 도움이 되기를 기원하겠습니다. 긴 글 읽어주셔서 감사합니다.\n","dateCreated":"2021-02-14T00:00:00+09:00","dateModified":"2025-01-31T20:33:58+09:00","datePublished":"2021-02-14T00:00:00+09:00","description":"스프링 배치 애플리케이션 테스트 코드를 작성하면서 만났던 이슈와 그에 따른 나름의 고찰을 정리한 포스팅 내용입니다.","headline":"Spring Batch Test 작성 방법 및 고찰","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://cheese10yun.github.io/spring-batch-test-2/"},"publisher":{"@type":"Organization","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg","logo":{"@type":"ImageObject","url":"yun-icon.jpg"}},"url":"https://cheese10yun.github.io/spring-batch-test-2/","keywords":"Test, Spring Batch"}</script>
    <meta name="description" content="스프링 배치 애플리케이션 테스트 코드를 작성하면서 만났던 이슈와 그에 따른 나름의 고찰을 정리한 포스팅 내용입니다.">
<meta property="og:type" content="blog">
<meta property="og:title" content="Spring Batch Test 작성 방법 및 고찰">
<meta property="og:url" content="https://cheese10yun.github.io/spring-batch-test-2/index.html">
<meta property="og:site_name" content="Yun Blog">
<meta property="og:description" content="스프링 배치 애플리케이션 테스트 코드를 작성하면서 만났던 이슈와 그에 따른 나름의 고찰을 정리한 포스팅 내용입니다.">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/ste-test-1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/ste-test-2.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/ste-test-3.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/ste-test-4.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/delete-query.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/transactional-test.png">
<meta property="og:image" content="https://docs.spring.io/spring-batch/docs/current/reference/html/images/meta-data-erd.png.pagespeed.ce.0yIgDTiutm.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/spring-batch-transactional.png">
<meta property="article:published_time" content="2021-02-13T15:00:00.000Z">
<meta property="article:modified_time" content="2025-01-31T11:33:58.260Z">
<meta property="article:author" content="Yun">
<meta property="article:tag" content="Test">
<meta property="article:tag" content="Spring Batch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/ste-test-1.png">
    
    
        
    
    
        <meta property="og:image" content="https://cheese10yun.github.io/assets/images/yun-icon.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90907312-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90907312-1');
    </script>


    

    
        
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5813739623204880" crossorigin="anonymous"></script>
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Yun Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="링크 열기: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="저자에 대해 더 알아보기"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
                </a>
                <h4 class="sidebar-profile-name">Yun</h4>
                
                    <h5 class="sidebar-profile-bio"><p>기술 블로그</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="카테고리"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">카테고리</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="태그"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">태그</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="아카이브"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">아카이브</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="검색"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">검색</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/cheese10yun"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/rss2.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Spring Batch Test 작성 방법 및 고찰
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2021-02-14T00:00:00+09:00">
	
		    2021/02/14
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <h1>Spring Batch Test Code</h1>
<p>스프링 배치 애플리케이션 테스트 코드를 작성하면서 만났던 이슈와 그에 따른 나름의 고찰을 정리한 포스팅 내용입니다. 배치를 사용하지 않더라도 스프링 기반으로 테스트를 작성하는 경우에도 도움 되는 내용들이 있습니다.</p>
<h2 id="SpringBatchTest">@SpringBatchTest</h2>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-batch/docs/4.1.x/reference/html/whatsnew.html">Spring Batch 4.1</a> 버전 부터는 <code>@SpringBatchTest</code> Annotation을 지원합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBatchTest</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = &#123;JobConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JobTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JobLauncherTestUtils jobLauncherTestUtils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JobRepositoryTestUtils jobRepositoryTestUtils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clearMetadata</span><span class="params">()</span> &#123;</span><br><span class="line">        jobRepositoryTestUtils.removeJobExecutions();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJob</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// given</span></span><br><span class="line">        <span class="type">JobParameters</span> <span class="variable">jobParameters</span> <span class="operator">=</span></span><br><span class="line">            jobLauncherTestUtils.getUniqueJobParameters();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="type">JobExecution</span> <span class="variable">jobExecution</span> <span class="operator">=</span></span><br><span class="line">            jobLauncherTestUtils.launchJob(jobParameters);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        Assert.assertEquals(ExitStatus.COMPLETED,</span><br><span class="line">            jobExecution.getExitStatus());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>JobLauncherTestUtils : 스프링 배치 테스트에 필요한 유틸 기능</li>
<li>JobRepositoryTestUtils : 데이터베이스에 저장된 JobExcution을 생성/삭제 지원</li>
<li>StepScopeTestExecutionListener : 배치 단위 테스트 시 StepScope 컨텍스트를 생성, 해당 컨텍스트를 통해 JobParamerter 등을 단위 테스트에서 DI 받을 수 있음</li>
<li>JobSopceTestExecutionListener : 배치 단위 테스트 시 JobScope 컨텍스트를 생성, 해당 컨텍스트를 통해 JobParameter 등을 단위 테스트에서 DI 받을 수 있음</li>
</ul>
<p><code>@SpringBatchTest</code>으로 위 코드를 자동으로 구성할 수 있습니다.</p>
<h2 id="Spring-Batch-Test-Support-만들기">Spring Batch Test Support 만들기</h2>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@SpringBatchTest</span></span><br><span class="line"><span class="meta">@TestInstance(TestInstance.Lifecycle.PER_CLASS)</span></span><br><span class="line"><span class="meta">@TestConstructor(autowireMode = TestConstructor.AutowireMode.ALL)</span></span><br><span class="line"><span class="meta">@ActiveProfiles(<span class="string">&quot;test&quot;</span>)</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BatchTestSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> entityManagerFactory: EntityManagerFactory</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> jobLauncherTestUtils: JobLauncherTestUtils</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">val</span> entityManager <span class="keyword">by</span> lazy &#123; entityManagerFactory.createEntityManager() &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">var</span> jobExecution: JobExecution? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">val</span> query: JPAQueryFactory <span class="keyword">by</span> lazy &#123; JPAQueryFactory(entityManager) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="title">launchJob</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        job: <span class="type">Job</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        jobParameters: <span class="type">JobParameters</span> = jobLauncherTestUtils.uniqueJobParameters</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> &#123;</span><br><span class="line">        jobLauncherTestUtils.job = job</span><br><span class="line">        <span class="keyword">this</span>.jobExecution = jobLauncherTestUtils.launchJob(jobParameters)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="title">launchStep</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        stepName: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        jobParameters: <span class="type">JobParameters</span> = jobLauncherTestUtils.uniqueJobParameters,</span></span></span><br><span class="line"><span class="params"><span class="function">        executionContext: <span class="type">ExecutionContext</span>? = <span class="literal">null</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.jobExecution = jobLauncherTestUtils.launchStep(stepName, jobParameters, executionContext)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="title">thenBatchCompleted</span><span class="params">()</span></span> &#123;</span><br><span class="line">        then(BatchStatus.COMPLETED).isEqualTo(jobExecution?.status)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="title">thenBatchStatus</span><span class="params">(batchStatus: <span class="type">BatchStatus</span>)</span></span> &#123;</span><br><span class="line">        then(batchStatus).isEqualTo(jobExecution?.status)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">save</span><span class="params">(entity: <span class="type">T</span>)</span></span>: T &#123;</span><br><span class="line">        entityManager.transaction.let &#123; transaction -&gt;</span><br><span class="line">            transaction.begin()</span><br><span class="line">            entityManager.persist(entity)</span><br><span class="line">            transaction.commit()</span><br><span class="line">            entityManager.clear()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> entity</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">saveAll</span><span class="params">(entities: <span class="type">List</span>&lt;<span class="type">T</span>&gt;)</span></span>: List&lt;T&gt; &#123;</span><br><span class="line">        <span class="keyword">val</span> entityManager = entityManagerFactory.createEntityManager()</span><br><span class="line">        entityManager.transaction.let &#123; transaction -&gt;</span><br><span class="line">            transaction.begin()</span><br><span class="line">            <span class="keyword">for</span> (entity <span class="keyword">in</span> entities) &#123;</span><br><span class="line">                entityManager.persist(entity)</span><br><span class="line">            &#125;</span><br><span class="line">            transaction.commit()</span><br><span class="line">            entityManager.clear()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> entities</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;E&gt;</span> List<span class="type">&lt;E&gt;</span>.<span class="title">persist</span><span class="params">()</span></span> &#123;</span><br><span class="line">        saveAll(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">deleteAll</span><span class="params">(path: <span class="type">EntityPath</span>&lt;<span class="type">T</span>&gt;)</span></span> &#123;</span><br><span class="line">        entityManager.transaction.let &#123; transaction -&gt;</span><br><span class="line">            transaction.begin()</span><br><span class="line">            query.delete(path).execute()</span><br><span class="line">            transaction.commit()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>배치 애플리케이션의 테스트를 도와주는 유틸성 클래스, 테스트 코드를 효율적으로 작성할 수 있게 지원합니다. 어떤 기능들이 있고, 이 기능들이 어떤 불편한 점 때문에 추가했는지에 대해서 설명을 진행하겠습니다.</p>
<h3 id="테스트-Job-실행은">테스트 Job 실행은?</h3>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BatchTestSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> jobLauncherTestUtils: JobLauncherTestUtils</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="title">launchJob</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        job: <span class="type">Job</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        jobParameters: <span class="type">JobParameters</span> = jobLauncherTestUtils.uniqueJobParameters</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> &#123;</span><br><span class="line">        jobLauncherTestUtils.job = job</span><br><span class="line">        <span class="keyword">this</span>.jobExecution = jobLauncherTestUtils.launchJob(jobParameters)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">CsvWriterConfigurationTest</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> csvWriterJob: Job,</span><br><span class="line">) : BatchTestSupport() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> `csvWriterJob test`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">//given</span></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="comment">//when</span></span><br><span class="line">        launchJob(csvWriterJob)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//then</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> jobLauncherTestUtils: JobLauncherTestUtils</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> `csvWriterJob test 슈퍼 클래스에 없는 경우 직접 DI 받아 job을 실헹 해야한다`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">//given</span></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="comment">//when</span></span><br><span class="line">        jobLauncherTestUtils.job = job</span><br><span class="line">        jobLauncherTestUtils.launchJob(job)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//then</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>배치 테스트를 위해서는 Job을 실행시켜야 합니다. 이것을 편리하게 도와주는 것이 <code>launchJob()</code>메서드입니다. <code>JobLauncherTestUtils</code>의 <code>launchJob()</code> 메서드를 한 번 감싸서 사용하는 용도로 특별하건 없습니다. 슈퍼 클래스에서 의존성을 주입받지 않으면 실제 테스트에 계속 DI를 받아 사용해야 하기 때문에 슈퍼 클래스에서 해당 기능을 제공합니다. JobParameters가 필요한 경우 <code>JobParameters</code>를 전달하면 됩니다. 그렇지 않은 경우에는 스프링 배치에서 자체적으로 유니크한 <code>JobParameters</code>을 생성하는 기본값을 지정했습니다.</p>
<h3 id="특정-Step만-테스트하고-싶은-경우는">특정 Step만 테스트하고 싶은 경우는 ?</h3>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">sampleJob</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    jobBuilderFactory: <span class="type">JobBuilderFactory</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    step1: <span class="type">Step</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    step2: <span class="type">Step</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    step3: <span class="type">Step</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    step4: <span class="type">Step</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    step5: <span class="type">Step</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Job =</span><br><span class="line">    jobBuilderFactory[<span class="string">&quot;csvWriterJob&quot;</span>]</span><br><span class="line">        .incrementer(RunIdIncrementer())</span><br><span class="line">        .listener(JobReportListener())</span><br><span class="line">        .start(step1)</span><br><span class="line">        .next(step2)</span><br><span class="line">        .next(step3)</span><br><span class="line">        .next(step4)</span><br><span class="line">        .next(step5)</span><br><span class="line">        .build()</span><br></pre></td></tr></table></figure>
<p>단순한 Job의 경우에는 Step이 여러개로 구성되어 있는 경우는 특정 Step만 테스트를 진행하는 단위 테스트가 필요할 수 있습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BatchTestSupport</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="title">launchStep</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        job: <span class="type">Job</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        stepName: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        jobParameters: <span class="type">JobParameters</span> = jobLauncherTestUtils.uniqueJobParameters,</span></span></span><br><span class="line"><span class="params"><span class="function">        executionContext: <span class="type">ExecutionContext</span>? = <span class="literal">null</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.jobExecution = jobLauncherTestUtils.launchStep(stepName, jobParameters, executionContext)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">CsvWriterConfigurationTest</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> csvWriterJob: Job,</span><br><span class="line">) : BatchTestSupport() &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> `csvWriterStep test`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">//given</span></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="comment">//when</span></span><br><span class="line">        launchStep(csvWriterJob, <span class="string">&quot;csvWriterStep&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//then</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Step 테스트도 마찬가지로 <code>jobLauncherTestUtils.launchStep()</code> 메서드를 활용해서 특정 Step을 실행할 수 있습니다. 개인적으로는 <code>launchStep()</code> 테스트를 진행하는 것은 좋아하지는 않습니다.</p>
<p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/ste-test-1.png" alt=""></p>
<p>Job name이 <code>name=TestJob</code> 이것을 확인할 수 있습니다. Step을 테스트하기 위해서는 반드시 Job이 있어야 하기 때문에 <code>TestJob</code>으로 연결해서 테스트를 진행하는 것입니다. 이렇게 테스트가 진행되게 되면 문제가 있을 수 있습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleJobListener</span> : <span class="type">JobExecutionListener</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> log <span class="keyword">by</span> logger()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">beforeJob</span><span class="params">(jobExecution: <span class="type">JobExecution</span>)</span></span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;beforeJob&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">afterJob</span><span class="params">(jobExecution: <span class="type">JobExecution</span>)</span></span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;afterJob&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CsvWriterJobConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">csvWriterJob</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        jobBuilderFactory: <span class="type">JobBuilderFactory</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        csvWriterStep: <span class="type">Step</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: Job =</span><br><span class="line">        jobBuilderFactory[<span class="string">&quot;csvWriterJob&quot;</span>]</span><br><span class="line">            .incrementer(RunIdIncrementer())</span><br><span class="line">            .listener(SimpleJobListener())</span><br><span class="line">            .start(csvWriterStep)</span><br><span class="line">            .build()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위 코드처럼 <code>SimpleJobListener</code>로 Job 시작 이전, 이후로 log를 찍는 리스너를 추가하고 <code>launchStep(&quot;csvWriterStep&quot;)</code> Step을 실행시키면 리스너는 동작하지 않습니다. 반면 <code>launchJob(csvWriterJob)</code>은 잘 동작합니다.</p>
<blockquote>
<p>launchJob(csvWriterJob) Log<br>
<img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/ste-test-2.png" alt=""></p>
</blockquote>
<blockquote>
<p>launchStep(“csvWriterStep”) Log<br>
<img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/ste-test-3.png" alt=""></p>
</blockquote>
<p>리스너는 Job에 연결이 된다는 것이지 Step에 연결돼있는 것은 아니며, 위에서 언급했듯 <code>launchStep()</code>은 <code>name=TestJob</code>으로 Job을 실행시키기 때문에 해당 잡에는 리스너가 없어 당연한 결과입니다.</p>
<p>해당 코드는 단순하게 리스너로 로직을 것이지만 해당 Step에 필요한 리스너라면 예상했던 테스트 결과와 다르게 동작할 수 있습니다. 이러한 문제 때문에 저는 아래와 같은 방식으로 Step 테스트합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">CsvWriterConfigurationTest</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> csvWriterJob: Job,</span><br><span class="line">    csvWriterStep: Step,</span><br><span class="line">    jobBuilderFactory: JobBuilderFactory,</span><br><span class="line">) : BatchTestSupport() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> job = jobBuilderFactory[<span class="string">&quot;csvWriterStepForTestJob&quot;</span>]</span><br><span class="line">        .incrementer(RunIdIncrementer())</span><br><span class="line">        .listener(SimpleJobListener())</span><br><span class="line">        .start(csvWriterStep)</span><br><span class="line">        .build()</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> `csvWriterStep job을 직접 생성해서 테스트`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">//given</span></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="comment">//when</span></span><br><span class="line">        launchJob(job)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//then</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위 코드는 실제 Job을 생성하고 해당 Job으로 <code>launchJob()</code>메서드를 통해서 Job을 실행시키고 있습니다.</p>
<p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/ste-test-4.png" alt=""><br>
해당 결과 리스너의 로그 및 Job name이 <code>name=csvWriterStepForTestJob</code>으로 테스트를 진행하는 것을 확인할 수 있습니다.</p>
<p>그 밖에도 Job을 직접 생성할 수 있으니 다양한 방법으로 테스트를 진행할 수 있습니다. 예를 들어 특정 step 몇 개를 연결해서 단위 테스트해볼 수 있으며, Flow와 같은 배치 Step의 순서에 대한 Flow를 직접 정의해서 테스트할 수 있습니다.</p>
<h3 id="테스트-데이터-세팅은">테스트 데이터 세팅은?</h3>
<p>배치 애플리케이션 여러 여러 테이블의 데이터를 읽어 오고, 여러 테이블에 데이터를 저장하는 경우가 빈번합니다. 이런 경우 테스트를 작성하기 위한 <code>given</code>절에 해당하는 데이터 세팅이 많이 번거롭습니다.</p>
<h3 id="JPA-기반-세팅">JPA 기반 세팅</h3>
<p>테스트를 진행할 때 <code>given</code>을 JPA 기반으로 작성하기 위해서는 <code>Repositroy</code>를 주입받아 save 해서 테스트하는 것이 일반적입니다. 위에서도 언급했지만 여러 테이블의 조회가 필요하니 그 필요한 테이블만큼 <code>Repositroy</code>를 주입 받아야 하는데 이것이 생각보다 귀찮고 코딩의 흐름을 방해합니다.</p>
<p>테스트 코드를 작성하다 ‘아 데이터가 필요하네…’ 하고 다시 테스트 클래스 상위로 올라가 필요한 Repositroy를 주입받고 다시 save를 진행하는 것은 코딩의 흐름을 많이 방해한다고 생각합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BatchTestSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> entityManagerFactory: EntityManagerFactory</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">val</span> entityManager <span class="keyword">by</span> lazy &#123; entityManagerFactory.createEntityManager() &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">save</span><span class="params">(entity: <span class="type">T</span>)</span></span>: T &#123;</span><br><span class="line">        entityManager.transaction.let &#123; transaction -&gt;</span><br><span class="line">            transaction.begin()</span><br><span class="line">            entityManager.persist(entity)</span><br><span class="line">            transaction.commit()</span><br><span class="line">            entityManager.clear()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> entity</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">saveAll</span><span class="params">(entities: <span class="type">List</span>&lt;<span class="type">T</span>&gt;)</span></span>: List&lt;T&gt; &#123;</span><br><span class="line">        <span class="keyword">val</span> entityManager = entityManagerFactory.createEntityManager()</span><br><span class="line">        entityManager.transaction.let &#123; transaction -&gt;</span><br><span class="line">            transaction.begin()</span><br><span class="line">            <span class="keyword">for</span> (entity <span class="keyword">in</span> entities) &#123;</span><br><span class="line">                entityManager.persist(entity)</span><br><span class="line">            &#125;</span><br><span class="line">            transaction.commit()</span><br><span class="line">            entityManager.clear()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> entities</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위에서 언급한 문제를 해결하기 위해서 <code>BatchTestSupport</code>는 해당 기능을 제공합니다. <code>EntityManagerFactory</code>를 주입받아 <code>EntityManager</code>를 직접 생성하여 해당 매니저로 트랜잭션을 진행시켜 필요한 데이터를 세팅합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">CsvWriterConfigurationTest</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> csvWriterJob: Job,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> paymentRepository: PaymentRepository</span><br><span class="line">    ...</span><br><span class="line">) : BatchTestSupport() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span> </span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> `csvWriterJob repositroy를 DI 받아 테스트 진행`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">//given</span></span><br><span class="line">        (<span class="number">1.</span><span class="number">.10</span>).map &#123;</span><br><span class="line">            Payment(</span><br><span class="line">                amount = it.toBigDecimal(),</span><br><span class="line">                orderId = it.toLong()</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">            .also &#123;</span><br><span class="line">                paymentRepository.saveAll(it)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//when</span></span><br><span class="line">        launchJob(csvWriterJob)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//then</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> `csvWriterJob test`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">//given</span></span><br><span class="line">        (<span class="number">1.</span><span class="number">.10</span>).map &#123;</span><br><span class="line">            Payment(</span><br><span class="line">                amount = it.toBigDecimal(),</span><br><span class="line">                orderId = it.toLong()</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">            .persist()</span><br><span class="line"></span><br><span class="line">        <span class="comment">//when</span></span><br><span class="line">        launchJob(csvWriterJob)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//then</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>위 테스트 코드는 Repositroy를 주입받아 테스트, <code>BatchTestSupport</code>를 기반으로 테스트하는 코드입니다. 해당 코드는 단순하지만 테스트에 필요한 <code>Repositroy</code>가 많아지면 <code>BatchTestSupport</code> 기반으로 테스트하는 것이 효율적입니다.</p>
<h3 id="SQL-기반-세팅">SQL 기반 세팅</h3>
<p>프로젝트가 JPA 기반으로 진행하고 있다면 코드 냥이 많아 지나더라도 JPA 기반으로 테스트하는 것이 장기적으로 좋다고 생각한다. 하지만 JPA로 데이터 셋업이 번거롭고, 특정 시점으로 데이터를 Set Up 하기에는 어려운 부분이 있다. 그런 경우 유용한 방법이 <code>@Sql</code>을 기반으로 데이터를 세팅하는 것이다.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> payment (amount, order_id)</span><br><span class="line"><span class="keyword">values</span> (<span class="number">100</span>, <span class="number">1</span>),</span><br><span class="line">       ...</span><br><span class="line">       (<span class="number">100</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="number">100</span>, <span class="number">1</span>)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Sql(<span class="string">&quot;/csv-setup.sql&quot;</span>)</span></span><br><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> `csvWriterJob sql 테스트 진행`<span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//given</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//when</span></span><br><span class="line">    launchJob(csvWriterJob)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//then</span></span><br><span class="line">    thenBatchCompleted()</span><br><span class="line"></span><br><span class="line">    deleteAll(QPayment.payment)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>/test/resources/csv-setup.sql</code> 해당 경로에 SQL 파일을 위치시키고 <code>@Sql</code>으로 해당 경로를 지정하면 해당 SQL 기반으로 데이터를 세팅합니다. <code>@Sql</code>는 테스트 메서드 단위로 실행되기 때문에 편리하지만 SQL의 단순 문자열 기반으로 관리되기 때문에 엔티티가 변경되는 경우 유지 보수가 어려운 부분들이 있습니다. <strong>해당 엔티티가 변경될 일이 거의 없거나. 데이터의 특정 시점을 객체 기반으로 만들기 어려운 경우 사용하는 것을 권장합니다.</strong></p>
<h3 id="테스트-검증은">테스트 검증은?</h3>
<p>테스트 검증 시 여러 테이블에 대한 변경 작업이 발생했을 경우 모든 변경에 대한 테스트를 작성해야 합니다. 우선 then에서 검증할 엔티티의 개수만큼 <code>Repositroy</code>를 주입받아야 합니다. 이는 위에서도 언급했듯이 코딩의 흐름에 악영향을 미칩니다. 무엇보다 테스트 검증을 위한 조회를 <code>Repositroy</code>를 의존하게 되면 <strong>오직 테스트 코드 검증을 위한 조회 로직이 필요하게 됩니다.</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> `csvWriterJob 테스트 코드만을 위한 코드`<span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//given</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//when</span></span><br><span class="line">    launchJob(csvWriterJob)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//then</span></span><br><span class="line">    thenBatchCompleted()</span><br><span class="line">    paymentRepository.findByxxxxx() <span class="comment">// 오직 테스트 코드엑서만 사용한다</span></span><br><span class="line"></span><br><span class="line">    deleteAll(QPayment.payment)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위 테스트의 검증은 paymentRepository 기반으로 진행하고 있습니다. 그런데 검증을 위해 조회 코드가 없어 만들려고 하는데 <strong>이 코드는 오직 테스트 검증 시에만 사용하게 되는 코드입니다. 이렇게 테스트를 위해서 특정 메서드가 테스트 스코프가 아닌 영역에 있다는 거 자체가 좋지 않은 패턴, 설계라고 생각합니다.</strong></p>
<p>이렇게 어려운 부분들을 해결하기 위해서 Query DSL 기반으로 조회를 진행할 수 있는 <code>JPAQueryFactory</code>를 <code>BatchTestSupport</code>에서 지원하고 있습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">CsvReaderJobConfigurationTest</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> csvReaderJob: Job,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> paymentRepository: PaymentRepository</span><br><span class="line">) : BatchTestSupport() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> `csvReaderJob repository 기반 테스트`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">//given</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//when</span></span><br><span class="line">        launchJob(csvReaderJob)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//then</span></span><br><span class="line">        thenBatchCompleted()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> payments = paymentRepository.findByOrderId(<span class="number">1L</span>)</span><br><span class="line"></span><br><span class="line">        then(payments).hasSize(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">        deleteAll(QPayment.payment)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> `csvReaderJob JPAQueryFactory 기반 테스트`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">//given</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//when</span></span><br><span class="line">        launchJob(csvReaderJob)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//then</span></span><br><span class="line">        thenBatchCompleted()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> payments = query.selectFrom(QPayment.payment)</span><br><span class="line">            .<span class="keyword">where</span>(QPayment.payment.orderId.eq(<span class="number">1L</span>))</span><br><span class="line">            .fetch()</span><br><span class="line"></span><br><span class="line">        then(payments).hasSize(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">        deleteAll(QPayment.payment)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>repository 기반으로 테스트 진행할 할 때, 당연하지만 해당 Repositroy를 주입받아야 하며 검증 조회 메서드가 없는 경우 오직 테스트 코드에서 사용하기 위해서 메서드를 구현해야 합니다. 검증할 엔티티가 많아지면 그만큼 위 작업을 반복해야 합니다.</p>
<p>JPAQueryFactory 기반으로 테스트는 Query DSL 방식으로 검증을 진행하기 때문에 불필요한 DI, 조회 검증 메서드는 테스트에서 직접 구현해서 이런 문제를 해결할 수 있습니다.</p>
<h3 id="테스트-검증-이후-데이터-제거는">테스트 검증 이후 데이터 제거는 ?</h3>
<p>스프링 배치 애플리케이션은 <code>@Transactional</code>으로 시작할 수 없습니다. 그 결과 테스트 메서드가 끝난 이후에 <strong>자동으로 해당 데이터가 롤백 되지 않으며 데이터가 남아 있어 다른 테스트 코드에 영향을 주게 됩니다.</strong> 그러기 때문에 테스트가 끝난 이후에 데이터를 제거하는 작업을 해야 합니다. 반복적인 이야기이지만 Repositroy 기반으로 해당 작업을 하기 위해서는 의존성을 주입받아야 합니다. 이것들을 쉽게 처리할 수 있게 <code>BatchTestSupport</code>에서 <code>deleteAll()</code> 메서드를 지원합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BatchTestSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> entityManagerFactory: EntityManagerFactory</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">val</span> entityManager <span class="keyword">by</span> lazy &#123; entityManagerFactory.createEntityManager() &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">deleteAll</span><span class="params">(path: <span class="type">EntityPath</span>&lt;<span class="type">T</span>&gt;)</span></span> &#123;</span><br><span class="line">        entityManager.transaction.let &#123; transaction -&gt;</span><br><span class="line">            transaction.begin()</span><br><span class="line">            query.delete(path).execute()</span><br><span class="line">            transaction.commit()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">CsvReaderJobConfigurationTest</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> csvReaderJob: Job</span><br><span class="line">) : BatchTestSupport() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">deleteAll</span><span class="params">()</span></span> &#123;</span><br><span class="line">        deleteAll(QPayment.payment)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>BatchTestSupport</code>에서 엔티티 매니저를 직접 생성해서 <code>JPAQueryFactory</code> 기반으로 데이터를 제거합니다.</p>
<p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/delete-query.png" alt=""></p>
<p>실제 delete 쿼리가 동작하는 것을 확인할 수 있습니다.</p>
<h3 id="왜-배치에서는-Transactional을-물고-시작할-수-없을까">왜 배치에서는 @Transactional을 물고 시작할 수 없을까?</h3>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">CsvReaderJobConfigurationTest</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> csvReaderJob: Job</span><br><span class="line">) : BatchTestSupport() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">deleteAll</span><span class="params">()</span></span> &#123;</span><br><span class="line">        deleteAll(QPayment.payment)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> `@Transactional 물고 시작하는 경우 테스트는 정상 동작하지 않습니다`<span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/transactional-test.png" alt=""></p>
<p>트랜잭션을 물고 시작하면 위와 같은 에러가 발생합니다. 일단 실패하는 것은 확인했고 그 이유에 대해서 정리해 해보겠습니다. 해당 내용은 제가 이해한 내용으로 설명한 드린 부분이기 때문에 맞지 않을 수도 있습니다. 비판적으로 읽어주세요.</p>
<blockquote>
<p><img src="https://docs.spring.io/spring-batch/docs/current/reference/html/images/meta-data-erd.png.pagespeed.ce.0yIgDTiutm.png" alt=""><br>
이미지 출처 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-batch">spring-batch</a></p>
</blockquote>
<p>스프링 배치에서는 배치에 대한 메타 정보를 저장하기 위해서 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-batch/docs/current/reference/html/schema-appendix.html#metaDataSchema">Meta-Data Schema</a>를 이용합니다. <strong>결과 적으로 해당 정보를 데이터베이스에 저장하기 위해서는 트랜잭잭션이 필요합니다.</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">CsvReaderJobConfigurationTest</span>() &#123;...&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/spring-batch-transactional.png" alt=""></p>
<p>테스트 코드에서 트랜잭션을 물고 시작하면 위와 같은 트랜잭션 원자성이 하나로 묶이게 됩니다. 그렇다면 문제가 생겨서 롤백이 발생하면 어떻게 될까요? 하나의 원자성을 가지고 있기 때문에 <code>Meta-Data Schema</code>에 저장돼있는 데이터까지 모두 롤백 되게 됩니다. 해당 저장소에는 배치에 실패에 대한 기록도 남겨야 하기 때문에 이는 문제가 되기 때문에 이러한 경우 예외가 발생하는 것이라고 생각합니다.</p>
<h2 id="그동안-배치-테스트를-작성하면서-느낀-점들">그동안 배치 테스트를 작성하면서 느낀 점들</h2>
<p>그동안 스프링 배치 테스트 코드 작성에 대한 나름의 고찰을 정리해 보았습니다. 배치 애플리케이션 테스트 코드도 다른 환경에서의 테스트 코드 작성 방식과 전체적인 방향성은 크게 다르지 않다고 생각합니다. 스프링 배치라는 프레임워크를 통해서 조금 더 쉽고 안전하게 테스트할 수 있는 방향성에 대해서 포스팅해보았습니다.</p>
<p>스프링 배치 프레임워크를 사용하기 때문에 테스트 코드 작성 시에도 제약사항을 받는 부분이 있었고 이를 원천적으로 해결하기에는 아직도 역량이 많이 부족하다는 생각이 들었습니다. 그래도 이러한 부분들에 대해서 정리가 저와 같은 고민을 했던 분들에게 조금이라도 도움이 되기를 기원하겠습니다. 긴 글 읽어주셔서 감사합니다.</p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">태그</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/Spring-Batch/" rel="tag">Spring Batch</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Test/" rel="tag">Test</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/jpa-batch-insert/"
                    data-tooltip="Batch Insert 성능 향상기 1편 - With JPA"
                    aria-label="이전: Batch Insert 성능 향상기 1편 - With JPA"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/spring-batch-application/"
                    data-tooltip="Spring Batch Application 개발하면서 나름의 고찰 정리"
                    aria-label="다음: Spring Batch Application 개발하면서 나름의 고찰 정리"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-batch-test-2/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-batch-test-2/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://cheese10yun.github.io/spring-batch-test-2/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>


<!-- Comment -->
<!--  utteranc comment -->

<script src="https://utteranc.es/client.js"
        repo="cheese10yun/blog-comment"
        issue-term="title"
        label="Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Yun. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/jpa-batch-insert/"
                    data-tooltip="Batch Insert 성능 향상기 1편 - With JPA"
                    aria-label="이전: Batch Insert 성능 향상기 1편 - With JPA"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/spring-batch-application/"
                    data-tooltip="Spring Batch Application 개발하면서 나름의 고찰 정리"
                    aria-label="다음: Spring Batch Application 개발하면서 나름의 고찰 정리"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-batch-test-2/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-batch-test-2/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://cheese10yun.github.io/spring-batch-test-2/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-batch-test-2/"
                        aria-label="Facebook에 공유하기"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Facebook에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-batch-test-2/"
                        aria-label="Twitter에 공유하기"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Twitter에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://cheese10yun.github.io/spring-batch-test-2/"
                        aria-label="Google+에 공유하기"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Google+에 공유하기</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
            <h4 id="about-card-name">Yun</h4>
        
            <div id="about-card-bio"><p>기술 블로그</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
