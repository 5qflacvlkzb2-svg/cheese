
<!DOCTYPE html>
<html lang="ko">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="naver-site-verification" content="a37ea649edf26e70c3de94f9cb034f9d6e11de3f" />
    <meta name="generator" content="Yun Blog">
    <title>Spring Batch Reader 성능 분석 및 측정 part 1 - Yun Blog</title>
    <meta name="author" content="Yun">
    
        <meta name="keywords" content="Node,Spring,Spring Boot,Spring Batch,Kotlin,기술 블로그,JPA,Mongo,MySQL,OOP,">
    
    
    
        
            <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss2.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg"},"articleBody":"스프링 배치 애플리케이션에서 데이터베이스의 대량의 데이터를 처리할 때 Reader에 대한 성능 분석과 성능에 대한 측정을 정리한 포스팅입니다.\n조회 대상1234567891011121314# created_at 인덱스CREATE TABLE `payment`(    `id`         bigint(20)     NOT NULL AUTO_INCREMENT,    `amount`     decimal(19, 2) NOT NULL,    `created_at` datetime       NOT NULL,    `order_id`   bigint(20)     NOT NULL,    `updated_at` datetime       NOT NULL,    PRIMARY KEY (`id`),    KEY `IDXfxl3u00ue9kdoqelvslc1tj6h` (`created_at`)) ENGINE = InnoDB  AUTO_INCREMENT = 1  DEFAULT CHARSET = utf8mb4  COLLATE = utf8mb4_unicode_ci\n\n가장 최근 데이터부터 데이터를 읽어 특정 날짜까지 데이터를 읽는 기준으로 Item Reader를 작성했습니다.\n대상 리더\nJpaPagingItemReader\nQueryDslNoOffsetPagingReader\nHibernateCursorItemReader\n\n성능전체 성능 표\n\n\nReader\nrows\nChunk Size\n소요 시간(ms)\n\n\n\nJpaPagingItemReader\n10,000\n1000\n778\n\n\nJpaPagingItemReader\n50,000\n1000\n3243\n\n\nJpaPagingItemReader\n100,000\n1000\n8912\n\n\nJpaPagingItemReader\n500,000\n1000\n205469\n\n\nJpaPagingItemReader\n1,000,000\n1000\n1048979\n\n\nJpaPagingItemReader\n5,000,000\n1000\n…\n\n\nQueryDslNoOffsetPagingReader\n10,000\n1000\n658\n\n\nQueryDslNoOffsetPagingReader\n50,000\n1000\n2004\n\n\nQueryDslNoOffsetPagingReader\n100,000\n1000\n3523\n\n\nQueryDslNoOffsetPagingReader\n500,000\n1000\n15501\n\n\nQueryDslNoOffsetPagingReader\n1,000,000\n1000\n28732\n\n\nQueryDslNoOffsetPagingReader\n5,000,000\n1000\n165249\n\n\nHibernateCursorItemReader\n10,000\n1000\n448\n\n\nHibernateCursorItemReader\n50,000\n1000\n1605\n\n\nHibernateCursorItemReader\n100,000\n1000\n2886\n\n\nHibernateCursorItemReader\n500,000\n1000\n17411\n\n\nHibernateCursorItemReader\n1,000,000\n1000\n25439\n\n\nHibernateCursorItemReader\n5,000,000\n1000\n132552\n\n\nJpaPagingItemReader의 rows 5,000,000 측정은 너무 걸려 측정하지 못했습니다. 대략 5시간 이상까지 측정하다 종료했습니다.\n성능 그래프\n\nJpaPagingItemReader 리더의 시간이 너무 오래 소요되어  QueryDslNoOffsetPagingReader, HibernateCursorItemReader 리더 비교\n전체 코드12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970@Configurationclass ReaderPerformanceJobConfiguration(    private val jobBuilderFactory: JobBuilderFactory,    private val stepBuilderFactory: StepBuilderFactory) &#123;    val log by logger()    @Bean    fun readerPerformanceJob(        jobDataSetUpListener: JobDataSetUpListener,        readerPerformanceStep: Step    ) = jobBuilderFactory[&quot;readerPerformanceJob&quot;]        .incrementer(RunIdIncrementer())        .start(readerPerformanceStep)        .build()    @Bean    @JobScope    fun readerPerformanceStep(        jpaPagingItemReader: JpaPagingItemReader&lt;Payment&gt;,        hibernateCursorItemReader: HibernateCursorItemReader&lt;Payment&gt;,        queryDslNoOffsetPagingReader: QuerydslNoOffsetPagingItemReader&lt;Payment&gt;    ) =        stepBuilderFactory[&quot;readerPerformanceStep&quot;]            .chunk&lt;Payment, Payment&gt;(CHUNK_SIZE)// 해당 Reader 중 택 1//            .reader(jpaPagingItemReader)//            .reader(queryDslNoOffsetPagingReader)//            .reader(hibernateCursorItemReader)            .writer &#123; log.info(&quot;item size $&#123;it.size&#125;&quot;) &#125;            .build()    @Bean    @StepScope    fun jpaPagingItemReader(        entityManagerFactory: EntityManagerFactory    ) = JpaPagingItemReaderBuilder&lt;Payment&gt;()        .name(&quot;jpaPagingItemReader&quot;)        .pageSize(CHUNK_SIZE)        .entityManagerFactory(entityManagerFactory)        .queryString(&quot;SELECT p FROM Payment p where p.createdAt &gt;= :createdAt ORDER BY p.createdAt DESC&quot;)        .parameterValues(mapOf(&quot;createdAt&quot; to LocalDateTime.now().withHour(0).withMinute(0).withSecond(0).withNano(0)))        .build()    @Bean    @StepScope    fun queryDslNoOffsetPagingReader(        entityManagerFactory: EntityManagerFactory    ): QuerydslNoOffsetPagingItemReader&lt;Payment&gt; &#123;        // 1. No Offset Option        val options = QuerydslNoOffsetNumberOptions&lt;Payment, Long&gt;(qPayment.id, Expression.ASC)        // 2. Querydsl Reader        return QuerydslNoOffsetPagingItemReader(entityManagerFactory, CHUNK_SIZE, options) &#123;            it.selectFrom(qPayment)                .where(qPayment.createdAt.goe(LocalDateTime.now().withHour(0).withMinute(0).withSecond(0).withNano(0)))        &#125;    &#125;    @Bean    @StepScope    fun hibernateCursorItemReader(        sessionFactory: SessionFactory    ) = HibernateCursorItemReaderBuilder&lt;Payment&gt;()        .name(&quot;hibernateCursorItemReader&quot;)        .fetchSize()        .sessionFactory(sessionFactory)        .queryString(&quot;SELECT p FROM Payment p where p.createdAt &gt;= :createdAt ORDER BY p.createdAt DESC&quot;)        .parameterValues(mapOf(&quot;createdAt&quot; to LocalDateTime.now().withHour(0).withMinute(0).withSecond(0).withNano(0)))        .build()&#125;\n\nJpaPagingItemReaderJpaPagingItemReader눈 Spring Batch에서 제공해 주는 ItemReader로 일반적인 페이징 방식을 통해서 가져오는 방식입니다. 모든 데이터를 한 번에 가져와서 처리할 수는 없으니 offset, limit 방식으로 데이터를 가져옵니다. 실제 쿼리는 다음과 같습니다.\n123456789select payment0_.id         as id1_0_,       payment0_.amount     as amount2_0_,       payment0_.created_at as created_3_0_,       payment0_.order_id   as order_id4_0_,       payment0_.updated_at as updated_5_0_from payment payment0_where payment0_.created_at &gt;= ?order by payment0_.created_at DESC    limit ?, ?\n\n해당 리더는 위 그래프에서 확인했듯이 다른 리더에 비해서 현저하게 드립니다. 읽어야 할 총 데이터가 많고, 청크 후반으로 갈수록 더욱 느려집니다.\n1 ~ 2 번째 조회12345Hibernate: select payment0_.id as id1_0_, payment0_.amount as amount2_0_, payment0_.created_at as created_3_0_, payment0_.order_id as order_id4_0_, payment0_.updated_at as updated_5_0_ from payment payment0_ where payment0_.created_at&gt;=? order by payment0_.created_at DESC limit ?2021-05-25 22:40:25.963  INFO 93165 --- [           main] uration$$EnhancerBySpringCGLIB$$d8232fb2 : item size 1000Hibernate: select payment0_.id as id1_0_, payment0_.amount as amount2_0_, payment0_.created_at as created_3_0_, payment0_.order_id as order_id4_0_, payment0_.updated_at as updated_5_0_ from payment payment0_ where payment0_.created_at&gt;=? order by payment0_.created_at DESC limit ?, ?2021-05-25 22:40:26.016  INFO 93165 --- [           main] uration$$EnhancerBySpringCGLIB$$d8232fb2 : item size 1000\n첫 조회 이후 두 번째 조회까지의 시간은 26.016 - 25.963 = 0.053의 짧은 시간밖에 걸리지 않았습니다.\n49,990,000 ~ 5,000,0000 조회12342021-05-31 02:24:27.943  INFO 13475 --- [           main] uration$$EnhancerBySpringCGLIB$$4d92f8c5 : item size 1000Hibernate: select payment0_.id as id1_0_, payment0_.amount as amount2_0_, payment0_.created_at as created_3_0_, payment0_.order_id as order_id4_0_, payment0_.updated_at as updated_5_0_ from payment payment0_ where payment0_.created_at&gt;=? order by payment0_.created_at DESC limit ?, ?2021-05-31 02:25:18.092  INFO 13475 --- [           main] uration$$EnhancerBySpringCGLIB$$4d92f8c5 : item size 1000Hibernate: select payment0_.id as id1_0_, payment0_.amount as amount2_0_, payment0_.created_at as created_3_0_, payment0_.order_id as order_id4_0_, payment0_.updated_at as updated_5_0_ from payment payment0_ where payment0_.created_at&gt;=? order by payment0_.created_at DESC limit ?, ?\n\n마지막 청크 사이즈 조회하는 시간은 25:18.092 - 24:27.943 대략 51초가 걸렸습니다. 즉 해당 리더는 초반 청크는 빠르지만 후반으로 갈수록 청크를 읽는 부분이 느려지며, 데이터가 많으면 많을수록 더 느려지는 것을 확인할 수 있습니다.\n왜 후반 리드에서 느려지는 것일까?explain: 첫 청크123456789explain select payment0_.id         as id1_0_,       payment0_.amount     as amount2_0_,       payment0_.created_at as created_3_0_,       payment0_.order_id   as order_id4_0_,       payment0_.updated_at as updated_5_0_from payment payment0_where payment0_.created_at &gt;= &#x27;2021-05-30 00:00:00&#x27;order by payment0_.created_at DESClimit 1000;\n\n\n\n\nid\nselect_type\ntable\npartitions\ntype\npossible_keys\nkey\nkey_len\nref\nrows\nfiltered\nExtra\n\n\n\n1\nSIMPLE\npayment0_\nNULL\nrange\nIDXfxl3u00ue9kdoqelvslc1tj6h\nIDXfxl3u00ue9kdoqelvslc1tj6h\n5\nNULL\n2306025\n100\nUsing index condition\n\n\n\n\ntype: range 인덱스 특정 범위의 행에 접근, 즉 인덱스가 제대로 동작\npossible_keys: IDXfxl3u00ue9kdoqelvslc1tj6h(created_at)  이용 가능성 있는 인덱스의 목록\nkey: IDXfxl3u00ue9kdoqelvslc1tj6h(created_at): possible_keys 필드는 이용 가능성 있는 인덱스의 목록 중에서 실제로 옵티마이저가 선택한 인덱스의 key\nrows: 2306025 특정 rows을 찾기 위해 읽어야 하는 MySQL 예상 rows, 단 어디까지나 통계 값으로 계산한 값이므로 실제 rows 수와 반드시 일치하지 않는다.\nfiltered: 100 rows 데이터를 가져와 WHERE 구의 검색 조건이 적용되면 몇행이 남는지를 표시, 이 값도 통계 값 바탕으로 계산한 값이므로 현실의 값과 반드시 일치하지 않는다.\nExtra: Using index condition 인덱스 컨디션 pushdown(ICP) 최적화가 진행(Using index와 비슷한 개념으로 인덱스에서만 접근해서 쿼티를 해결하는 것을 의미, 정확히 알고 있는 개념은 아니라서 Index Condition Pushdown Optimization참고)\n\n해당 실행 계획을 정리하면 created_at 인덱스가 type: range로 제대로 동작했습니다. 하지만 rows: 2306025인 것을 봐서 상당히 많은 rows를 읽은 이후에 해당 rows를 찾는 거 같습니다. 대략 limit 2000000, 1000까지는 첫 청크 인덱스와 동일하게 type: range의 실행 계획을 가졌습니다.\nexplain: 마지막 청크123456789explain select payment0_.id         as id1_0_,       payment0_.amount     as amount2_0_,       payment0_.created_at as created_3_0_,       payment0_.order_id   as order_id4_0_,       payment0_.updated_at as updated_5_0_from payment payment0_where payment0_.created_at &gt;= &#x27;2021-05-30 00:00:00&#x27;order by payment0_.created_at DESClimit 4999000, 1000;\n\n\n\n\nid\nselect_type\ntable\npartitions\ntype\npossible_keys\nkey\nkey_len\nref\nrows\nfiltered\nExtra\n\n\n\n1\nSIMPLE\npayment0_\nNULL\nALL\nIDXfxl3u00ue9kdoqelvslc1tj6h\nNULL\nNULL\nNULL\n4612051\n50\nUsing where; Using filesort\n\n\n\n\ntype: ALL 풀 스캔, 테이블의 데이터 전체에 접근\nkey: NULL: possible_keys 필드를 이용하지 않음, 즉 인덱스 사용 안 함\nExtra\nUsing where 테이블에서 행을 가져온 후 추가적으로 검색 조건을 적용해 행의 범위를 축소\nUsing filesort ORDER BY 인덱스로 해결하지 못하고, filesort(MySQL의 quick sort)로 행을 정렬\n\n\n\n특정 청크 이후부터는 index를 타지 못하고 풀 스캔이 진행되고 있습니다. 당연히 해당 쿼리는 느릴 수밖에 없습니다.\n왜 후반 청크에서는 Full Scan을 하는 것일까?인덱스를 통해 테이블의 레코드를 읽는 것은 인덱스를 거치지 않고 바로 테이블의 레코드를 읽는 것보다 높은 비용이 드는 작업입니다. 만약 100만 건의 레코드가 있다고 가정하고 그중 50만 건을 읽어야 하는 쿼리가 있다고 하면 테이블 전체를 읽어서 필요 없는 50만 건을 버리는 것이 효율적인지, 인덱스를 통해 필요한 50건만 읽어 오는 것이 효율적인지 옵티마이저는 판단해야 합니다. 일반적으로 DBMS의 옵티아미저에서 인덱스를 통해 레코드를 1건 읽는 것은 테이블에서 직접 레코드 1건을 읽는 것보다 45배 정도 비용이 발생한다고 예측합니다. 즉, 인덱스를 통해 읽어야 할 레코드의 건수(옵티마이저가 예측한)가 전체 테이블의 2025%를 넘어서면 인덱스를 이용하지 않고 직접 테이블을 모두 읽어서 필요한 레코드만 필터링하는 방식이 효율적이라고 판단하게 됩니다.\n즉, 옵티마이저가 인덱스를 통한 비용 보다 테이블에서 직접 레코드를 읽는 것이 더 효율적이라고 판단하고 Full Scan을 진행한 것입니다.\n정리\n초반 청크에서는 WHERE 조건이 인덱스 칼럼만으로 처리(커버링 인덱스)가 진행돼서 그나마 빠르지만 후반 청크에서는 페이징 쿼리가 커버링 인덱스로 처리되지 못하게 되고 해당 데이터를 풀 스캔해서 디스크로부터 가져오기 때문에 후반 청크가 느려지게 됩니다.\nQueryDslNoOffsetPagingReaderQueryDslNoOffsetPagingReader는 Spring Batch QuerydslItemReader 오픈소스 코드로 자세한 내용은 기억보단 기록을: Spring Batch와 QuerydslItemReader에 정리되어 있습니다.\n해당 내용을 간단하게 정리하면 다음과 같습니다.\n\nwhere AND id &lt; 마지막 조회 ID 조건으로 균일할 리드 속도를 보장\n복잡한 정렬 기준이(group by, 집계 쿼리 등등) 있는 경우 사용 불가능\n대량의 페이지 조회에 적합 (개인적으로 대략 5만 건 이상의 경우 사용이 적합하다고 생각합니다.)\n\nexplain: 첫 청크123456789101112explainselect payment0_.id         as id1_0_,       payment0_.amount     as amount2_0_,       payment0_.created_at as created_3_0_,       payment0_.order_id   as order_id4_0_,       payment0_.updated_at as updated_5_0_from payment payment0_where payment0_.created_at &gt;= &#x27;2021-05-30 00:00:00&#x27;  and payment0_.id &gt;= 1  and payment0_.id &lt;= 1000order by payment0_.id asclimit 1000;\n\n\n\nid\nselect_type\ntable\npartitions\ntype\npossible_keys\nkey\nkey_len\nref\nrows\nfiltered\nExtra\n\n\n\n1\nSIMPLE\npayment0_\nNULL\nrange\nPRIMARY,IDXfxl3u00ue9kdoqelvslc1tj6h\nPRIMARY\n8\nNULL\n1000\n50\nUsing where\n\n\n\nexplain: 마지막 청크123456789101112explainselect payment0_.id         as id1_0_,       payment0_.amount     as amount2_0_,       payment0_.created_at as created_3_0_,       payment0_.order_id   as order_id4_0_,       payment0_.updated_at as updated_5_0_from payment payment0_where payment0_.created_at &gt;= &#x27;2021-05-30 00:00:00&#x27;  and payment0_.id &gt;= 4999001  and payment0_.id &lt;= 5000000order by payment0_.id asclimit 1000;\n\n\n\n\nid\nselect_type\ntable\npartitions\ntype\npossible_keys\nkey\nkey_len\nref\nrows\nfiltered\nExtra\n\n\n\n1\nSIMPLE\npayment0_\nNULL\nrange\nPRIMARY,IDXfxl3u00ue9kdoqelvslc1tj6h\nPRIMARY\n8\nNULL\n1000\n50\nUsing where\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ntype: range 인덱스 특정 범위의 행에 접근, 즉 인덱스가 제대로 동작\npossible_keys: PRIMARY, IDXfxl3u00ue9kdoqelvslc1tj6h(created_at)는 id, created_at 칼럼 인덱스로 사용 가능\nkey: PRIMARY: possible_keys 필드 중 id를 인덱스로 사용, InnoDB 테이블에서는 기본적으로 PRIMARY 키를 기준으로 클러스터링 되어 저장되기 때문에 실행 계획에서 PRIMARY 키는 기본적으로 다른 보조인덱스에 비해 비중이 높게 설정된다.\nExtra: Using where 테이블에서 행을 가져온 후 추가적으로 검색 조건을 적용해 행의 범위를 축소\n\n첫 청크와 마지막 청크의 실행 계획이 동일한 것을 확인할 수 있습니다. 즉 해당 리더는 청크 사이즈, 데이터 총 rows와 별개로 조회 시간이 균일합니다.\n다음편은 Spring Batch Reader 성능 분석 및 측정 part 2를 참고해주세요.\n참고\nSpring Batch - Reference Documentation\nReal MySQL 개발자와 DBA를 위한\nMySQL 5.7 완벽 분석 \n기억보단 기록을 - Spring Batch와 QuerydslItemReader\n\n","dateCreated":"2021-06-05T15:41:45+09:00","dateModified":"2025-01-31T04:41:33+09:00","datePublished":"2021-06-05T15:41:45+09:00","description":"스프링 배치 애플리케이션에서 데이터베이스의 대량의 데이터를 처리할 때 Reader에 대한 성능 분석과 성능에 대한 측정을 정리한 포스팅입니다.","headline":"Spring Batch Reader 성능 분석 및 측정 part 1","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://cheese10yun.github.io/spring-batch-reader-performance/"},"publisher":{"@type":"Organization","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg","logo":{"@type":"ImageObject","url":"yun-icon.jpg"}},"url":"https://cheese10yun.github.io/spring-batch-reader-performance/","keywords":"Performance, Spring Batch"}</script>
    <meta name="description" content="스프링 배치 애플리케이션에서 데이터베이스의 대량의 데이터를 처리할 때 Reader에 대한 성능 분석과 성능에 대한 측정을 정리한 포스팅입니다.">
<meta property="og:type" content="blog">
<meta property="og:title" content="Spring Batch Reader 성능 분석 및 측정 part 1">
<meta property="og:url" content="https://cheese10yun.github.io/spring-batch-reader-performance/index.html">
<meta property="og:site_name" content="Yun Blog">
<meta property="og:description" content="스프링 배치 애플리케이션에서 데이터베이스의 대량의 데이터를 처리할 때 Reader에 대한 성능 분석과 성능에 대한 측정을 정리한 포스팅입니다.">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/reader-performance-1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/reader-performance.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/explain_1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/explan_2.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/limit_3.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/explain_3.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/explain_4.png">
<meta property="article:published_time" content="2021-06-05T06:41:45.000Z">
<meta property="article:modified_time" content="2025-01-30T19:41:33.935Z">
<meta property="article:author" content="Yun">
<meta property="article:tag" content="Performance">
<meta property="article:tag" content="Spring Batch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/reader-performance-1.png">
    
    
        
    
    
        <meta property="og:image" content="https://cheese10yun.github.io/assets/images/yun-icon.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90907312-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90907312-1');
    </script>


    

    
        
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5813739623204880" crossorigin="anonymous"></script>
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Yun Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="링크 열기: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="저자에 대해 더 알아보기"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
                </a>
                <h4 class="sidebar-profile-name">Yun</h4>
                
                    <h5 class="sidebar-profile-bio"><p>기술 블로그</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="카테고리"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">카테고리</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="태그"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">태그</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="아카이브"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">아카이브</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="검색"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">검색</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/cheese10yun"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/rss2.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Spring Batch Reader 성능 분석 및 측정 part 1
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2021-06-05T15:41:45+09:00">
	
		    2021/06/05
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>스프링 배치 애플리케이션에서 데이터베이스의 대량의 데이터를 처리할 때 Reader에 대한 성능 분석과 성능에 대한 측정을 정리한 포스팅입니다.</p>
<h2 id="조회-대상"><a href="#조회-대상" class="headerlink" title="조회 대상"></a>조회 대상</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># created_at 인덱스</span><br><span class="line"><span class="keyword">CREATE TABLE</span> `payment`</span><br><span class="line">(</span><br><span class="line">    `id`         <span class="type">bigint</span>(<span class="number">20</span>)     <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">    `amount`     <span class="type">decimal</span>(<span class="number">19</span>, <span class="number">2</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    `created_at` datetime       <span class="keyword">NOT NULL</span>,</span><br><span class="line">    `order_id`   <span class="type">bigint</span>(<span class="number">20</span>)     <span class="keyword">NOT NULL</span>,</span><br><span class="line">    `updated_at` datetime       <span class="keyword">NOT NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY KEY</span> (`id`),</span><br><span class="line">    KEY `IDXfxl3u00ue9kdoqelvslc1tj6h` (`created_at`)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  AUTO_INCREMENT <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8mb4</span><br><span class="line">  <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_unicode_ci</span><br></pre></td></tr></table></figure>

<p>가장 최근 데이터부터 데이터를 읽어 특정 날짜까지 데이터를 읽는 기준으로 Item Reader를 작성했습니다.</p>
<h2 id="대상-리더"><a href="#대상-리더" class="headerlink" title="대상 리더"></a>대상 리더</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-batch/docs/current/api/org/springframework/batch/item/database/JpaPagingItemReader.html">JpaPagingItemReader</a></li>
<li><a target="_blank" rel="noopener" href="https://jojoldu.tistory.com/473?category=902551">QueryDslNoOffsetPagingReader</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-batch/docs/current/reference/html/readersAndWriters.html#JdbcCursorItemReader">HibernateCursorItemReader</a></li>
</ul>
<h2 id="성능"><a href="#성능" class="headerlink" title="성능"></a>성능</h2><h3 id="전체-성능-표"><a href="#전체-성능-표" class="headerlink" title="전체 성능 표"></a>전체 성능 표</h3><table>
<thead>
<tr>
<th>Reader</th>
<th>rows</th>
<th>Chunk Size</th>
<th>소요 시간(ms)</th>
</tr>
</thead>
<tbody><tr>
<td>JpaPagingItemReader</td>
<td>10,000</td>
<td>1000</td>
<td>778</td>
</tr>
<tr>
<td>JpaPagingItemReader</td>
<td>50,000</td>
<td>1000</td>
<td>3243</td>
</tr>
<tr>
<td>JpaPagingItemReader</td>
<td>100,000</td>
<td>1000</td>
<td>8912</td>
</tr>
<tr>
<td>JpaPagingItemReader</td>
<td>500,000</td>
<td>1000</td>
<td>205469</td>
</tr>
<tr>
<td>JpaPagingItemReader</td>
<td>1,000,000</td>
<td>1000</td>
<td>1048979</td>
</tr>
<tr>
<td>JpaPagingItemReader</td>
<td>5,000,000</td>
<td>1000</td>
<td>…</td>
</tr>
<tr>
<td>QueryDslNoOffsetPagingReader</td>
<td>10,000</td>
<td>1000</td>
<td>658</td>
</tr>
<tr>
<td>QueryDslNoOffsetPagingReader</td>
<td>50,000</td>
<td>1000</td>
<td>2004</td>
</tr>
<tr>
<td>QueryDslNoOffsetPagingReader</td>
<td>100,000</td>
<td>1000</td>
<td>3523</td>
</tr>
<tr>
<td>QueryDslNoOffsetPagingReader</td>
<td>500,000</td>
<td>1000</td>
<td>15501</td>
</tr>
<tr>
<td>QueryDslNoOffsetPagingReader</td>
<td>1,000,000</td>
<td>1000</td>
<td>28732</td>
</tr>
<tr>
<td>QueryDslNoOffsetPagingReader</td>
<td>5,000,000</td>
<td>1000</td>
<td>165249</td>
</tr>
<tr>
<td>HibernateCursorItemReader</td>
<td>10,000</td>
<td>1000</td>
<td>448</td>
</tr>
<tr>
<td>HibernateCursorItemReader</td>
<td>50,000</td>
<td>1000</td>
<td>1605</td>
</tr>
<tr>
<td>HibernateCursorItemReader</td>
<td>100,000</td>
<td>1000</td>
<td>2886</td>
</tr>
<tr>
<td>HibernateCursorItemReader</td>
<td>500,000</td>
<td>1000</td>
<td>17411</td>
</tr>
<tr>
<td>HibernateCursorItemReader</td>
<td>1,000,000</td>
<td>1000</td>
<td>25439</td>
</tr>
<tr>
<td>HibernateCursorItemReader</td>
<td>5,000,000</td>
<td>1000</td>
<td>132552</td>
</tr>
</tbody></table>
<p><code>JpaPagingItemReader</code>의 rows <code>5,000,000</code> 측정은 너무 걸려 측정하지 못했습니다. 대략 5시간 이상까지 측정하다 종료했습니다.</p>
<h3 id="성능-그래프"><a href="#성능-그래프" class="headerlink" title="성능 그래프"></a>성능 그래프</h3><p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/reader-performance-1.png"></p>
<p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/reader-performance.png"></p>
<p><code>JpaPagingItemReader</code> 리더의 시간이 너무 오래 소요되어  <code>QueryDslNoOffsetPagingReader</code>, <code>HibernateCursorItemReader</code> 리더 비교</p>
<h2 id="전체-코드"><a href="#전체-코드" class="headerlink" title="전체 코드"></a>전체 코드</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ReaderPerformanceJobConfiguration</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> jobBuilderFactory: JobBuilderFactory,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> stepBuilderFactory: StepBuilderFactory</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">val</span> log <span class="keyword">by</span> logger()</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">readerPerformanceJob</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        jobDataSetUpListener: <span class="type">JobDataSetUpListener</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        readerPerformanceStep: <span class="type">Step</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> = jobBuilderFactory[<span class="string">&quot;readerPerformanceJob&quot;</span>]</span><br><span class="line">        .incrementer(RunIdIncrementer())</span><br><span class="line">        .start(readerPerformanceStep)</span><br><span class="line">        .build()</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@JobScope</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">readerPerformanceStep</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        jpaPagingItemReader: <span class="type">JpaPagingItemReader</span>&lt;<span class="type">Payment</span>&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">        hibernateCursorItemReader: <span class="type">HibernateCursorItemReader</span>&lt;<span class="type">Payment</span>&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">        queryDslNoOffsetPagingReader: <span class="type">QuerydslNoOffsetPagingItemReader</span>&lt;<span class="type">Payment</span>&gt;</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> =</span><br><span class="line">        stepBuilderFactory[<span class="string">&quot;readerPerformanceStep&quot;</span>]</span><br><span class="line">            .chunk&lt;Payment, Payment&gt;(CHUNK_SIZE)</span><br><span class="line"><span class="comment">// 해당 Reader 중 택 1</span></span><br><span class="line"><span class="comment">//            .reader(jpaPagingItemReader)</span></span><br><span class="line"><span class="comment">//            .reader(queryDslNoOffsetPagingReader)</span></span><br><span class="line"><span class="comment">//            .reader(hibernateCursorItemReader)</span></span><br><span class="line">            .writer &#123; log.info(<span class="string">&quot;item size <span class="subst">$&#123;it.size&#125;</span>&quot;</span>) &#125;</span><br><span class="line">            .build()</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@StepScope</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">jpaPagingItemReader</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        entityManagerFactory: <span class="type">EntityManagerFactory</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> = JpaPagingItemReaderBuilder&lt;Payment&gt;()</span><br><span class="line">        .name(<span class="string">&quot;jpaPagingItemReader&quot;</span>)</span><br><span class="line">        .pageSize(CHUNK_SIZE)</span><br><span class="line">        .entityManagerFactory(entityManagerFactory)</span><br><span class="line">        .queryString(<span class="string">&quot;SELECT p FROM Payment p where p.createdAt &gt;= :createdAt ORDER BY p.createdAt DESC&quot;</span>)</span><br><span class="line">        .parameterValues(mapOf(<span class="string">&quot;createdAt&quot;</span> to LocalDateTime.now().withHour(<span class="number">0</span>).withMinute(<span class="number">0</span>).withSecond(<span class="number">0</span>).withNano(<span class="number">0</span>)))</span><br><span class="line">        .build()</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@StepScope</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">queryDslNoOffsetPagingReader</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        entityManagerFactory: <span class="type">EntityManagerFactory</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: QuerydslNoOffsetPagingItemReader&lt;Payment&gt; &#123;</span><br><span class="line">        <span class="comment">// 1. No Offset Option</span></span><br><span class="line">        <span class="keyword">val</span> options = QuerydslNoOffsetNumberOptions&lt;Payment, <span class="built_in">Long</span>&gt;(qPayment.id, Expression.ASC)</span><br><span class="line">        <span class="comment">// 2. Querydsl Reader</span></span><br><span class="line">        <span class="keyword">return</span> QuerydslNoOffsetPagingItemReader(entityManagerFactory, CHUNK_SIZE, options) &#123;</span><br><span class="line">            it.selectFrom(qPayment)</span><br><span class="line">                .<span class="keyword">where</span>(qPayment.createdAt.goe(LocalDateTime.now().withHour(<span class="number">0</span>).withMinute(<span class="number">0</span>).withSecond(<span class="number">0</span>).withNano(<span class="number">0</span>)))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@StepScope</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">hibernateCursorItemReader</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        sessionFactory: <span class="type">SessionFactory</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> = HibernateCursorItemReaderBuilder&lt;Payment&gt;()</span><br><span class="line">        .name(<span class="string">&quot;hibernateCursorItemReader&quot;</span>)</span><br><span class="line">        .fetchSize()</span><br><span class="line">        .sessionFactory(sessionFactory)</span><br><span class="line">        .queryString(<span class="string">&quot;SELECT p FROM Payment p where p.createdAt &gt;= :createdAt ORDER BY p.createdAt DESC&quot;</span>)</span><br><span class="line">        .parameterValues(mapOf(<span class="string">&quot;createdAt&quot;</span> to LocalDateTime.now().withHour(<span class="number">0</span>).withMinute(<span class="number">0</span>).withSecond(<span class="number">0</span>).withNano(<span class="number">0</span>)))</span><br><span class="line">        .build()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JpaPagingItemReader"><a href="#JpaPagingItemReader" class="headerlink" title="JpaPagingItemReader"></a>JpaPagingItemReader</h2><p><code>JpaPagingItemReader</code>눈 Spring Batch에서 제공해 주는 ItemReader로 일반적인 페이징 방식을 통해서 가져오는 방식입니다. 모든 데이터를 한 번에 가져와서 처리할 수는 없으니 <code>offset</code>, <code>limit</code> 방식으로 데이터를 가져옵니다. 실제 쿼리는 다음과 같습니다.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> payment0_.id         <span class="keyword">as</span> id1_0_,</span><br><span class="line">       payment0_.amount     <span class="keyword">as</span> amount2_0_,</span><br><span class="line">       payment0_.created_at <span class="keyword">as</span> created_3_0_,</span><br><span class="line">       payment0_.order_id   <span class="keyword">as</span> order_id4_0_,</span><br><span class="line">       payment0_.updated_at <span class="keyword">as</span> updated_5_0_</span><br><span class="line"><span class="keyword">from</span> payment payment0_</span><br><span class="line"><span class="keyword">where</span> payment0_.created_at <span class="operator">&gt;=</span> ?</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> payment0_.created_at <span class="keyword">DESC</span></span><br><span class="line">    limit ?, ?</span><br></pre></td></tr></table></figure>

<p>해당 리더는 위 그래프에서 확인했듯이 다른 리더에 비해서 현저하게 드립니다. <strong>읽어야 할 총 데이터가 많고, 청크 후반으로 갈수록 더욱 느려집니다.</strong></p>
<h3 id="1-2-번째-조회"><a href="#1-2-번째-조회" class="headerlink" title="1 ~ 2 번째 조회"></a>1 ~ 2 번째 조회</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: <span class="keyword">select</span> payment0_.id <span class="keyword">as</span> id1_0_, payment0_.amount <span class="keyword">as</span> amount2_0_, payment0_.created_at <span class="keyword">as</span> created_3_0_, payment0_.order_id <span class="keyword">as</span> order_id4_0_, payment0_.updated_at <span class="keyword">as</span> updated_5_0_ <span class="keyword">from</span> payment payment0_ <span class="keyword">where</span> payment0_.created_at<span class="operator">&gt;=</span>? <span class="keyword">order</span> <span class="keyword">by</span> payment0_.created_at <span class="keyword">DESC</span> limit ?</span><br><span class="line"><span class="number">2021</span><span class="number">-05</span><span class="number">-25</span> <span class="number">22</span>:<span class="number">40</span>:<span class="number">25.963</span>  INFO <span class="number">93165</span> <span class="comment">--- [           main] uration$$EnhancerBySpringCGLIB$$d8232fb2 : item size 1000</span></span><br><span class="line">Hibernate: <span class="keyword">select</span> payment0_.id <span class="keyword">as</span> id1_0_, payment0_.amount <span class="keyword">as</span> amount2_0_, payment0_.created_at <span class="keyword">as</span> created_3_0_, payment0_.order_id <span class="keyword">as</span> order_id4_0_, payment0_.updated_at <span class="keyword">as</span> updated_5_0_ <span class="keyword">from</span> payment payment0_ <span class="keyword">where</span> payment0_.created_at<span class="operator">&gt;=</span>? <span class="keyword">order</span> <span class="keyword">by</span> payment0_.created_at <span class="keyword">DESC</span> limit ?, ?</span><br><span class="line"><span class="number">2021</span><span class="number">-05</span><span class="number">-25</span> <span class="number">22</span>:<span class="number">40</span>:<span class="number">26.016</span>  INFO <span class="number">93165</span> <span class="comment">--- [           main] uration$$EnhancerBySpringCGLIB$$d8232fb2 : item size 1000</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>첫 조회 이후 두 번째 조회까지의 시간은 <code>26.016 - 25.963 = 0.053</code>의 짧은 시간밖에 걸리지 않았습니다.</p>
<h3 id="49-990-000-5-000-0000-조회"><a href="#49-990-000-5-000-0000-조회" class="headerlink" title="49,990,000 ~ 5,000,0000 조회"></a>49,990,000 ~ 5,000,0000 조회</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2021-05-31 02:24:27.943  INFO 13475 --- [           main] uration$$EnhancerBySpringCGLIB$$4d92f8c5 : item size 1000</span><br><span class="line">Hibernate: select payment0_.id as id1_0_, payment0_.amount as amount2_0_, payment0_.created_at as created_3_0_, payment0_.order_id as order_id4_0_, payment0_.updated_at as updated_5_0_ from payment payment0_ where payment0_.created_at&gt;=? order by payment0_.created_at DESC limit ?, ?</span><br><span class="line">2021-05-31 02:25:18.092  INFO 13475 --- [           main] uration$$EnhancerBySpringCGLIB$$4d92f8c5 : item size 1000</span><br><span class="line">Hibernate: select payment0_.id as id1_0_, payment0_.amount as amount2_0_, payment0_.created_at as created_3_0_, payment0_.order_id as order_id4_0_, payment0_.updated_at as updated_5_0_ from payment payment0_ where payment0_.created_at&gt;=? order by payment0_.created_at DESC limit ?, ?</span><br></pre></td></tr></table></figure>

<p>마지막 청크 사이즈 조회하는 시간은 <code>25:18.092 - 24:27.943</code> 대략 51초가 걸렸습니다. <strong>즉 해당 리더는 초반 청크는 빠르지만 후반으로 갈수록 청크를 읽는 부분이 느려지며, 데이터가 많으면 많을수록 더 느려지는 것을 확인할 수 있습니다.</strong></p>
<h3 id="왜-후반-리드에서-느려지는-것일까"><a href="#왜-후반-리드에서-느려지는-것일까" class="headerlink" title="왜 후반 리드에서 느려지는 것일까?"></a>왜 후반 리드에서 느려지는 것일까?</h3><h4 id="explain-첫-청크"><a href="#explain-첫-청크" class="headerlink" title="explain: 첫 청크"></a>explain: 첫 청크</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> payment0_.id         <span class="keyword">as</span> id1_0_,</span><br><span class="line">       payment0_.amount     <span class="keyword">as</span> amount2_0_,</span><br><span class="line">       payment0_.created_at <span class="keyword">as</span> created_3_0_,</span><br><span class="line">       payment0_.order_id   <span class="keyword">as</span> order_id4_0_,</span><br><span class="line">       payment0_.updated_at <span class="keyword">as</span> updated_5_0_</span><br><span class="line"><span class="keyword">from</span> payment payment0_</span><br><span class="line"><span class="keyword">where</span> payment0_.created_at <span class="operator">&gt;=</span> <span class="string">&#x27;2021-05-30 00:00:00&#x27;</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> payment0_.created_at <span class="keyword">DESC</span></span><br><span class="line">limit <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">id</th>
<th align="left">select_type</th>
<th align="left">table</th>
<th align="left">partitions</th>
<th align="left">type</th>
<th align="left">possible_keys</th>
<th align="left">key</th>
<th align="left">key_len</th>
<th align="left">ref</th>
<th align="left">rows</th>
<th align="left">filtered</th>
<th align="left">Extra</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">SIMPLE</td>
<td align="left">payment0_</td>
<td align="left">NULL</td>
<td align="left">range</td>
<td align="left">IDXfxl3u00ue9kdoqelvslc1tj6h</td>
<td align="left">IDXfxl3u00ue9kdoqelvslc1tj6h</td>
<td align="left">5</td>
<td align="left">NULL</td>
<td align="left">2306025</td>
<td align="left">100</td>
<td align="left">Using index condition</td>
</tr>
</tbody></table>
<p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/explain_1.png"></p>
<ul>
<li><code>type: range</code> 인덱스 특정 범위의 행에 접근, 즉 인덱스가 제대로 동작</li>
<li><code>possible_keys: IDXfxl3u00ue9kdoqelvslc1tj6h(created_at)</code>  이용 가능성 있는 인덱스의 목록</li>
<li><code>key: IDXfxl3u00ue9kdoqelvslc1tj6h(created_at)</code>: <code>possible_keys</code> 필드는 이용 가능성 있는 인덱스의 목록 중에서 실제로 옵티마이저가 선택한 인덱스의 key</li>
<li><code>rows: 2306025</code> 특정 rows을 찾기 위해 읽어야 하는 MySQL 예상 rows, 단 어디까지나 통계 값으로 계산한 값이므로 실제 rows 수와 반드시 일치하지 않는다.</li>
<li><code>filtered: 100</code> rows 데이터를 가져와 WHERE 구의 검색 조건이 적용되면 몇행이 남는지를 표시, 이 값도 통계 값 바탕으로 계산한 값이므로 현실의 값과 반드시 일치하지 않는다.</li>
<li><code>Extra: Using index condition</code> 인덱스 컨디션 pushdown(ICP) 최적화가 진행(<code>Using index</code>와 비슷한 개념으로 인덱스에서만 접근해서 쿼티를 해결하는 것을 의미, 정확히 알고 있는 개념은 아니라서 <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.6/en/index-condition-pushdown-optimization.html">Index Condition Pushdown Optimization</a>참고)</li>
</ul>
<p>해당 실행 계획을 정리하면 <code>created_at</code> 인덱스가 <code>type: range</code>로 제대로 동작했습니다. 하지만 <code>rows: 2306025</code>인 것을 봐서 상당히 많은 rows를 읽은 이후에 해당 rows를 찾는 거 같습니다. 대략 <code>limit 2000000, 1000</code>까지는 첫 청크 인덱스와 동일하게 <code>type: range</code>의 실행 계획을 가졌습니다.</p>
<h4 id="explain-마지막-청크"><a href="#explain-마지막-청크" class="headerlink" title="explain: 마지막 청크"></a>explain: 마지막 청크</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> payment0_.id         <span class="keyword">as</span> id1_0_,</span><br><span class="line">       payment0_.amount     <span class="keyword">as</span> amount2_0_,</span><br><span class="line">       payment0_.created_at <span class="keyword">as</span> created_3_0_,</span><br><span class="line">       payment0_.order_id   <span class="keyword">as</span> order_id4_0_,</span><br><span class="line">       payment0_.updated_at <span class="keyword">as</span> updated_5_0_</span><br><span class="line"><span class="keyword">from</span> payment payment0_</span><br><span class="line"><span class="keyword">where</span> payment0_.created_at <span class="operator">&gt;=</span> <span class="string">&#x27;2021-05-30 00:00:00&#x27;</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> payment0_.created_at <span class="keyword">DESC</span></span><br><span class="line">limit <span class="number">4999000</span>, <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">id</th>
<th align="left">select_type</th>
<th align="left">table</th>
<th align="left">partitions</th>
<th align="left">type</th>
<th align="left">possible_keys</th>
<th align="left">key</th>
<th align="left">key_len</th>
<th align="left">ref</th>
<th align="left">rows</th>
<th align="left">filtered</th>
<th align="left">Extra</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">SIMPLE</td>
<td align="left">payment0_</td>
<td align="left">NULL</td>
<td align="left">ALL</td>
<td align="left">IDXfxl3u00ue9kdoqelvslc1tj6h</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
<td align="left">NULL</td>
<td align="left">4612051</td>
<td align="left">50</td>
<td align="left">Using where; Using filesort</td>
</tr>
</tbody></table>
<p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/explan_2.png"></p>
<ul>
<li><code>type: ALL</code> <strong>풀 스캔, 테이블의 데이터 전체에 접근</strong></li>
<li><code>key: NULL</code>: <code>possible_keys</code> 필드를 이용하지 않음, 즉 인덱스 사용 안 함</li>
<li><code>Extra</code><ul>
<li><code>Using where</code> <strong>테이블에서 행을 가져온 후 추가적으로 검색 조건을 적용해 행의 범위를 축소</strong></li>
<li><code>Using filesort</code> <strong>ORDER BY 인덱스로 해결하지 못하고, filesort(MySQL의 quick sort)로 행을 정렬</strong></li>
</ul>
</li>
</ul>
<p>특정 청크 이후부터는 index를 타지 못하고 풀 스캔이 진행되고 있습니다. 당연히 해당 쿼리는 느릴 수밖에 없습니다.</p>
<h4 id="왜-후반-청크에서는-Full-Scan을-하는-것일까"><a href="#왜-후반-청크에서는-Full-Scan을-하는-것일까" class="headerlink" title="왜 후반 청크에서는 Full Scan을 하는 것일까?"></a>왜 후반 청크에서는 Full Scan을 하는 것일까?</h4><p><strong>인덱스를 통해 테이블의 레코드를 읽는 것은 인덱스를 거치지 않고 바로 테이블의 레코드를 읽는 것보다 높은 비용이 드는 작업입니다.</strong> 만약 100만 건의 레코드가 있다고 가정하고 그중 50만 건을 읽어야 하는 쿼리가 있다고 하면 테이블 전체를 읽어서 필요 없는 50만 건을 버리는 것이 효율적인지, 인덱스를 통해 필요한 50건만 읽어 오는 것이 효율적인지 옵티마이저는 판단해야 합니다. <strong>일반적으로 DBMS의 옵티아미저에서 인덱스를 통해 레코드를 1건 읽는 것은 테이블에서 직접 레코드 1건을 읽는 것보다 4<del>5배 정도 비용이 발생한다고 예측합니다. 즉, 인덱스를 통해 읽어야 할 레코드의 건수(옵티마이저가 예측한)가 전체 테이블의 20</del>25%를 넘어서면 인덱스를 이용하지 않고 직접 테이블을 모두 읽어서 필요한 레코드만 필터링하는 방식이 효율적이라고 판단하게 됩니다.</strong></p>
<p>즉, 옵티마이저가 인덱스를 통한 비용 보다 테이블에서 직접 레코드를 읽는 것이 더 효율적이라고 판단하고 Full Scan을 진행한 것입니다.</p>
<h3 id="정리"><a href="#정리" class="headerlink" title="정리"></a>정리</h3><p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/limit_3.png"></p>
<p>초반 청크에서는 WHERE 조건이 인덱스 칼럼만으로 처리(커버링 인덱스)가 진행돼서 그나마 빠르지만 <strong>후반 청크에서는 페이징 쿼리가 커버링 인덱스로 처리되지 못하게 되고 해당 데이터를 풀 스캔해서 디스크로부터 가져오기 때문에 후반 청크가 느려지게 됩니다.</strong></p>
<h2 id="QueryDslNoOffsetPagingReader"><a href="#QueryDslNoOffsetPagingReader" class="headerlink" title="QueryDslNoOffsetPagingReader"></a>QueryDslNoOffsetPagingReader</h2><p>QueryDslNoOffsetPagingReader는 <a target="_blank" rel="noopener" href="https://github.com/jojoldu/spring-batch-querydsl">Spring Batch QuerydslItemReader</a> 오픈소스 코드로 자세한 내용은 <a target="_blank" rel="noopener" href="https://jojoldu.tistory.com/473?category=902551">기억보단 기록을: Spring Batch와 QuerydslItemReader</a>에 정리되어 있습니다.</p>
<p>해당 내용을 간단하게 정리하면 다음과 같습니다.</p>
<ol>
<li><code>where AND id &lt; 마지막 조회 ID</code> 조건으로 균일할 리드 속도를 보장</li>
<li>복잡한 정렬 기준이(group by, 집계 쿼리 등등) 있는 경우 사용 불가능</li>
<li>대량의 페이지 조회에 적합 (개인적으로 대략 5만 건 이상의 경우 사용이 적합하다고 생각합니다.)</li>
</ol>
<h3 id="explain-첫-청크-1"><a href="#explain-첫-청크-1" class="headerlink" title="explain: 첫 청크"></a>explain: 첫 청크</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">explain</span><br><span class="line"><span class="keyword">select</span> payment0_.id         <span class="keyword">as</span> id1_0_,</span><br><span class="line">       payment0_.amount     <span class="keyword">as</span> amount2_0_,</span><br><span class="line">       payment0_.created_at <span class="keyword">as</span> created_3_0_,</span><br><span class="line">       payment0_.order_id   <span class="keyword">as</span> order_id4_0_,</span><br><span class="line">       payment0_.updated_at <span class="keyword">as</span> updated_5_0_</span><br><span class="line"><span class="keyword">from</span> payment payment0_</span><br><span class="line"><span class="keyword">where</span> payment0_.created_at <span class="operator">&gt;=</span> <span class="string">&#x27;2021-05-30 00:00:00&#x27;</span></span><br><span class="line">  <span class="keyword">and</span> payment0_.id <span class="operator">&gt;=</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">and</span> payment0_.id <span class="operator">&lt;=</span> <span class="number">1000</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> payment0_.id <span class="keyword">asc</span></span><br><span class="line">limit <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th align="left">id</th>
<th align="left">select_type</th>
<th align="left">table</th>
<th align="left">partitions</th>
<th align="left">type</th>
<th align="left">possible_keys</th>
<th align="left">key</th>
<th align="left">key_len</th>
<th align="left">ref</th>
<th align="left">rows</th>
<th align="left">filtered</th>
<th align="left">Extra</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">SIMPLE</td>
<td align="left">payment0_</td>
<td align="left">NULL</td>
<td align="left">range</td>
<td align="left">PRIMARY,IDXfxl3u00ue9kdoqelvslc1tj6h</td>
<td align="left">PRIMARY</td>
<td align="left">8</td>
<td align="left">NULL</td>
<td align="left">1000</td>
<td align="left">50</td>
<td align="left">Using where</td>
</tr>
</tbody></table>
<p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/explain_3.png"></p>
<h3 id="explain-마지막-청크-1"><a href="#explain-마지막-청크-1" class="headerlink" title="explain: 마지막 청크"></a>explain: 마지막 청크</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">explain</span><br><span class="line"><span class="keyword">select</span> payment0_.id         <span class="keyword">as</span> id1_0_,</span><br><span class="line">       payment0_.amount     <span class="keyword">as</span> amount2_0_,</span><br><span class="line">       payment0_.created_at <span class="keyword">as</span> created_3_0_,</span><br><span class="line">       payment0_.order_id   <span class="keyword">as</span> order_id4_0_,</span><br><span class="line">       payment0_.updated_at <span class="keyword">as</span> updated_5_0_</span><br><span class="line"><span class="keyword">from</span> payment payment0_</span><br><span class="line"><span class="keyword">where</span> payment0_.created_at <span class="operator">&gt;=</span> <span class="string">&#x27;2021-05-30 00:00:00&#x27;</span></span><br><span class="line">  <span class="keyword">and</span> payment0_.id <span class="operator">&gt;=</span> <span class="number">4999001</span></span><br><span class="line">  <span class="keyword">and</span> payment0_.id <span class="operator">&lt;=</span> <span class="number">5000000</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> payment0_.id <span class="keyword">asc</span></span><br><span class="line">limit <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">id</th>
<th align="left">select_type</th>
<th align="left">table</th>
<th align="left">partitions</th>
<th align="left">type</th>
<th align="left">possible_keys</th>
<th align="left">key</th>
<th align="left">key_len</th>
<th align="left">ref</th>
<th align="left">rows</th>
<th align="left">filtered</th>
<th align="left">Extra</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">SIMPLE</td>
<td align="left">payment0_</td>
<td align="left">NULL</td>
<td align="left">range</td>
<td align="left">PRIMARY,IDXfxl3u00ue9kdoqelvslc1tj6h</td>
<td align="left">PRIMARY</td>
<td align="left">8</td>
<td align="left">NULL</td>
<td align="left">1000</td>
<td align="left">50</td>
<td align="left">Using where</td>
</tr>
<tr>
<td align="left"><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/batch-study/docs/img/explain_4.png"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<ul>
<li><code>type: range</code> 인덱스 특정 범위의 행에 접근, 즉 인덱스가 제대로 동작</li>
<li><code>possible_keys: PRIMARY, IDXfxl3u00ue9kdoqelvslc1tj6h(created_at)</code>는 <code>id</code>, <code>created_at</code> 칼럼 인덱스로 사용 가능</li>
<li><code>key: PRIMARY</code>: <code>possible_keys</code> 필드 중 <code>id</code>를 인덱스로 사용, InnoDB 테이블에서는 기본적으로 <code>PRIMARY</code> 키를 기준으로 클러스터링 되어 저장되기 때문에 실행 계획에서 <code>PRIMARY</code> 키는 기본적으로 다른 보조인덱스에 비해 비중이 높게 설정된다.</li>
<li><code>Extra: Using where</code> <strong>테이블에서 행을 가져온 후 추가적으로 검색 조건을 적용해 행의 범위를 축소</strong></li>
</ul>
<p><strong>첫 청크와 마지막 청크의 실행 계획이 동일한 것을 확인할 수 있습니다. 즉 해당 리더는 청크 사이즈, 데이터 총 rows와 별개로 조회 시간이 균일합니다.</strong></p>
<p>다음편은 <a href="https://cheese10yun.github.io/spring-batch-reader-performance-2/">Spring Batch Reader 성능 분석 및 측정 part 2</a>를 참고해주세요.</p>
<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-batch/docs/current/reference/html/index.html">Spring Batch - Reference Documentation</a></li>
<li><a target="_blank" rel="noopener" href="http://www.yes24.com/Product/Goods/6960931">Real MySQL 개발자와 DBA를 위한</a></li>
<li><a target="_blank" rel="noopener" href="http://www.yes24.com/Product/Goods/72270172">MySQL 5.7 완벽 분석 </a></li>
<li><a target="_blank" rel="noopener" href="https://jojoldu.tistory.com/473?category=902551">기억보단 기록을 - Spring Batch와 QuerydslItemReader</a></li>
</ul>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">태그</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/Performance/" rel="tag">Performance</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Spring-Batch/" rel="tag">Spring Batch</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/spring-batch-reader-performance-2/"
                    data-tooltip="Spring Batch Reader 성능 분석 및 측정 part 2"
                    aria-label="이전: Spring Batch Reader 성능 분석 및 측정 part 2"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/exposed/"
                    data-tooltip="Kotlin 기반 경량 ORM Exposed"
                    aria-label="다음: Kotlin 기반 경량 ORM Exposed"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-batch-reader-performance/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-batch-reader-performance/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://cheese10yun.github.io/spring-batch-reader-performance/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>


<!-- Comment -->
<!--  utteranc comment -->

<script src="https://utteranc.es/client.js"
        repo="cheese10yun/blog-comment"
        issue-term="title"
        label="Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Yun. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/spring-batch-reader-performance-2/"
                    data-tooltip="Spring Batch Reader 성능 분석 및 측정 part 2"
                    aria-label="이전: Spring Batch Reader 성능 분석 및 측정 part 2"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/exposed/"
                    data-tooltip="Kotlin 기반 경량 ORM Exposed"
                    aria-label="다음: Kotlin 기반 경량 ORM Exposed"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-batch-reader-performance/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-batch-reader-performance/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://cheese10yun.github.io/spring-batch-reader-performance/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-batch-reader-performance/"
                        aria-label="Facebook에 공유하기"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Facebook에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-batch-reader-performance/"
                        aria-label="Twitter에 공유하기"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Twitter에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://cheese10yun.github.io/spring-batch-reader-performance/"
                        aria-label="Google+에 공유하기"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Google+에 공유하기</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
            <h4 id="about-card-name">Yun</h4>
        
            <div id="about-card-bio"><p>기술 블로그</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
