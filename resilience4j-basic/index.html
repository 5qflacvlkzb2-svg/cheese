
<!DOCTYPE html>
<html lang="ko">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="naver-site-verification" content="a37ea649edf26e70c3de94f9cb034f9d6e11de3f" />
    <meta name="generator" content="Yun Blog">
    <title>Resilience4j를 이용한 서킷 브레이커 기초 - Yun Blog</title>
    <meta name="author" content="Yun">
    
        <meta name="keywords" content="Node,Spring,Spring Boot,Spring Batch,Kotlin,기술 블로그,JPA,Mongo,MySQL,OOP,">
    
    
    
        
            <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss2.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg"},"articleBody":"\nResilience4j 이론적인 설명은 스프링으로 하는 마이크로 서비스 구축을 참조했습니다.\n\n마이크로 서비스 사이의 통신이 이루어지는 대규모 시스템 환경에서 느리거나 응답하지 않은 다운스트림 서비스가 발생했을 때 그 피해를 최소화시키는 것이 서킷 브레이커의 가장 큰 핵심이라고 할 수 있습니다.\n대표적으로 마이크로 서비스의 응답이 늦거나 전혀 응답하지 않는 경우, 일시적인 네트워크 문제 등으로 요청이 무작위로 실패하는 경우 등이 이에 해당합니다.\nResilience4j 소개#\n\n서킷 브레이커는 다량의 오류를 감지하면 서킷을 열어 새 호출을 받지 않는다.\n서킷 브레이커는 서킷이 열려 있을 때 빠른 실패 로직을 수행한다. 즉 이어지는 호출에서 시간 초과, 예외 발생 등 오류가 발생하지 않게, 폴백 메서드 호출을 리다디렉션을 한다. 폴백 메서드에서 다양한 비즈니스 로직을 적용하면 로컬 캐시의 데이터를 반환하거나 즉각적인 오류 메시지를 반환하는 등 최적화된 응답을 생성할 수 있다. 이로써 의존하는 서비스의 응답 중단 때문에 마이크로 서비스가 응답하지 못하게 되는 문제를 방지할 수 있는다.\n시간이 지나면 서킷 브레이커는 반열림 상태로 전환돼 새로운 호출을 허용하며, 이를 통해 문제를 일으킨 원인이 사라졌는지 확인한다. 서킷 브레이커는 새로운 오류를 감지하면서 서킷을 다시 열고 빠른 실패 로직을 다시 수행하며, 오류가 사라졌으면 서킷을 닫고 정상 작동 상태로 돌아간다.\n\nResilience4j는 런타임에 다양한 방법으로 서킷 브레이커의 정보를 공개한다.\n\n서킷 브레이커의 현재 상태를 마이크로 서비스 액추에이터 상태 점검 엔드 포인트(&#x2F;actuator&#x2F;health)를 사용해 모니터링할 수 있다.\n서킷 브레이커는 상태 전이 등의 이벤트 액추에이터 엔드 포인트(&#x2F;actuator&#x2F;citcuitbreakerevents)를 게시한다.\n서킷 브레이커 스프링 부트의 매트릭스 시스템과 통합돼 있으며 이를 이용해 프로테우스와 같은 모니터링 도구에 메트릭을 게시할 수 있다.\n\nCircuitBreaker Config 설정#\n\n\nProperties\nDescription\n\n\n\nringBufferSizeInClosedState\n닫힌 상태에서의 호출 수로, 서킷을 열어 할지 결정할 때 사용한다.\n\n\nfailureRateThreshold\n실패한 호출에 대한 임계값(백분율)으로 이 값을 초과하면 서킷이 열린다.\n\n\nwaitInterval\n반열림 상태로 전환하기 전에 시킷을 열린 상태로 유지하는 시간\n\n\nringBufferSizeInHalfOpenState\n반열림 상태에서의 호출 수로, 서킷을 다시 열거나 닫힘 상태로 돌아갈지를 결정할 때 사용 한다.\n\n\nautomaticTransitionFromOpenToHalfOpenEnabled\n대기 시간이 지난 후에 서킷을 반열림 상태로 자동 전환할지, 첫 번째 호출이 들어오길 기다렸다가 반열림 상태로 전환할지를 결정한다.\n\n\nignoreExceptions\n오류를 간주하지 않을 예외를 지정한다. 보통 InvaildInputException, NotfoundExceotion과 같이 예상할 수 있는 비즈니스 예외는 서킷 브레이커에서 무시하는데, 존재하지 않은 데이터 검색이나 유요하지 않은 입력으로 발생하는 예외 때문에 서킷을 열어선 안되기 때문이다.\n\n\n다음과 같이 사용할 수 있다.\n\nringBufferSizeInClosedState &#x3D; 5, failureRateThreshold &#x3D; 50% : 마지막 5개의 호출 중 3개 이상이 실패하면 서킷이 열린다.\nwaitInterval &#x3D; 10000, automaticTransitionFromOpenToHalfOpenEnabled &#x3D; true : 서킷 브레이커는 10초 동안 서킷을 열린 상태로 유지했다가 반열림 상태로 전환한다.\nringBufferSizeInHalfOpenState &#x3D; 3 : 서킷 브레이커는 서킷 반열림 상태로 전환 후에 처음으로 유입된 3개의 호출을 기준 삼아 서킷의 열림 여부를 결정한다. failureRateThreshold &#x3D; 50%으로 설정돼 있기 때문에 2개 이상 호출이 실패하면 서킷이 다시 열리며, 이 외 경우에는 서킷이 닫힌다.\nignoreExceptions &#x3D; InValidInputException, NotFoundException : 이 두 가지 비즈니스 예외는 서킷 브레이커에서 오류 여기지 않는다.\n\n재시도 메커니즘#재시도 메커니즘은 일시적인 네티워크 결함과 같음 무작위로 드물게 발생하는 오류에 매우 유용하다. 재시도 메커니즘은 설정된 대기 시간을 사이에 두고, 실패한 요청에 여러번 다시 시도하는 것이다. 재시도 메커니즘을 사용하기 위한 주요 요건 중 하나는 재시도 대상 서비스의 멱등성이 있어야 한다는 것이다. 만약 재시도 메커니즘에 의해 2개의 주문이 생성되는 일이 발생하지 않아야 하기 때문이다.\nResilience4j는 서킷 브레이커와 같은 방식으로 재시도 관련된 이벤트 및 메트릭 정보를 공개하지만 상태 정보는 전혀 공개하지 않으며, 재시도 이벤트에 관한 정보는 Actuator 엔드 포인트에서 얻을 수 있다. Resilience4j는 다음과 같은 매개변수를 사용한다.\n\n\n\nProperties\nDescription\n\n\n\nmaxRetryAttempts\n첫번째 호출을 포함한 총 재시도 횟수\n\n\nwaitDuration\n재시도를 다시 수행하기 전의 대기 시간\n\n\nretryExceptions\n재시도를 트러거하는 예외 목록\n\n\n다음과 같이 사용 가능하다.\n\nmaxRetryAttempts &#x3D; 3: 최대 두 번의 재시도를 수행한다.\nwaitDuration &#x3D; 1000: 재시도 사이의 대기 시간은 1초다.\nretryExceptions &#x3D; IntervalServerError:HTTP 요청에 대한 응답으로 500 상태 코드가 오고, 발생한 예외가 IntervalServerError인 경우에만 재시도를 트리거 한다.\n\n테스트 시나리오#\n\nUser API에서 회원 정보 조회 이후 Order API를 통해서 주문 목록 조회\n정상적인 조회의 경우 정상적인 응답, 오류 발생시 Fallback 으로 응답하고 빠른 실패\n\nCode#코드는 대략적인 흐름에 이해를 돕기 위해 첨부합니다.\n1234567891011121314@RestController@RequestMapping(&quot;/api/v1/users&quot;)class UserApi &#123;        ...    @GetMapping(&quot;/&#123;userId&#125;/orders&quot;)    fun getUserWithOrderByTest(        @PathVariable userId: String,        @RequestParam(value = &quot;delay&quot;, defaultValue = &quot;0&quot;) delay: Int = 0,        @RequestParam(value = &quot;faultPercentage&quot;, defaultValue = &quot;0&quot;) faultPercentage: Int = 0    ): UserWithOrderResponse &#123;        return userFindService.findWithOrder(userId, faultPercentage, delay)    &#125;&#125;\n\ndelay: 쓰레드 sleep을 진행할 값, 특정 시간동안 API가 응답하지 않으면 Fallback 처리\nfaultPercentage: 예외가 발생할 퍼센트지, 100이면 100% 예외 발생 하고 Fallback 처리\n\n123456789101112131415161718192021222324252627282930@FeignClient(name = &quot;order-service&quot;)interface OrderClient &#123;    @GetMapping(&quot;/api/v1/orders/users/&#123;userId&#125;&quot;)    fun getOrderByUserId(            @PathVariable userId: String,            @RequestParam(value = &quot;delay&quot;, defaultValue = &quot;0&quot;) delay: Int = 0,            @RequestParam(value = &quot;faultPercentage&quot;, defaultValue = &quot;0&quot;) faultPercentage: Int = 0    ): List&lt;OrderResponse&gt;&#125;class UserFindService &#123;    ...    fun findWithOrder(            userId: String,            faultPercentage: Int,            delay: Int    ): UserWithOrderResponse &#123;        val user = findByUserId(userId)        return UserWithOrderResponse(                user = user,                orders = orderClient.getOrderByUserId(                        userId = userId,                        faultPercentage = faultPercentage,                        delay = delay                )        )    &#125;&#125;\n\nuser를 데이터베이스에서 조회\norder 조회는 FeignClient를 이용해, Order API를 호출\n\n1234567891011121314151617181920212223242526272829303132333435363738394041424344454647// (1)@RestController@RequestMapping(&quot;/api/v1/orders&quot;)class OrderApi &#123;    ..    @GetMapping(&quot;/users/&#123;userId&#125;&quot;)    fun getOrderByTest(            @PathVariable userId: String,            @RequestParam(value = &quot;delay&quot;, defaultValue = &quot;0&quot;) delay: Int = 0,            @RequestParam(value = &quot;faultPercentage&quot;, defaultValue = &quot;0&quot;) faultPercentage: Int = 0    ): List&lt;OrderResponse&gt; &#123;        return orderFindService.findOderByUserId(                userId = userId,                faultPercentage = faultPercentage,                delay = delay        )                .map &#123; OrderResponse(it) &#125;    &#125;&#125;@Service@Transactional(readOnly = true)class OrderFindService(        private val orderRepository: OrderRepository) &#123;    // (2)    @CircuitBreaker(            name = &quot;findOderByUserId&quot;,            fallbackMethod = &quot;findOderByUserIdFallback&quot;    )    fun findOderByUserId(userId: String, faultPercentage: Int, delay: Int): List&lt;Order&gt; &#123;        Thread.sleep(delay.toLong()) // (3)        val random = Random.nextInt(0, 100) // (4)        if (faultPercentage &gt; random) &#123;            throw RuntimeException(&quot;faultPercentage Error...&quot;)        &#125;        return orderRepository.findByUserId(userId)    &#125;    // (5)    private fun findOderByUserIdFallback(ex: Exception): List&lt;Order&gt; &#123;        return emptyList()    &#125;&#125;\n\n(1) 주문 조회를 진행하는 컨트롤러 코드\n(2) CircuitBreaker에 대한 name, fallbackMethod 지정\n(3) 응답 시간 지연을 위한 스레드 대기, 특정 지연 시간 초과하는 경우 fallbackMethod 응답\n(4) faultPercentage에 의해 예외 발생, 예외 발생 시 fallbackMethod 응답\n(5) fallBack 메서드 지정, 위에서 지정한 fallbackMethod와 메서드명이 일치해야 한다.\n\n정상 응답#GET http://localhost:5555/user-service/api/v1/users/997a5a8b-80e4-4a5d-b5d1-14ee22be18da/orders?faultPercentage=0&amp;delay=0\n123456789101112131415&#123;  &quot;orders&quot;: [    &#123;      &quot;productId&quot;: &quot;123a5a8b-20w2-1223d-b5d1-14ssd2dbe18da&quot;,      &quot;userId&quot;: &quot;997a5a8b-80e4-4a5d-b5d1-14ee22be18da&quot;,      &quot;orderId&quot;: &quot;5566da6f-3f03-4ce5-8863-3c142e452522&quot;,      &quot;qty&quot;: 3,      &quot;unitPrice&quot;: 100,      &quot;totalPrice&quot;: 300    &#125;  ],  &quot;email&quot;: &quot;qwe@asd.cm&quot;,  &quot;name&quot;: &quot;Kim&quot;,  &quot;userid&quot;: &quot;997a5a8b-80e4-4a5d-b5d1-14ee22be18da&quot;&#125;\n\nfaultPercentage 0 으로 해당 유저의 주문 조회\n\nFallback 응답#GET http://localhost:5555/user-service/api/v1/users/997a5a8b-80e4-4a5d-b5d1-14ee22be18da/orders?faultPercentage=100&amp;delay=0\n123456&#123;  &quot;orders&quot;: [],  &quot;email&quot;: &quot;qwe@asd.cm&quot;,  &quot;name&quot;: &quot;Kim&quot;,  &quot;userid&quot;: &quot;997a5a8b-80e4-4a5d-b5d1-14ee22be18da&quot;&#125;\n\nfaultPercentage 100 으로 예외 발생하여, Fallback 응답으로 주문 목록 빈 배열로 응답\n\n12345678910111213141516171819202122232425resilience4j:  circuitbreaker:    configs:      default:        registerHealthIndicator: true # actuator 정보 노출을 위한 설정          ringBufferSizeInClosedState: 10 # 닫힌 상태에서의 호출 수로, 서킷을 열어야 할지 결정할 때 사용한다.                                                    ringBufferSizeInHalfOpenState: 30 # 반열림 상태에서의 호출 수로, 서킷을 다시 열거나 닫힘 상태로 돌아갈지를 결정할 때 사용 한다.        failureRateThreshold: 80 # 실패한 호출에 대한 임계값(백분율)으로 이 값을 초과하면 서킷이 열린다.        waitDurationInOpenState: 10s # 열림 상태를 유지하는 시간, 해당 시간이후 반열림 상태로 변경된다.        slidingWindowType: COUNT_BASED    instances:      findOderByUserId:        baseConfig: defaultmanagement:  endpoints:    web:      exposure:        include:          - &quot;*&quot; # 테스트를 위해 actuator 전체 노출  health:    circuitbreakers:      enabled: true # circuitbreakers 정보 노출\n\n설정은 10개의 ringBuffer가 80% 이상 발생하면 10s 동안 서킷을 오픈하고 반오픈 상태로 변경 변경되게 설정했습니다.\n테스트#circuitBreaker에 대한 정보는 actuator를 통해서 Matrix 정보를 편리하게 확인할 수 있습니다.\nCircuitBreaker 리스트 조회#123456789101112GET http://localhost:5555/order-service/actuator/circuitbreakersHTTP/1.1 200 OKContent-Type: application/vnd.spring-boot.actuator.v3+jsonDate: Tue, 16 Nov 2021 16:47:24 GMTcontent-length: 40&#123;  &quot;circuitBreakers&quot;: [    &quot;findOderByUserId&quot;  ]&#125;\nfindOderByUserId의 서킷 브레이커 정보가 정상적으로 출력되는 것을 확인할 수 있습니다.\nCircuitBreaker Health 확인#1234567891011121314151617181920212223242526272829303132GET http://localhost:5555/order-service/actuator/healthHTTP/1.1 200 OKContent-Type: application/vnd.spring-boot.actuator.v3+jsonDate: Tue, 16 Nov 2021 16:45:53 GMTcontent-length: 996&#123;  &quot;status&quot;: &quot;UP&quot;,  &quot;components&quot;: &#123;    &quot;circuitBreakers&quot;: &#123;      &quot;status&quot;: &quot;UP&quot;,      &quot;details&quot;: &#123;        &quot;findOderByUserId&quot;: &#123;          &quot;status&quot;: &quot;UP&quot;,          &quot;details&quot;: &#123;            &quot;failureRate&quot;: &quot;-1.0%&quot;,            &quot;failureRateThreshold&quot;: &quot;80.0%&quot;,            &quot;slowCallRate&quot;: &quot;-1.0%&quot;,            &quot;slowCallRateThreshold&quot;: &quot;100.0%&quot;,            &quot;bufferedCalls&quot;: 0,            &quot;slowCalls&quot;: 0,            &quot;slowFailedCalls&quot;: 0,            &quot;failedCalls&quot;: 0,            &quot;notPermittedCalls&quot;: 0,            &quot;state&quot;: &quot;CLOSED&quot;          &#125;        &#125;      &#125;    &#125;  &#125;&#125;\n위에서 설정한 yml 설정을 기반으로 findOderByUserId 서킷 브레이커가 설정되어 있고 현재 서킷은 CLOSE 상태로 정상적인 호출을 받을 수 있는 상태입니다.\nCircuitBreaker 테스트#정상적인 상태입니다. 이상 태에서 /user-service/api/v1/users/997a5a8b-80e4-4a5d-b5d1-14ee22be18da/orders?faultPercentage=100&amp;delay=0를 2번 호출해 보겠습니다. faultPercentage 100이기 때문에 2번 모두 실패하고 Fallback 메서드가 발생하게 됩니다.\n\nbufferedCalls, failedCalls 각각 증가한 것을 확인할 수 있습니다. bufferedCalls는 호출 수, failedCalls는 실패하여 Fallback 메서드가 내려간 수입니다.\n그러면 /api/v1/users/997a5a8b-80e4-4a5d-b5d1-14ee22be18da/orders?faultPercentage=0&amp;delay=0 faultPercentage 0으로 호출하여 정상적인 응답을 받고 다시 CircuitBreaker Health를 확인해 보겠습니다.\n12345678910111213141516171819202122&#123;  &quot;circuitBreakers&quot;: &#123;    &quot;status&quot;: &quot;UP&quot;,    &quot;details&quot;: &#123;      &quot;findOderByUserId&quot;: &#123;        &quot;status&quot;: &quot;UP&quot;,        &quot;details&quot;: &#123;          &quot;failureRate&quot;: &quot;-1.0%&quot;,          &quot;failureRateThreshold&quot;: &quot;80.0%&quot;,          &quot;slowCallRate&quot;: &quot;-1.0%&quot;,          &quot;slowCallRateThreshold&quot;: &quot;100.0%&quot;,          &quot;bufferedCalls&quot;: 3,          &quot;slowCalls&quot;: 0,          &quot;slowFailedCalls&quot;: 0,          &quot;failedCalls&quot;: 2,          &quot;notPermittedCalls&quot;: 0,          &quot;state&quot;: &quot;CLOSED&quot;        &#125;      &#125;    &#125;  &#125;&#125;\nbufferedCalls만 증가한 것을 확인할 수 있습니다. 그렇다면 계속 실패해서 위에서 설정한 failureRateThreshold 80%를 넘겨 보겠습니다.\n\nfindOderByUserId의 status가 UP -&gt; CIRCUIT_OPEN으로 변경되었고 details의 state가 CLOSED -&gt; OPEN으로 변경되었습니다.\nCIRCUIT_OPEN 상태에서 다시 정상 호출 /api/v1/users/997a5a8b-80e4-4a5d-b5d1-14ee22be18da/orders?faultPercentage=0&amp;delay=0을 해보겠습니다.\n123456&#123;  &quot;orders&quot;: [],  &quot;email&quot;: &quot;qwe@asd.cm&quot;,  &quot;name&quot;: &quot;Kim&quot;,  &quot;userid&quot;: &quot;997a5a8b-80e4-4a5d-b5d1-14ee22be18da&quot;&#125;\nCIRCUIT_OPEN 상태이기 때문에 정상적인 호출도 회로를 차단합니다. waitDurationInOpenState를 10s으로 설정했기 때문에 10s 이후에 다시 호출해 보겠습니다.\n123456789101112131415&#123;  &quot;orders&quot;: [    &#123;      &quot;productId&quot;: &quot;997a5a8b-80e4-4a5d-b5d1-14ee22be18da&quot;,      &quot;userId&quot;: &quot;997a5a8b-80e4-4a5d-b5d1-14ee22be18da&quot;,      &quot;orderId&quot;: &quot;997a5a8b-80e4-4a5d-b5d1-14ee22be18da&quot;,      &quot;qty&quot;: 3,      &quot;unitPrice&quot;: 100,      &quot;totalPrice&quot;: 300    &#125;  ],  &quot;email&quot;: &quot;qwe@asd.cm&quot;,  &quot;name&quot;: &quot;Kim&quot;,  &quot;userid&quot;: &quot;997a5a8b-80e4-4a5d-b5d1-14ee22be18da&quot;&#125;\n정상적으로 order 정보를 출력하는 것을 확인할 수 있습니다. 그러면 서킷의 상태를 확인해 보겠습니다.\n12345678910111213141516171819202122&#123;  &quot;circuitBreakers&quot;: &#123;    &quot;status&quot;: &quot;UNKNOWN&quot;,    &quot;details&quot;: &#123;      &quot;findOderByUserId&quot;: &#123;        &quot;status&quot;: &quot;CIRCUIT_HALF_OPEN&quot;,        &quot;details&quot;: &#123;          &quot;failureRate&quot;: &quot;-1.0%&quot;,          &quot;failureRateThreshold&quot;: &quot;1.0%&quot;,          &quot;slowCallRate&quot;: &quot;-1.0%&quot;,          &quot;slowCallRateThreshold&quot;: &quot;100.0%&quot;,          &quot;bufferedCalls&quot;: 1,          &quot;slowCalls&quot;: 0,          &quot;slowFailedCalls&quot;: 0,          &quot;failedCalls&quot;: 0,          &quot;notPermittedCalls&quot;: 0,          &quot;state&quot;: &quot;HALF_OPEN&quot;        &#125;      &#125;    &#125;  &#125;&#125;\n현재 CIRCUIT_HALF_OPEN 상태입니다. 다시 UP 상태로 변경하기 위해서는 ringBufferSizeInHalfOpenState 설정을 10으로 했기 때문에 정상적인 호출을 해당 조건에 만족시키면 다시 UP으로 변경됩니다.\nCircuitBreaker 이벤트 확인#12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576&#123;  &quot;circuitBreakerEvents&quot;: [    &#123;      &quot;circuitBreakerName&quot;: &quot;findOderByUserId&quot;,      &quot;type&quot;: &quot;SUCCESS&quot;,      &quot;creationTime&quot;: &quot;2021-11-17T02:23:58.708812+09:00[Asia/Seoul]&quot;,      &quot;errorMessage&quot;: null,      &quot;durationInMs&quot;: 1,      &quot;stateTransition&quot;: null    &#125;,    &#123;      &quot;circuitBreakerName&quot;: &quot;findOderByUserId&quot;,      &quot;type&quot;: &quot;ERROR&quot;,      &quot;creationTime&quot;: &quot;2021-11-17T02:24:14.581976+09:00[Asia/Seoul]&quot;,      &quot;errorMessage&quot;: &quot;java.lang.RuntimeException: faultPercentage Error...&quot;,      &quot;durationInMs&quot;: 0,      &quot;stateTransition&quot;: null    &#125;,    &#123;      &quot;circuitBreakerName&quot;: &quot;findOderByUserId&quot;,      &quot;type&quot;: &quot;ERROR&quot;,      &quot;creationTime&quot;: &quot;2021-11-17T02:24:19.442926+09:00[Asia/Seoul]&quot;,      &quot;errorMessage&quot;: &quot;java.lang.RuntimeException: faultPercentage Error...&quot;,      &quot;durationInMs&quot;: 0,      &quot;stateTransition&quot;: null    &#125;,    &#123;      &quot;circuitBreakerName&quot;: &quot;findOderByUserId&quot;,      &quot;type&quot;: &quot;FAILURE_RATE_EXCEEDED&quot;,      &quot;creationTime&quot;: &quot;2021-11-17T02:24:19.937314+09:00[Asia/Seoul]&quot;,      &quot;errorMessage&quot;: null,      &quot;durationInMs&quot;: null,      &quot;stateTransition&quot;: null    &#125;,    &#123;      &quot;circuitBreakerName&quot;: &quot;findOderByUserId&quot;,      &quot;type&quot;: &quot;STATE_TRANSITION&quot;,      &quot;creationTime&quot;: &quot;2021-11-17T02:24:19.937352+09:00[Asia/Seoul]&quot;,      &quot;errorMessage&quot;: null,      &quot;durationInMs&quot;: null,      &quot;stateTransition&quot;: &quot;CLOSED_TO_OPEN&quot;    &#125;,    &#123;      &quot;circuitBreakerName&quot;: &quot;findOderByUserId&quot;,      &quot;type&quot;: &quot;NOT_PERMITTED&quot;,      &quot;creationTime&quot;: &quot;2021-11-17T02:24:20.103096+09:00[Asia/Seoul]&quot;,      &quot;errorMessage&quot;: null,      &quot;durationInMs&quot;: null,      &quot;stateTransition&quot;: null    &#125;,    &#123;      &quot;circuitBreakerName&quot;: &quot;findOderByUserId&quot;,      &quot;type&quot;: &quot;NOT_PERMITTED&quot;,      &quot;creationTime&quot;: &quot;2021-11-17T02:24:20.273400+09:00[Asia/Seoul]&quot;,      &quot;errorMessage&quot;: null,      &quot;durationInMs&quot;: null,      &quot;stateTransition&quot;: null    &#125;,    &#123;      &quot;circuitBreakerName&quot;: &quot;findOderByUserId&quot;,      &quot;type&quot;: &quot;NOT_PERMITTED&quot;,      &quot;creationTime&quot;: &quot;2021-11-17T02:24:20.610345+09:00[Asia/Seoul]&quot;,      &quot;errorMessage&quot;: null,      &quot;durationInMs&quot;: null,      &quot;stateTransition&quot;: null    &#125;,    &#123;      &quot;circuitBreakerName&quot;: &quot;findOderByUserId&quot;,      &quot;type&quot;: &quot;STATE_TRANSITION&quot;,      &quot;creationTime&quot;: &quot;2021-11-17T02:24:30.240276+09:00[Asia/Seoul]&quot;,      &quot;errorMessage&quot;: null,      &quot;durationInMs&quot;: null,      &quot;stateTransition&quot;: &quot;OPEN_TO_HALF_OPEN&quot;    &#125;  ]&#125;\n\nhttp://localhost:5555/order-service/actuator/circuitbreakerevents API를 이용해서 CircuitBreaker 이벤트 내역을 확인할 수 있습니다.\n참고#\n스프링으로 하는 마이크로서비스 구축\nSpring Boot에 Resilience4j (CircuitBreaker) 적용하기\nResilience4j Document\n\n","dateCreated":"2021-11-18T00:00:00+09:00","dateModified":"2025-02-02T16:23:31+09:00","datePublished":"2021-11-18T00:00:00+09:00","description":"마이크로 서비스 사이의 통신이 이루어지는 대규모 시스템 환경에서 느리거나 응답하지 않은 다운스트림 서비스가 발생했을 때 그 피해를 최소화시키는 것이 서킷 브레이커의 가장 큰 핵심이라고 할 수 있습니다.","headline":"Resilience4j를 이용한 서킷 브레이커 기초","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://cheese10yun.github.io/resilience4j-basic/"},"publisher":{"@type":"Organization","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg","logo":{"@type":"ImageObject","url":"yun-icon.jpg"}},"url":"https://cheese10yun.github.io/resilience4j-basic/","keywords":"MSA"}</script>
    <meta name="description" content="마이크로 서비스 사이의 통신이 이루어지는 대규모 시스템 환경에서 느리거나 응답하지 않은 다운스트림 서비스가 발생했을 때 그 피해를 최소화시키는 것이 서킷 브레이커의 가장 큰 핵심이라고 할 수 있습니다.">
<meta property="og:type" content="blog">
<meta property="og:title" content="Resilience4j를 이용한 서킷 브레이커 기초">
<meta property="og:url" content="https://cheese10yun.github.io/resilience4j-basic/index.html">
<meta property="og:site_name" content="Yun Blog">
<meta property="og:description" content="마이크로 서비스 사이의 통신이 이루어지는 대규모 시스템 환경에서 느리거나 응답하지 않은 다운스트림 서비스가 발생했을 때 그 피해를 최소화시키는 것이 서킷 브레이커의 가장 큰 핵심이라고 할 수 있습니다.">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://github.com/cheese10yun/blog-sample/raw/master/spring-msa/docs/images/Resilience4j-1.png">
<meta property="og:image" content="https://github.com/cheese10yun/blog-sample/raw/master/spring-msa/docs/images/flow-22.png">
<meta property="og:image" content="https://github.com/cheese10yun/blog-sample/raw/master/spring-msa/docs/images/circuit-diff.png">
<meta property="og:image" content="https://github.com/cheese10yun/blog-sample/raw/master/spring-msa/docs/images/circuit-diff2.png">
<meta property="article:published_time" content="2021-11-17T15:00:00.000Z">
<meta property="article:modified_time" content="2025-02-02T07:23:31.102Z">
<meta property="article:author" content="Yun">
<meta property="article:tag" content="MSA">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/cheese10yun/blog-sample/raw/master/spring-msa/docs/images/Resilience4j-1.png">
    
    
        
    
    
        <meta property="og:image" content="https://cheese10yun.github.io/assets/images/yun-icon.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90907312-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90907312-1');
    </script>


    

    
        
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5813739623204880" crossorigin="anonymous"></script>
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Yun Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="링크 열기: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="저자에 대해 더 알아보기"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
                </a>
                <h4 class="sidebar-profile-name">Yun</h4>
                
                    <h5 class="sidebar-profile-bio"><p>기술 블로그</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="태그"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">태그</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="아카이브"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">아카이브</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/cheese10yun"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/rss2.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Resilience4j를 이용한 서킷 브레이커 기초
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2021-11-18T00:00:00+09:00">
	
		    2021/11/18
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <blockquote>
<p>Resilience4j 이론적인 설명은 <a target="_blank" rel="noopener" href="http://www.yes24.com/Product/Goods/95593443">스프링으로 하는 마이크로 서비스 구축</a>을 참조했습니다.</p>
</blockquote>
<p>마이크로 서비스 사이의 통신이 이루어지는 대규모 시스템 환경에서 느리거나 응답하지 않은 다운스트림 서비스가 발생했을 때 그 피해를 최소화시키는 것이 서킷 브레이커의 가장 큰 핵심이라고 할 수 있습니다.</p>
<p>대표적으로 마이크로 서비스의 응답이 늦거나 전혀 응답하지 않는 경우, 일시적인 네트워크 문제 등으로 요청이 무작위로 실패하는 경우 등이 이에 해당합니다.</p>
<h2><span id="resilience4j-sogae">Resilience4j 소개</span><a href="#resilience4j-sogae" class="header-anchor">#</a></h2><p><img src="https://github.com/cheese10yun/blog-sample/raw/master/spring-msa/docs/images/Resilience4j-1.png"></p>
<ul>
<li>서킷 브레이커는 다량의 오류를 감지하면 서킷을 열어 새 호출을 받지 않는다.</li>
<li>서킷 브레이커는 서킷이 열려 있을 때 빠른 실패 로직을 수행한다. 즉 이어지는 호출에서 시간 초과, 예외 발생 등 오류가 발생하지 않게, 폴백 메서드 호출을 리다디렉션을 한다. 폴백 메서드에서 다양한 비즈니스 로직을 적용하면 로컬 캐시의 데이터를 반환하거나 즉각적인 오류 메시지를 반환하는 등 최적화된 응답을 생성할 수 있다. 이로써 의존하는 서비스의 응답 중단 때문에 마이크로 서비스가 응답하지 못하게 되는 문제를 방지할 수 있는다.</li>
<li>시간이 지나면 서킷 브레이커는 반열림 상태로 전환돼 새로운 호출을 허용하며, 이를 통해 문제를 일으킨 원인이 사라졌는지 확인한다. 서킷 브레이커는 새로운 오류를 감지하면서 서킷을 다시 열고 빠른 실패 로직을 다시 수행하며, 오류가 사라졌으면 서킷을 닫고 정상 작동 상태로 돌아간다.</li>
</ul>
<p>Resilience4j는 런타임에 다양한 방법으로 서킷 브레이커의 정보를 공개한다.</p>
<ul>
<li>서킷 브레이커의 현재 상태를 마이크로 서비스 액추에이터 상태 점검 엔드 포인트(&#x2F;actuator&#x2F;health)를 사용해 모니터링할 수 있다.</li>
<li>서킷 브레이커는 상태 전이 등의 이벤트 액추에이터 엔드 포인트(&#x2F;actuator&#x2F;citcuitbreakerevents)를 게시한다.</li>
<li>서킷 브레이커 스프링 부트의 매트릭스 시스템과 통합돼 있으며 이를 이용해 프로테우스와 같은 모니터링 도구에 메트릭을 게시할 수 있다.</li>
</ul>
<h2><span id="circuitbreaker-config-seoljeong">CircuitBreaker Config 설정</span><a href="#circuitbreaker-config-seoljeong" class="header-anchor">#</a></h2><table>
<thead>
<tr>
<th>Properties</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>ringBufferSizeInClosedState</td>
<td>닫힌 상태에서의 호출 수로, 서킷을 열어 할지 결정할 때 사용한다.</td>
</tr>
<tr>
<td>failureRateThreshold</td>
<td>실패한 호출에 대한 임계값(백분율)으로 이 값을 초과하면 서킷이 열린다.</td>
</tr>
<tr>
<td>waitInterval</td>
<td>반열림 상태로 전환하기 전에 시킷을 열린 상태로 유지하는 시간</td>
</tr>
<tr>
<td>ringBufferSizeInHalfOpenState</td>
<td>반열림 상태에서의 호출 수로, 서킷을 다시 열거나 닫힘 상태로 돌아갈지를 결정할 때 사용 한다.</td>
</tr>
<tr>
<td>automaticTransitionFromOpenToHalfOpenEnabled</td>
<td>대기 시간이 지난 후에 서킷을 반열림 상태로 자동 전환할지, 첫 번째 호출이 들어오길 기다렸다가 반열림 상태로 전환할지를 결정한다.</td>
</tr>
<tr>
<td>ignoreExceptions</td>
<td>오류를 간주하지 않을 예외를 지정한다. 보통 InvaildInputException, NotfoundExceotion과 같이 예상할 수 있는 비즈니스 예외는 서킷 브레이커에서 무시하는데, 존재하지 않은 데이터 검색이나 유요하지 않은 입력으로 발생하는 예외 때문에 서킷을 열어선 안되기 때문이다.</td>
</tr>
</tbody></table>
<p>다음과 같이 사용할 수 있다.</p>
<ul>
<li>ringBufferSizeInClosedState &#x3D; 5, failureRateThreshold &#x3D; 50% : 마지막 5개의 호출 중 3개 이상이 실패하면 서킷이 열린다.</li>
<li>waitInterval &#x3D; 10000, automaticTransitionFromOpenToHalfOpenEnabled &#x3D; true : 서킷 브레이커는 10초 동안 서킷을 열린 상태로 유지했다가 반열림 상태로 전환한다.</li>
<li>ringBufferSizeInHalfOpenState &#x3D; 3 : 서킷 브레이커는 서킷 반열림 상태로 전환 후에 처음으로 유입된 3개의 호출을 기준 삼아 서킷의 열림 여부를 결정한다. failureRateThreshold &#x3D; 50%으로 설정돼 있기 때문에 2개 이상 호출이 실패하면 서킷이 다시 열리며, 이 외 경우에는 서킷이 닫힌다.</li>
<li>ignoreExceptions &#x3D; InValidInputException, NotFoundException : 이 두 가지 비즈니스 예외는 서킷 브레이커에서 오류 여기지 않는다.</li>
</ul>
<h2><span id="jaesido-mekeonijeum">재시도 메커니즘</span><a href="#jaesido-mekeonijeum" class="header-anchor">#</a></h2><p>재시도 메커니즘은 일시적인 네티워크 결함과 같음 무작위로 드물게 발생하는 오류에 매우 유용하다. 재시도 메커니즘은 설정된 대기 시간을 사이에 두고, 실패한 요청에 여러번 다시 시도하는 것이다. 재시도 메커니즘을 사용하기 위한 주요 요건 중 하나는 재시도 대상 서비스의 <strong>멱등성</strong>이 있어야 한다는 것이다. 만약 재시도 메커니즘에 의해 2개의 주문이 생성되는 일이 발생하지 않아야 하기 때문이다.</p>
<p>Resilience4j는 서킷 브레이커와 같은 방식으로 재시도 관련된 이벤트 및 메트릭 정보를 공개하지만 상태 정보는 전혀 공개하지 않으며, 재시도 이벤트에 관한 정보는 Actuator 엔드 포인트에서 얻을 수 있다. Resilience4j는 다음과 같은 매개변수를 사용한다.</p>
<table>
<thead>
<tr>
<th>Properties</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>maxRetryAttempts</td>
<td>첫번째 호출을 포함한 총 재시도 횟수</td>
</tr>
<tr>
<td>waitDuration</td>
<td>재시도를 다시 수행하기 전의 대기 시간</td>
</tr>
<tr>
<td>retryExceptions</td>
<td>재시도를 트러거하는 예외 목록</td>
</tr>
</tbody></table>
<p>다음과 같이 사용 가능하다.</p>
<ul>
<li>maxRetryAttempts &#x3D; 3: 최대 두 번의 재시도를 수행한다.</li>
<li>waitDuration &#x3D; 1000: 재시도 사이의 대기 시간은 1초다.</li>
<li>retryExceptions &#x3D; IntervalServerError:HTTP 요청에 대한 응답으로 500 상태 코드가 오고, 발생한 예외가 IntervalServerError인 경우에만 재시도를 트리거 한다.</li>
</ul>
<h2><span id="teseuteu-sinario">테스트 시나리오</span><a href="#teseuteu-sinario" class="header-anchor">#</a></h2><p><img src="https://github.com/cheese10yun/blog-sample/raw/master/spring-msa/docs/images/flow-22.png"></p>
<ul>
<li>User API에서 회원 정보 조회 이후 Order API를 통해서 주문 목록 조회</li>
<li>정상적인 조회의 경우 정상적인 응답, 오류 발생시 <strong>Fallback 으로 응답하고 빠른 실패</strong></li>
</ul>
<h3><span id="code">Code</span><a href="#code" class="header-anchor">#</a></h3><p>코드는 대략적인 흐름에 이해를 돕기 위해 첨부합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(<span class="string">&quot;/api/v1/users&quot;</span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserApi</span> &#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    <span class="meta">@GetMapping(<span class="string">&quot;/&#123;userId&#125;/orders&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getUserWithOrderByTest</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="meta">@PathVariable</span> userId: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="meta">@RequestParam(value = <span class="string">&quot;delay&quot;</span>, defaultValue = <span class="string">&quot;0&quot;</span>)</span> delay: <span class="type">Int</span> = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="meta">@RequestParam(value = <span class="string">&quot;faultPercentage&quot;</span>, defaultValue = <span class="string">&quot;0&quot;</span>)</span> faultPercentage: <span class="type">Int</span> = <span class="number">0</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: UserWithOrderResponse &#123;</span><br><span class="line">        <span class="keyword">return</span> userFindService.findWithOrder(userId, faultPercentage, delay)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>delay: 쓰레드 sleep을 진행할 값, 특정 시간동안 API가 응답하지 않으면 Fallback 처리</li>
<li>faultPercentage: 예외가 발생할 퍼센트지, 100이면 100% 예외 발생 하고 Fallback 처리</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(name = <span class="string">&quot;order-service&quot;</span>)</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">OrderClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(<span class="string">&quot;/api/v1/orders/users/&#123;userId&#125;&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getOrderByUserId</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="meta">@PathVariable</span> userId: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="meta">@RequestParam(value = <span class="string">&quot;delay&quot;</span>, defaultValue = <span class="string">&quot;0&quot;</span>)</span> delay: <span class="type">Int</span> = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="meta">@RequestParam(value = <span class="string">&quot;faultPercentage&quot;</span>, defaultValue = <span class="string">&quot;0&quot;</span>)</span> faultPercentage: <span class="type">Int</span> = <span class="number">0</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: List&lt;OrderResponse&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserFindService</span> &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">findWithOrder</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            userId: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">            faultPercentage: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">            delay: <span class="type">Int</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: UserWithOrderResponse &#123;</span><br><span class="line">        <span class="keyword">val</span> user = findByUserId(userId)</span><br><span class="line">        <span class="keyword">return</span> UserWithOrderResponse(</span><br><span class="line">                user = user,</span><br><span class="line">                orders = orderClient.getOrderByUserId(</span><br><span class="line">                        userId = userId,</span><br><span class="line">                        faultPercentage = faultPercentage,</span><br><span class="line">                        delay = delay</span><br><span class="line">                )</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>user를 데이터베이스에서 조회</li>
<li>order 조회는 FeignClient를 이용해, Order API를 호출</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// (1)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(<span class="string">&quot;/api/v1/orders&quot;</span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderApi</span> &#123;</span><br><span class="line">    ..</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(<span class="string">&quot;/users/&#123;userId&#125;&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getOrderByTest</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="meta">@PathVariable</span> userId: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="meta">@RequestParam(value = <span class="string">&quot;delay&quot;</span>, defaultValue = <span class="string">&quot;0&quot;</span>)</span> delay: <span class="type">Int</span> = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="meta">@RequestParam(value = <span class="string">&quot;faultPercentage&quot;</span>, defaultValue = <span class="string">&quot;0&quot;</span>)</span> faultPercentage: <span class="type">Int</span> = <span class="number">0</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: List&lt;OrderResponse&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> orderFindService.findOderByUserId(</span><br><span class="line">                userId = userId,</span><br><span class="line">                faultPercentage = faultPercentage,</span><br><span class="line">                delay = delay</span><br><span class="line">        )</span><br><span class="line">                .map &#123; OrderResponse(it) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderFindService</span>(</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">val</span> orderRepository: OrderRepository</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// (2)</span></span><br><span class="line">    <span class="meta">@CircuitBreaker(</span></span><br><span class="line"><span class="meta">            name = <span class="string">&quot;findOderByUserId&quot;</span>,</span></span><br><span class="line"><span class="meta">            fallbackMethod = <span class="string">&quot;findOderByUserIdFallback&quot;</span></span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">findOderByUserId</span><span class="params">(userId: <span class="type">String</span>, faultPercentage: <span class="type">Int</span>, delay: <span class="type">Int</span>)</span></span>: List&lt;Order&gt; &#123;</span><br><span class="line">        Thread.sleep(delay.toLong()) <span class="comment">// (3)</span></span><br><span class="line">        <span class="keyword">val</span> random = Random.nextInt(<span class="number">0</span>, <span class="number">100</span>) <span class="comment">// (4)</span></span><br><span class="line">        <span class="keyword">if</span> (faultPercentage &gt; random) &#123;</span><br><span class="line">            <span class="keyword">throw</span> RuntimeException(<span class="string">&quot;faultPercentage Error...&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> orderRepository.findByUserId(userId)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// (5)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">findOderByUserIdFallback</span><span class="params">(ex: <span class="type">Exception</span>)</span></span>: List&lt;Order&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> emptyList()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>(1) 주문 조회를 진행하는 컨트롤러 코드</li>
<li>(2) CircuitBreaker에 대한 name, fallbackMethod 지정</li>
<li>(3) 응답 시간 지연을 위한 스레드 대기, 특정 지연 시간 초과하는 경우 fallbackMethod 응답</li>
<li>(4) faultPercentage에 의해 예외 발생, 예외 발생 시 fallbackMethod 응답</li>
<li>(5) fallBack 메서드 지정, 위에서 지정한 fallbackMethod와 메서드명이 일치해야 한다.</li>
</ul>
<h3><span id="jeongsang-eungdab">정상 응답</span><a href="#jeongsang-eungdab" class="header-anchor">#</a></h3><p>GET <a target="_blank" rel="noopener" href="http://localhost:5555/user-service/api/v1/users/997a5a8b-80e4-4a5d-b5d1-14ee22be18da/orders?faultPercentage=0&delay=0">http://localhost:5555/user-service/api/v1/users/997a5a8b-80e4-4a5d-b5d1-14ee22be18da/orders?faultPercentage=0&amp;delay=0</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;orders&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;productId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123a5a8b-20w2-1223d-b5d1-14ssd2dbe18da&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;997a5a8b-80e4-4a5d-b5d1-14ee22be18da&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;orderId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5566da6f-3f03-4ce5-8863-3c142e452522&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;qty&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;unitPrice&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;totalPrice&quot;</span><span class="punctuation">:</span> <span class="number">300</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qwe@asd.cm&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Kim&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;997a5a8b-80e4-4a5d-b5d1-14ee22be18da&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>faultPercentage 0 으로 해당 유저의 주문 조회</li>
</ul>
<h3><span id="fallback-eungdab">Fallback 응답</span><a href="#fallback-eungdab" class="header-anchor">#</a></h3><p>GET <a target="_blank" rel="noopener" href="http://localhost:5555/user-service/api/v1/users/997a5a8b-80e4-4a5d-b5d1-14ee22be18da/orders?faultPercentage=100&delay=0">http://localhost:5555/user-service/api/v1/users/997a5a8b-80e4-4a5d-b5d1-14ee22be18da/orders?faultPercentage=100&amp;delay=0</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;orders&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qwe@asd.cm&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Kim&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;997a5a8b-80e4-4a5d-b5d1-14ee22be18da&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>faultPercentage 100 으로 예외 발생하여, Fallback 응답으로 주문 목록 빈 배열로 응답</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">resilience4j:</span></span><br><span class="line">  <span class="attr">circuitbreaker:</span></span><br><span class="line">    <span class="attr">configs:</span></span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="attr">registerHealthIndicator:</span> <span class="literal">true</span> <span class="comment"># actuator 정보 노출을 위한 설정  </span></span><br><span class="line">        <span class="attr">ringBufferSizeInClosedState:</span> <span class="number">10</span> <span class="comment"># 닫힌 상태에서의 호출 수로, 서킷을 열어야 할지 결정할 때 사용한다.                                            </span></span><br><span class="line">        <span class="attr">ringBufferSizeInHalfOpenState:</span> <span class="number">30</span> <span class="comment"># 반열림 상태에서의 호출 수로, 서킷을 다시 열거나 닫힘 상태로 돌아갈지를 결정할 때 사용 한다.</span></span><br><span class="line">        <span class="attr">failureRateThreshold:</span> <span class="number">80</span> <span class="comment"># 실패한 호출에 대한 임계값(백분율)으로 이 값을 초과하면 서킷이 열린다.</span></span><br><span class="line">        <span class="attr">waitDurationInOpenState:</span> <span class="string">10s</span> <span class="comment"># 열림 상태를 유지하는 시간, 해당 시간이후 반열림 상태로 변경된다.</span></span><br><span class="line">        <span class="attr">slidingWindowType:</span> <span class="string">COUNT_BASED</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">instances:</span></span><br><span class="line">      <span class="attr">findOderByUserId:</span></span><br><span class="line">        <span class="attr">baseConfig:</span> <span class="string">default</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;*&quot;</span> <span class="comment"># 테스트를 위해 actuator 전체 노출</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">health:</span></span><br><span class="line">    <span class="attr">circuitbreakers:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># circuitbreakers 정보 노출</span></span><br></pre></td></tr></table></figure>

<p>설정은 10개의 ringBuffer가 80% 이상 발생하면 10s 동안 서킷을 오픈하고 반오픈 상태로 변경 변경되게 설정했습니다.</p>
<h2><span id="teseuteu">테스트</span><a href="#teseuteu" class="header-anchor">#</a></h2><p>circuitBreaker에 대한 정보는 actuator를 통해서 Matrix 정보를 편리하게 확인할 수 있습니다.</p>
<h3><span id="circuitbreaker-riseuteu-johoe">CircuitBreaker 리스트 조회</span><a href="#circuitbreaker-riseuteu-johoe" class="header-anchor">#</a></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET http://localhost:5555/order-service/actuator/circuitbreakers</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/vnd.spring-boot.actuator.v3+json</span><br><span class="line">Date: Tue, 16 Nov 2021 16:47:24 GMT</span><br><span class="line">content-length: 40</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;circuitBreakers&quot;: [</span><br><span class="line">    &quot;findOderByUserId&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>findOderByUserId의 서킷 브레이커 정보가 정상적으로 출력되는 것을 확인할 수 있습니다.</p>
<h3><span id="circuitbreaker-health-hwagin">CircuitBreaker Health 확인</span><a href="#circuitbreaker-health-hwagin" class="header-anchor">#</a></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">GET http://localhost:5555/order-service/actuator/health</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/vnd.spring-boot.actuator.v3+json</span><br><span class="line">Date: Tue, 16 Nov 2021 16:45:53 GMT</span><br><span class="line">content-length: 996</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;UP&quot;,</span><br><span class="line">  &quot;components&quot;: &#123;</span><br><span class="line">    &quot;circuitBreakers&quot;: &#123;</span><br><span class="line">      &quot;status&quot;: &quot;UP&quot;,</span><br><span class="line">      &quot;details&quot;: &#123;</span><br><span class="line">        &quot;findOderByUserId&quot;: &#123;</span><br><span class="line">          &quot;status&quot;: &quot;UP&quot;,</span><br><span class="line">          &quot;details&quot;: &#123;</span><br><span class="line">            &quot;failureRate&quot;: &quot;-1.0%&quot;,</span><br><span class="line">            &quot;failureRateThreshold&quot;: &quot;80.0%&quot;,</span><br><span class="line">            &quot;slowCallRate&quot;: &quot;-1.0%&quot;,</span><br><span class="line">            &quot;slowCallRateThreshold&quot;: &quot;100.0%&quot;,</span><br><span class="line">            &quot;bufferedCalls&quot;: 0,</span><br><span class="line">            &quot;slowCalls&quot;: 0,</span><br><span class="line">            &quot;slowFailedCalls&quot;: 0,</span><br><span class="line">            &quot;failedCalls&quot;: 0,</span><br><span class="line">            &quot;notPermittedCalls&quot;: 0,</span><br><span class="line">            &quot;state&quot;: &quot;CLOSED&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위에서 설정한 yml 설정을 기반으로 findOderByUserId 서킷 브레이커가 설정되어 있고 현재 서킷은 CLOSE 상태로 정상적인 호출을 받을 수 있는 상태입니다.</p>
<h3><span id="circuitbreaker-teseuteu">CircuitBreaker 테스트</span><a href="#circuitbreaker-teseuteu" class="header-anchor">#</a></h3><p>정상적인 상태입니다. 이상 태에서 <code>/user-service/api/v1/users/997a5a8b-80e4-4a5d-b5d1-14ee22be18da/orders?faultPercentage=100&amp;delay=0</code>를 2번 호출해 보겠습니다. faultPercentage 100이기 때문에 2번 모두 실패하고 Fallback 메서드가 발생하게 됩니다.</p>
<p><img src="https://github.com/cheese10yun/blog-sample/raw/master/spring-msa/docs/images/circuit-diff.png"></p>
<p>bufferedCalls, failedCalls 각각 증가한 것을 확인할 수 있습니다. bufferedCalls는 호출 수, failedCalls는 실패하여 Fallback 메서드가 내려간 수입니다.</p>
<p>그러면 <code>/api/v1/users/997a5a8b-80e4-4a5d-b5d1-14ee22be18da/orders?faultPercentage=0&amp;delay=0</code> faultPercentage 0으로 호출하여 정상적인 응답을 받고 다시 CircuitBreaker Health를 확인해 보겠습니다.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;circuitBreakers&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UP&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;details&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;findOderByUserId&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UP&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;details&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;failureRate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-1.0%&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;failureRateThreshold&quot;</span><span class="punctuation">:</span> <span class="string">&quot;80.0%&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;slowCallRate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-1.0%&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;slowCallRateThreshold&quot;</span><span class="punctuation">:</span> <span class="string">&quot;100.0%&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;bufferedCalls&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;slowCalls&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;slowFailedCalls&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;failedCalls&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;notPermittedCalls&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CLOSED&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>bufferedCalls만 증가한 것을 확인할 수 있습니다. 그렇다면 계속 실패해서 위에서 설정한 failureRateThreshold 80%를 넘겨 보겠습니다.</p>
<p><img src="https://github.com/cheese10yun/blog-sample/raw/master/spring-msa/docs/images/circuit-diff2.png"></p>
<p>findOderByUserId의 status가 UP -&gt; CIRCUIT_OPEN으로 변경되었고 details의 state가 CLOSED -&gt; OPEN으로 변경되었습니다.</p>
<p>CIRCUIT_OPEN 상태에서 다시 정상 호출 <code>/api/v1/users/997a5a8b-80e4-4a5d-b5d1-14ee22be18da/orders?faultPercentage=0&amp;delay=0</code>을 해보겠습니다.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;orders&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qwe@asd.cm&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Kim&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;997a5a8b-80e4-4a5d-b5d1-14ee22be18da&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>CIRCUIT_OPEN 상태이기 때문에 정상적인 호출도 회로를 차단합니다. waitDurationInOpenState를 10s으로 설정했기 때문에 10s 이후에 다시 호출해 보겠습니다.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;orders&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;productId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;997a5a8b-80e4-4a5d-b5d1-14ee22be18da&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;997a5a8b-80e4-4a5d-b5d1-14ee22be18da&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;orderId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;997a5a8b-80e4-4a5d-b5d1-14ee22be18da&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;qty&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;unitPrice&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;totalPrice&quot;</span><span class="punctuation">:</span> <span class="number">300</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qwe@asd.cm&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Kim&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;997a5a8b-80e4-4a5d-b5d1-14ee22be18da&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>정상적으로 order 정보를 출력하는 것을 확인할 수 있습니다. 그러면 서킷의 상태를 확인해 보겠습니다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;circuitBreakers&quot;: &#123;</span><br><span class="line">    &quot;status&quot;: &quot;UNKNOWN&quot;,</span><br><span class="line">    &quot;details&quot;: &#123;</span><br><span class="line">      &quot;findOderByUserId&quot;: &#123;</span><br><span class="line">        &quot;status&quot;: &quot;CIRCUIT_HALF_OPEN&quot;,</span><br><span class="line">        &quot;details&quot;: &#123;</span><br><span class="line">          &quot;failureRate&quot;: &quot;-1.0%&quot;,</span><br><span class="line">          &quot;failureRateThreshold&quot;: &quot;1.0%&quot;,</span><br><span class="line">          &quot;slowCallRate&quot;: &quot;-1.0%&quot;,</span><br><span class="line">          &quot;slowCallRateThreshold&quot;: &quot;100.0%&quot;,</span><br><span class="line">          &quot;bufferedCalls&quot;: 1,</span><br><span class="line">          &quot;slowCalls&quot;: 0,</span><br><span class="line">          &quot;slowFailedCalls&quot;: 0,</span><br><span class="line">          &quot;failedCalls&quot;: 0,</span><br><span class="line">          &quot;notPermittedCalls&quot;: 0,</span><br><span class="line">          &quot;state&quot;: &quot;HALF_OPEN&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>현재 CIRCUIT_HALF_OPEN 상태입니다. 다시 UP 상태로 변경하기 위해서는 ringBufferSizeInHalfOpenState 설정을 10으로 했기 때문에 정상적인 호출을 해당 조건에 만족시키면 다시 UP으로 변경됩니다.</p>
<h3><span id="circuitbreaker-ibenteu-hwagin">CircuitBreaker 이벤트 확인</span><a href="#circuitbreaker-ibenteu-hwagin" class="header-anchor">#</a></h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;circuitBreakerEvents&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;circuitBreakerName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;findOderByUserId&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SUCCESS&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;creationTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-11-17T02:23:58.708812+09:00[Asia/Seoul]&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;errorMessage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;durationInMs&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;stateTransition&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;circuitBreakerName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;findOderByUserId&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ERROR&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;creationTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-11-17T02:24:14.581976+09:00[Asia/Seoul]&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;errorMessage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java.lang.RuntimeException: faultPercentage Error...&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;durationInMs&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;stateTransition&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;circuitBreakerName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;findOderByUserId&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ERROR&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;creationTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-11-17T02:24:19.442926+09:00[Asia/Seoul]&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;errorMessage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java.lang.RuntimeException: faultPercentage Error...&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;durationInMs&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;stateTransition&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;circuitBreakerName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;findOderByUserId&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;FAILURE_RATE_EXCEEDED&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;creationTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-11-17T02:24:19.937314+09:00[Asia/Seoul]&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;errorMessage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;durationInMs&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;stateTransition&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;circuitBreakerName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;findOderByUserId&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;STATE_TRANSITION&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;creationTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-11-17T02:24:19.937352+09:00[Asia/Seoul]&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;errorMessage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;durationInMs&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;stateTransition&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CLOSED_TO_OPEN&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;circuitBreakerName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;findOderByUserId&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;NOT_PERMITTED&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;creationTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-11-17T02:24:20.103096+09:00[Asia/Seoul]&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;errorMessage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;durationInMs&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;stateTransition&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;circuitBreakerName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;findOderByUserId&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;NOT_PERMITTED&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;creationTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-11-17T02:24:20.273400+09:00[Asia/Seoul]&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;errorMessage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;durationInMs&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;stateTransition&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;circuitBreakerName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;findOderByUserId&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;NOT_PERMITTED&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;creationTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-11-17T02:24:20.610345+09:00[Asia/Seoul]&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;errorMessage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;durationInMs&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;stateTransition&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;circuitBreakerName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;findOderByUserId&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;STATE_TRANSITION&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;creationTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-11-17T02:24:30.240276+09:00[Asia/Seoul]&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;errorMessage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;durationInMs&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;stateTransition&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OPEN_TO_HALF_OPEN&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://localhost:5555/order-service/actuator/circuitbreakerevents">http://localhost:5555/order-service/actuator/circuitbreakerevents</a> API를 이용해서 CircuitBreaker 이벤트 내역을 확인할 수 있습니다.</p>
<h2><span id="camgo">참고</span><a href="#camgo" class="header-anchor">#</a></h2><ul>
<li><a target="_blank" rel="noopener" href="http://www.yes24.com/Product/Goods/95593443">스프링으로 하는 마이크로서비스 구축</a></li>
<li><a target="_blank" rel="noopener" href="https://leejongchan.tistory.com/100">Spring Boot에 Resilience4j (CircuitBreaker) 적용하기</a></li>
<li><a target="_blank" rel="noopener" href="https://resilience4j.readme.io/docs/getting-started">Resilience4j Document</a></li>
</ul>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">태그</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/MSA/" rel="tag">MSA</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/intellij-string-manipulation/"
                    data-tooltip="인텔리제이 플러그인 String Manipulation"
                    aria-label="이전: 인텔리제이 플러그인 String Manipulation"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/sql-test/"
                    data-tooltip="Sql을 통해서 테스트 코드를 쉽게 작성하자"
                    aria-label="다음: Sql을 통해서 테스트 코드를 쉽게 작성하자"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/resilience4j-basic/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/resilience4j-basic/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        

                
                    <!--  utteranc comment -->

<script src="https://utteranc.es/client.js"
        repo="cheese10yun/blog-comment"
        issue-term="title"
        label="Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                

            
        
    </div>
</article>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Yun. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/intellij-string-manipulation/"
                    data-tooltip="인텔리제이 플러그인 String Manipulation"
                    aria-label="이전: 인텔리제이 플러그인 String Manipulation"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/sql-test/"
                    data-tooltip="Sql을 통해서 테스트 코드를 쉽게 작성하자"
                    aria-label="다음: Sql을 통해서 테스트 코드를 쉽게 작성하자"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/resilience4j-basic/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/resilience4j-basic/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/resilience4j-basic/"
                        aria-label="Facebook에 공유하기"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Facebook에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/resilience4j-basic/"
                        aria-label="Twitter에 공유하기"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Twitter에 공유하기</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
            <h4 id="about-card-name">Yun</h4>
        
            <div id="about-card-bio"><p>기술 블로그</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
