
<!DOCTYPE html>
<html lang="ko">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Yun Blog">
    <title>Node 다른 서버 API 호출 - Yun Blog</title>
    <meta name="author" content="Yun">
    
        <meta name="keywords" content="Node,Spring,Spring Boot,Spring Batch,Kotlin,기술 블로그,JPA,Mongo,MySQL,OOP,">
    
    
    
        
            <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss2.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg"},"articleBody":"노드 서버에서 다른 API를 호출하는 방법을 소개해드리겠습니다. 물론 프론트에서 Ajax를 이용해서 다른 서버의 API를 간단하게 호출할 수 있지만 Ajax로 간단하게 호출할 수 있지만, 해당 API를 호출한 이후 자신의 서버에 해당 기록을 남겨야 하는 경우는 프론트가 아닌 백에서 처리해야 합니다.\n저희 서비스 예를 들어 설명하면 노드 서버에서 제휴 모바일 게임의 포인트를 Credit 할 수 있는 기능이 있습니다. 이때 게임 서버의 API를 호출을 Node 서버에서 진행해야 해당 기록을 데이터베이스에 남길 수 있습니다.\n전체소스는 Github에서 확인할수있습니다. 전체소스를 보시는 것을 권장합니다.\n필수 패키지 설치1npm install request --save\n\n\n전체 소스123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354module.exports = function (callee) &#123;    function API_Call(callee) &#123;        var OPTIONS = &#123;            headers: &#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;,            url: null,            body: null        &#125;;        const PORT = &#x27;3500&#x27;;        const BASE_PATH = &#x27;/api/v1&#x27;;        var HOST = null;        (function () &#123;            switch (callee) &#123;                case &#x27;dev&#x27;:                    HOST = &#x27;https://dev-api.com&#x27;;                    break;                case &#x27;prod&#x27;:                    HOST = &#x27;https://prod-api.com&#x27;;                    break;                case &#x27;another&#x27;:                    HOST = &#x27;http://localhost&#x27;;                    break;                default:                    HOST = &#x27;http://localhost&#x27;;            &#125;        &#125;)(callee);        return &#123;            login : function (user_id, password, callback) &#123;                OPTIONS.url = HOST + &#x27;:&#x27; + PORT + BASE_PATH + &#x27;/login&#x27;;                OPTIONS.body = JSON.stringify(&#123;                    &quot;user_id&quot;: user_id,                    &quot;password&quot;: password                &#125;);                request.post(OPTIONS, function (err, res, result) &#123;                    statusCodeErrorHandler(res.statusCode, callback, result);                &#125;);            &#125;        &#125;;    &#125;    function statusCodeErrorHandler(statusCode, callback , data) &#123;        switch (statusCode) &#123;            case 200:                callback(null, JSON.parse(data));                break;            default:                callback(&#x27;error&#x27;, JSON.parse(data));                break;        &#125;    &#125;    var INSTANCE;    if (INSTANCE === undefined) &#123;        INSTANCE = new API_Call(callee);    &#125;    return INSTANCE;&#125;;\n\nHOST 설정123456789101112131415(function () &#123;    switch (callee) &#123;        case &#x27;dev&#x27;:            HOST = &#x27;https://dev-api.com&#x27;;            break;        case &#x27;prod&#x27;:            HOST = &#x27;https://prod-api.com&#x27;;            break;        case &#x27;another&#x27;:            HOST = &#x27;http://localhost&#x27;;            break;        default:            HOST = &#x27;http://localhost&#x27;;    &#125;&#125;)(callee);\n\n즉시 실행 함수로 감싸고 switch 문을 실행시킵니다. 타 서버의 API 주소도 dev, prod, etc 등등 각기 다르므로 유동적으로 변경할 수 있게 설정합니다.var API_Call = require(&#39;../service/API_Call&#39;)(&#39;another&#39;); 이런 식으로 모듈을 require 시킬 때 해당 API 서버를 쉽게 정할 수 있습니다.\n타 서버의 API 정보 설정123456789function API_Call(callee) &#123;    var OPTIONS = &#123;        headers: &#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;,        url: null,        body: null    &#125;;    const PORT = &#x27;3500&#x27;;    const BASE_PATH = &#x27;/api/v1&#x27;;    var HOST = null;\n\nheaders: JSON으로 API를 받을 예정이니 Content-Type을 JSON 으로 설정합니다.\nurl : 해당 API의 URL을 의마합니다. 특정 요청에 따라서 달라질 예정이니 null 처리했습니다.\nbody : POST,PUT, DEL 등 body값을 전달해주는 객체로 사용됩니다.\nHOST, PORT, BASE_PATH &#x3D; http://localhost:3500/api/v1 로 됩니다.\n\n로그인 API를 호출 오는 로직으로 간단하게 설명해드리겠습니다.123456789101112return &#123;    login : function (user_id, password, callback) &#123;        OPTIONS.url = HOST + &#x27;:&#x27; + PORT + BASE_PATH + &#x27;/login&#x27;;        OPTIONS.body = JSON.stringify(&#123;            &quot;user_id&quot;: user_id,            &quot;password&quot;: password        &#125;);        request.post(OPTIONS, function (err, res, result) &#123;            statusCodeErrorHandler(res.statusCode, callback, result);        &#125;);    &#125;&#125;;\n\n이전 블로그에서 포스팅했던 API인 Login API를 호출해보겠습니다. 최종적인 url 값인 http://localhost:3500/api/v1/login로body 값으로 넘길 user_id, password를 바인딩 시켜줍니다.\n타 서버의 API를 호출이 완료되면 statusCodeErrorHandler 메서드를 통해서 에러 핸들링 작업을 진행하게 됩니다.\n예제는 같은 로컬 서버의 API를 호출하는 예제 이긴 합니다.(다른 서버를 못구해서.. 어쩔수업싱 로컬을 호출했습니다.)\nstatusCodeErrorHandler 에러 헨들링\n12345678910function statusCodeErrorHandler(statusCode, callback , data) &#123;    switch (statusCode) &#123;        case 200:            callback(null, JSON.parse(data));            break;        default:            callback(&#x27;error&#x27;, JSON.parse(data));            break;    &#125;&#125;\n\n메서드는 로직은 간단합니다. statusCode를 넘겨 받고 statusCode200일 경우는 callback으로 결괏값을 넘겨줍니다. 200 이 아닌 경우에는 각각의 환경에 맞게 구현하시면 됩니다.\n\n200 성공\n400 Bad Request - field validation 실패시\n401 Unauthorized - API 인증,인가 실패\n404 Not found ? 해당 리소스가 없음\n500 Internal Server Error - 서버 에러\n\n최소 위의 5개 정도의 StatusCode에 알맞은 로직을 추가하는 것을 권장합니다.\nAPI 호출1234567891011121314var API_Call = require(&#x27;../service/API_Call&#x27;)(&#x27;another&#x27;);router.post(&#x27;/login/another/api&#x27;, function (req, res) &#123;    var        user_id = req.body.user_id,        password = req.body.password;    API_Call.login(user_id, password, function (err, result) &#123;        if (!err) &#123;            res.json(result);        &#125; else &#123;            res.json(err);        &#125;    &#125;);&#125;);\n\nAPI_Call.js를 require 시킬 경우 (&#39;another&#39;)를 인자로 넘겨주게되면위에서 설명한 HOST 설정에서 HOST가 결정됩니다.\nhttp://localhost:3500/api/v1/login/another/api를 호출하게되면 넘겨 받은 user_id, password를 API_Call.login에게전달되고  statusCodeErrorHandler를 통해서 최종적으로 callback으로 err, result를 JSON으로 클라이언트에게 넘겨집니다.\n \nPostman을 이용해서 api&#x2F;v1&#x2F;login&#x2F;another&#x2F;api 를 호출한 결과입니다.\n마무리역시 소스 코드가 길어지면 코드 설명이 산으로 가는 듯합니다.역량 부족이겠죠… 애초에 구상했던 코드는 아주 간단했는데 욕심을 부려서 조금 더 넣다 보니 제가 봐도 설명 부분이 부족하다는 것이 느껴지네요.그래도 조금이라도 도움이 됬으면 합니다. 긴글 읽어주셔서 감사합니다.\n","dateCreated":"2017-02-05T00:00:00+09:00","dateModified":"2025-01-31T03:31:17+09:00","datePublished":"2017-02-05T00:00:00+09:00","description":"노드 서버에서 다른 API를 호출하는 방법을 소개해드리겠습니다. 물론 프론트에서 Ajax를 이용해서 다른 서버의 API를 간단하게 호출할 수 있지만 Ajax로 간단하게 호출할 수 있지만, 해당 API를 호출한 이후 자신의 서버에 해당 기록을 남겨야 하는 경우는 프론트가 아닌 백에서 처리해야 합니다.","headline":"Node 다른 서버 API 호출","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://cheese10yun.github.io/API-CALL/"},"publisher":{"@type":"Organization","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg","logo":{"@type":"ImageObject","url":"yun-icon.jpg"}},"url":"https://cheese10yun.github.io/API-CALL/","keywords":"Node"}</script>
    <meta name="description" content="노드 서버에서 다른 API를 호출하는 방법을 소개해드리겠습니다. 물론 프론트에서 Ajax를 이용해서 다른 서버의 API를 간단하게 호출할 수 있지만 Ajax로 간단하게 호출할 수 있지만, 해당 API를 호출한 이후 자신의 서버에 해당 기록을 남겨야 하는 경우는 프론트가 아닌 백에서 처리해야 합니다.">
<meta property="og:type" content="blog">
<meta property="og:title" content="Node 다른 서버 API 호출">
<meta property="og:url" content="https://cheese10yun.github.io/API-CALL/index.html">
<meta property="og:site_name" content="Yun Blog">
<meta property="og:description" content="노드 서버에서 다른 API를 호출하는 방법을 소개해드리겠습니다. 물론 프론트에서 Ajax를 이용해서 다른 서버의 API를 간단하게 호출할 수 있지만 Ajax로 간단하게 호출할 수 있지만, 해당 API를 호출한 이후 자신의 서버에 해당 기록을 남겨야 하는 경우는 프론트가 아닌 백에서 처리해야 합니다.">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://i.imgur.com/BpezpxV.png">
<meta property="article:published_time" content="2017-02-04T15:00:00.000Z">
<meta property="article:modified_time" content="2025-01-30T18:31:17.347Z">
<meta property="article:author" content="Yun">
<meta property="article:tag" content="Node">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/BpezpxV.png">
    
    
        
    
    
        <meta property="og:image" content="https://cheese10yun.github.io/assets/images/yun-icon.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90907312-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90907312-1');
    </script>


    

    
        
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5813739623204880" crossorigin="anonymous"></script>
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Yun Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="링크 열기: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="저자에 대해 더 알아보기"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
                </a>
                <h4 class="sidebar-profile-name">Yun</h4>
                
                    <h5 class="sidebar-profile-bio"><p>기술 블로그</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="카테고리"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">카테고리</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="태그"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">태그</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="아카이브"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">아카이브</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="검색"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">검색</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/cheese10yun"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/rss2.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Node 다른 서버 API 호출
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2017-02-05T00:00:00+09:00">
	
		    2017/02/05
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>노드 서버에서 다른 API를 호출하는 방법을 소개해드리겠습니다. 물론 프론트에서 Ajax를 이용해서 다른 서버의 API를 간단하게 호출할 수 있지만 Ajax로 간단하게 호출할 수 있지만, 해당 API를 호출한 이후 자신의 서버에 해당 기록을 남겨야 하는 경우는 프론트가 아닌 백에서 처리해야 합니다.</p>
<p><em><strong>저희 서비스 예를 들어 설명하면 노드 서버에서 제휴 모바일 게임의 포인트를 Credit 할 수 있는 기능이 있습니다. 이때 게임 서버의 API를 호출을 Node 서버에서 진행해야 해당 기록을 데이터베이스에 남길 수 있습니다.</strong></em></p>
<p><strong>전체소스는 <a target="_blank" rel="noopener" href="https://github.com/cheese10yun/node-yun">Github</a>에서 확인할수있습니다. 전체소스를 보시는 것을 권장합니다.</strong></p>
<h6 id="필수-패키지-설치"><a href="#필수-패키지-설치" class="headerlink" title="필수 패키지 설치"></a>필수 패키지 설치</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install request --save</span><br></pre></td></tr></table></figure>


<h6 id="전체-소스"><a href="#전체-소스" class="headerlink" title="전체 소스"></a>전체 소스</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">callee</span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">API_Call</span>(<span class="params">callee</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable constant_">OPTIONS</span> = &#123;</span><br><span class="line">            <span class="attr">headers</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;,</span><br><span class="line">            <span class="attr">url</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">body</span>: <span class="literal">null</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="string">&#x27;3500&#x27;</span>;</span><br><span class="line">        <span class="keyword">const</span> <span class="variable constant_">BASE_PATH</span> = <span class="string">&#x27;/api/v1&#x27;</span>;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable constant_">HOST</span> = <span class="literal">null</span>;</span><br><span class="line">        (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (callee) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;dev&#x27;</span>:</span><br><span class="line">                    <span class="variable constant_">HOST</span> = <span class="string">&#x27;https://dev-api.com&#x27;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;prod&#x27;</span>:</span><br><span class="line">                    <span class="variable constant_">HOST</span> = <span class="string">&#x27;https://prod-api.com&#x27;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;another&#x27;</span>:</span><br><span class="line">                    <span class="variable constant_">HOST</span> = <span class="string">&#x27;http://localhost&#x27;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="attr">default</span>:</span><br><span class="line">                    <span class="variable constant_">HOST</span> = <span class="string">&#x27;http://localhost&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)(callee);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            login : <span class="keyword">function</span> (<span class="params">user_id, password, callback</span>) &#123;</span><br><span class="line">                <span class="variable constant_">OPTIONS</span>.<span class="property">url</span> = <span class="variable constant_">HOST</span> + <span class="string">&#x27;:&#x27;</span> + <span class="variable constant_">PORT</span> + <span class="variable constant_">BASE_PATH</span> + <span class="string">&#x27;/login&#x27;</span>;</span><br><span class="line">                <span class="variable constant_">OPTIONS</span>.<span class="property">body</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">                    <span class="string">&quot;user_id&quot;</span>: user_id,</span><br><span class="line">                    <span class="string">&quot;password&quot;</span>: password</span><br><span class="line">                &#125;);</span><br><span class="line">                request.<span class="title function_">post</span>(<span class="variable constant_">OPTIONS</span>, <span class="keyword">function</span> (<span class="params">err, res, result</span>) &#123;</span><br><span class="line">                    <span class="title function_">statusCodeErrorHandler</span>(res.<span class="property">statusCode</span>, callback, result);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">statusCodeErrorHandler</span>(<span class="params">statusCode, callback , data</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (statusCode) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">200</span>:</span><br><span class="line">                <span class="title function_">callback</span>(<span class="literal">null</span>, <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                <span class="title function_">callback</span>(<span class="string">&#x27;error&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">INSTANCE</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable constant_">INSTANCE</span> === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="variable constant_">INSTANCE</span> = <span class="keyword">new</span> <span class="title function_">API_Call</span>(callee);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable constant_">INSTANCE</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h6 id="HOST-설정"><a href="#HOST-설정" class="headerlink" title="HOST 설정"></a>HOST 설정</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (callee) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;dev&#x27;</span>:</span><br><span class="line">            <span class="variable constant_">HOST</span> = <span class="string">&#x27;https://dev-api.com&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;prod&#x27;</span>:</span><br><span class="line">            <span class="variable constant_">HOST</span> = <span class="string">&#x27;https://prod-api.com&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;another&#x27;</span>:</span><br><span class="line">            <span class="variable constant_">HOST</span> = <span class="string">&#x27;http://localhost&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="variable constant_">HOST</span> = <span class="string">&#x27;http://localhost&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(callee);</span><br></pre></td></tr></table></figure>

<p>즉시 실행 함수로 감싸고 switch 문을 실행시킵니다. <em><strong>타 서버의 API 주소도 dev, prod, etc 등등 각기 다르므로 유동적으로 변경할 수 있게 설정합니다.</strong></em><br><code><b>var API_Call = require(&#39;../service/API_Call&#39;)(&#39;another&#39;);</b></code> 이런 식으로 모듈을 require 시킬 때 해당 API 서버를 쉽게 정할 수 있습니다.</p>
<h6 id="타-서버의-API-정보-설정"><a href="#타-서버의-API-정보-설정" class="headerlink" title="타 서버의 API 정보 설정"></a>타 서버의 API 정보 설정</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">API_Call</span>(<span class="params">callee</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">OPTIONS</span> = &#123;</span><br><span class="line">        <span class="attr">headers</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;,</span><br><span class="line">        <span class="attr">url</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">body</span>: <span class="literal">null</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="string">&#x27;3500&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">BASE_PATH</span> = <span class="string">&#x27;/api/v1&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">HOST</span> = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>headers: JSON으로 API를 받을 예정이니 Content-Type을 JSON 으로 설정합니다.</li>
<li>url : 해당 API의 URL을 의마합니다. 특정 요청에 따라서 달라질 예정이니 null 처리했습니다.</li>
<li>body : POST,PUT, DEL 등 body값을 전달해주는 객체로 사용됩니다.</li>
<li>HOST, PORT, BASE_PATH &#x3D; <a target="_blank" rel="noopener" href="http://localhost:3500/api/v1">http://localhost:3500/api/v1</a> 로 됩니다.</li>
</ul>
<h6 id="로그인-API를-호출-오는-로직으로-간단하게-설명해드리겠습니다"><a href="#로그인-API를-호출-오는-로직으로-간단하게-설명해드리겠습니다" class="headerlink" title="로그인 API를 호출 오는 로직으로 간단하게 설명해드리겠습니다."></a>로그인 API를 호출 오는 로직으로 간단하게 설명해드리겠습니다.</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">    login : <span class="keyword">function</span> (<span class="params">user_id, password, callback</span>) &#123;</span><br><span class="line">        <span class="variable constant_">OPTIONS</span>.<span class="property">url</span> = <span class="variable constant_">HOST</span> + <span class="string">&#x27;:&#x27;</span> + <span class="variable constant_">PORT</span> + <span class="variable constant_">BASE_PATH</span> + <span class="string">&#x27;/login&#x27;</span>;</span><br><span class="line">        <span class="variable constant_">OPTIONS</span>.<span class="property">body</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">            <span class="string">&quot;user_id&quot;</span>: user_id,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: password</span><br><span class="line">        &#125;);</span><br><span class="line">        request.<span class="title function_">post</span>(<span class="variable constant_">OPTIONS</span>, <span class="keyword">function</span> (<span class="params">err, res, result</span>) &#123;</span><br><span class="line">            <span class="title function_">statusCodeErrorHandler</span>(res.<span class="property">statusCode</span>, callback, result);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>이전 블로그에서 포스팅했던 API인 <a href="https://cheese10yun.github.io/passport-mysql">Login API</a>를 호출해보겠습니다. 최종적인 url 값인 <code><b><a target="_blank" rel="noopener" href="http://localhost:3500/api/v1/login">http://localhost:3500/api/v1/login</a></b></code>로body 값으로 넘길 user_id, password를 바인딩 시켜줍니다.</p>
<p>타 서버의 API를 호출이 완료되면 <code><b>statusCodeErrorHandler</b></code> 메서드를 통해서 에러 핸들링 작업을 진행하게 됩니다.</p>
<p><em><strong>예제는 같은 로컬 서버의 API를 호출하는 예제 이긴 합니다.(다른 서버를 못구해서.. 어쩔수업싱 로컬을 호출했습니다.)</strong></em></p>
<p><code><b>statusCodeErrorHandler</b></code> 에러 헨들링</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">statusCodeErrorHandler</span>(<span class="params">statusCode, callback , data</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (statusCode) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">200</span>:</span><br><span class="line">            <span class="title function_">callback</span>(<span class="literal">null</span>, <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="title function_">callback</span>(<span class="string">&#x27;error&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>메서드는 로직은 간단합니다. <code><b>statusCode</b></code>를 넘겨 받고 <code><b>statusCode</b></code>200일 경우는 callback으로 결괏값을 넘겨줍니다. 200 이 아닌 경우에는 각각의 환경에 맞게 구현하시면 됩니다.</p>
<ul>
<li>200 성공</li>
<li>400 Bad Request - field validation 실패시</li>
<li>401 Unauthorized - API 인증,인가 실패</li>
<li>404 Not found ? 해당 리소스가 없음</li>
<li>500 Internal Server Error - 서버 에러</li>
</ul>
<p><strong>최소 위의 5개 정도의 StatusCode에 알맞은 로직을 추가하는 것을 권장합니다.</strong></p>
<h6 id="API-호출"><a href="#API-호출" class="headerlink" title="API 호출"></a>API 호출</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> API_Call = <span class="built_in">require</span>(<span class="string">&#x27;../service/API_Call&#x27;</span>)(<span class="string">&#x27;another&#x27;</span>);</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login/another/api&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span></span><br><span class="line">        user_id = req.<span class="property">body</span>.<span class="property">user_id</span>,</span><br><span class="line">        password = req.<span class="property">body</span>.<span class="property">password</span>;</span><br><span class="line"></span><br><span class="line">    API_Call.<span class="title function_">login</span>(user_id, password, <span class="keyword">function</span> (<span class="params">err, result</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">            res.<span class="title function_">json</span>(result);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">json</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code><b>API_Call.js</b></code>를 require 시킬 경우 <code><b>(&#39;another&#39;)</b></code>를 인자로 넘겨주게되면<br>위에서 설명한 <code><b>HOST 설정</b></code>에서 HOST가 결정됩니다.</p>
<p><code><b><a target="_blank" rel="noopener" href="http://localhost:3500/api/v1/login/another/api">http://localhost:3500/api/v1/login/another/api</a></b></code>를 호출하게되면 넘겨 받은 user_id, password를 <code><b>API_Call.login</b></code>에게<br>전달되고  <code><b>statusCodeErrorHandler</b></code>를 통해서 최종적으로 callback으로 <code><b>err, result</b></code>를 JSON으로 클라이언트에게 넘겨집니다.</p>
<p><img src="https://i.imgur.com/BpezpxV.png"> </p>
<p><strong>Postman을 이용해서 api&#x2F;v1&#x2F;login&#x2F;another&#x2F;api 를 호출한 결과입니다.</strong></p>
<h6 id="마무리"><a href="#마무리" class="headerlink" title="마무리"></a>마무리</h6><p>역시 소스 코드가 길어지면 코드 설명이 산으로 가는 듯합니다.<br>역량 부족이겠죠… 애초에 구상했던 코드는 아주 간단했는데 욕심을 부려서 조금 더 넣다 보니 제가 봐도 설명 부분이 부족하다는 것이 느껴지네요.<br>그래도 조금이라도 도움이 됬으면 합니다. 긴글 읽어주셔서 감사합니다.</p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">태그</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/Node/" rel="tag">Node</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/Node-AWS-S3-Upload/"
                    data-tooltip="Node AWS S3 업로드"
                    aria-label="이전: Node AWS S3 업로드"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/blog-start-part2/"
                    data-tooltip="블로그를 시작하려는 당신에게(2)"
                    aria-label="다음: 블로그를 시작하려는 당신에게(2)"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/API-CALL/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/API-CALL/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://cheese10yun.github.io/API-CALL/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>


<!-- Comment -->
<!--  utteranc comment -->

<script src="https://utteranc.es/client.js"
        repo="cheese10yun/blog-comment"
        issue-term="title"
        label="Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Yun. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/Node-AWS-S3-Upload/"
                    data-tooltip="Node AWS S3 업로드"
                    aria-label="이전: Node AWS S3 업로드"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/blog-start-part2/"
                    data-tooltip="블로그를 시작하려는 당신에게(2)"
                    aria-label="다음: 블로그를 시작하려는 당신에게(2)"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/API-CALL/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/API-CALL/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://cheese10yun.github.io/API-CALL/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/API-CALL/"
                        aria-label="Facebook에 공유하기"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Facebook에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/API-CALL/"
                        aria-label="Twitter에 공유하기"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Twitter에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://cheese10yun.github.io/API-CALL/"
                        aria-label="Google+에 공유하기"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Google+에 공유하기</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
            <h4 id="about-card-name">Yun</h4>
        
            <div id="about-card-bio"><p>기술 블로그</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
