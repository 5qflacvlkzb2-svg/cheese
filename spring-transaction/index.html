
<!DOCTYPE html>
<html lang="ko">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="naver-site-verification" content="a37ea649edf26e70c3de94f9cb034f9d6e11de3f" />
    <meta name="generator" content="Yun Blog">
    <title>Spring 레플리케이션 트랜잭션 처리 방식 - Yun Blog</title>
    <meta name="author" content="Yun">
    
        <meta name="keywords" content="Node,Spring,Spring Boot,Spring Batch,Kotlin,기술 블로그,JPA,Mongo,MySQL,OOP,">
    
    
    
        
            <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss2.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg"},"articleBody":"대부분의 서비스에서는 데이터베이스를 Master, Slave 구조로 Master에서는 Create, Update, Delete 업무를 진행하고 Slave에서 Read 업무를 진행하는 구조로 설계합니다. Spring의 Master, Slave 환경에서의 트랜잭션에 대해서 포스팅해보겠습니다.\n레플리케이션MySQL 레플리케이션\nMySQL은 위와 같은 구조로 마스터 - 슬레이브 구조를 지원합니다. 간략하게 설명하면 다음과 같이 구성되어 있습니다.\n\n마스터의 변경을 기록하기 위한 바이너리 로그\n슬레이브에 데이터를 전송하기 위한 마스터 스레드\n슬레이브에서 데이터를 받아 릴레이 로그에 기록하기 위한 I&#x2F;O 스레드\n릴레이 로그에서 데이터를 읽어 재생하기 위한 슬레이브 SQL 스레드\n\nMySQL 5.7부터 ACK를 기다리는 시점의 변경이 생겼습니다. 기존 COMMIT을 실행한 다음이 아니라 COMMIT을 실행하기 전에 ACK를 기다리도록 변경되었습니다. 이로 인해 마스터에서 COMMIT이 완료된 트랜잭션은 모두 슬레이브에 확실히 전달되게 되어서 무손실 레플리케이션을 보다 잘 지원하게 되었습니다. 자세한 내용은 MySQL 5.7 완벽 분석에 잘 설명되어 있습니다.\nRoutingDataSource\n트랜잭션에서 readOnly 설정을 기준으로 false 경우 Master DataSource, true 경우 Slave DataSource를 바라보게 설정할 수 있습니다. Master, Slave의 DataSource의 설정은 Spring Boot에서의 순정을 상태를 최대한 이용하려 했습니다. 본 포스팅은 DataSource 코드 구성을 다루는 아니기 때문에 해당 내용은 다른 자료를 보시는 것을 권장드립니다.\n1234567891011121314151617# application.ymlspring:    datasource:        initialization-mode: never        master:            hikari:                jdbc-url: jdbc:mysql://localhost:3306/study?useSSL=false&amp;serverTimezone=UTC&amp;autoReconnect=true&amp;rewriteBatchedStatements=true&amp;logger=Slf4JLogger&amp;profileSQL=false&amp;maxQuerySizeToLog=100000                username: root                password: root                driver-class-name: com.mysql.cj.jdbc.Driver        slave:            hikari:                jdbc-url: jdbc:mysql://localhost:3307/study?useSSL=false&amp;serverTimezone=UTC&amp;autoReconnect=true&amp;rewriteBatchedStatements=true&amp;logger=Slf4JLogger&amp;profileSQL=false&amp;maxQuerySizeToLog=100000                username: root                password: root                driver-class-name: com.mysql.cj.jdbc.Driver\n\n\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051const val PROPERTIES = &quot;spring.datasource.hikari&quot;const val MASTER_DATASOURCE = &quot;masterDataSource&quot;const val SLAVE_DATASOURCE = &quot;slaveDataSource&quot;@Configurationclass DataSourceConfiguration &#123;    @Bean(name = [MASTER_DATASOURCE])    @ConfigurationProperties(prefix = &quot;spring.datasource.master.hikari&quot;)    fun masterDataSource() =        DataSourceBuilder.create()            .type(HikariDataSource::class.java)            .build()    @Bean(name = [SLAVE_DATASOURCE])    @ConfigurationProperties(&quot;spring.datasource.slave.hikari&quot;)    fun slaveDataSource() =        DataSourceBuilder.create()            .type(HikariDataSource::class.java)            .build()            .apply &#123; this.isReadOnly = true &#125;    @Bean    @DependsOn(MASTER_DATASOURCE, SLAVE_DATASOURCE)    fun routingDataSource(        @Qualifier(MASTER_DATASOURCE) masterDataSource: DataSource,        @Qualifier(SLAVE_DATASOURCE) slaveDataSource: DataSource    ): DataSource &#123;        val routingDataSource = RoutingDataSource()        val dataSources = hashMapOf&lt;Any, Any&gt;()        dataSources[&quot;master&quot;] = masterDataSource        dataSources[&quot;slave&quot;] = slaveDataSource        routingDataSource.setTargetDataSources(dataSources)        routingDataSource.setDefaultTargetDataSource(masterDataSource)        return routingDataSource    &#125;    @Primary    @Bean    @DependsOn(&quot;routingDataSource&quot;)    fun dataSource(routingDataSource: DataSource) =        LazyConnectionDataSourceProxy(routingDataSource)&#125;class RoutingDataSource : AbstractRoutingDataSource() &#123;    override fun determineCurrentLookupKey(): Any =        when &#123;            TransactionSynchronizationManager.isCurrentTransactionReadOnly() -&gt; &quot;slave&quot;            else -&gt; &quot;master&quot;        &#125;&#125;\n\nmasterDataSource, routingDataSource DataSource의 Bean을 설정합니다. 각각 3306(Master), 3307(Slave) 포트를 사용하며 해당 디비는 Master, Slave 설정까지 완료되어 있습니다.\nroutingDataSource에서는 masterDataSource, routingDataSource 데이터 소스를 master, slave를 HashMap에 저장합니다. determineCurrentLookupKey 메서드에서 readOnly 설정 여부에 따라 master, slave의 DataSource를 선택하게 됩니다.\n마지막으로 기본 dataSource Bean을 생성합니다. 이때 routingDataSource Bean을 이용해서 LazyConnectionDataSourceProxy를 생성합니다.\nRoutingDataSource 테스트1234567891011121314@RestController@RequestMapping(&quot;/api/book&quot;)class BookApi(    private val bookRepository: BookRepository) &#123;    @GetMapping(&quot;/slave&quot;)    @Transactional(readOnly = true)    fun getSlave() = bookRepository.findAll()    @GetMapping(&quot;/master&quot;)    @Transactional(readOnly = false)    fun getMaster() = bookRepository.findAll()&#125;\n\n/api/book/slave는 readOnly = true 설정으로 Slave를 바라보게 하고, 그와 반대로 /api/book/master는 readOnly = false설정으로 Master를 바라보게 설정하고 API 호출 이후 데이터베이스 로그를 확인해보겠습니다.\n\nreadOnly 여부에 따라서 DataSource가 적절하게 라우팅 되는 것을 확인할 수 있습니다.\nSpring Transaction 테스트123456789101112@Componentclass AppSetup(    private val bookRepository: BookRepository) : ApplicationRunner &#123;    override fun run(args: ApplicationArguments) &#123;        bookRepository.saveAll(            (1..5).map &#123; Book(title = &quot;INIT&quot;) &#125;                .toList()        )    &#125;&#125;\nApplication이 실행될 때 title이 INIT으로 데이터를 5개를 생성하는 코드를 추가했습니다. 각 메서드마다 readOnly 설정을 다루게 두고 업데이트 작업을 진행하게 됩니다.\n조회 이후 업데이트12345678910111213141516171819202122232425262728293031323334353637@RestController@RequestMapping(&quot;/api/book&quot;)class BookApi(    private val bookRepository: BookRepository,    private val bookService: BookService) &#123;    @GetMapping(&quot;/update/slave&quot;)    fun startSlave() &#123;        bookService.updateSlave()    &#125;&#125;@Serviceclass BookService(    private val bookRepository: BookRepository) &#123;    @Transactional(readOnly = true)    fun updateSlave() &#123;        updateTitle(&quot;new title(slave)&quot;)    &#125;    @Transactional(readOnly = false)    fun updateMaster() &#123;        updateTitle(&quot;new title(master)&quot;)    &#125;    @Transactional(readOnly = false)    fun updateTitle(title: String) &#123;        val books = bookRepository.findAll()        for (book in books) &#123;            book.title = title        &#125;        bookRepository.saveAll(books)    &#125;&#125;\n\nupdateSlave() 메서드는 readOnly = true 시작하고, updateTitle() 메서드에서 readOnly = false로 진행\nupdateMaster() 메서드는 readOnly = false 시작하고, updateTitle() 메서드에서 readOnly = false로 진행\n\nslave 조회 이후 업데이트\nselect query가 slave에서 진행된 것을 확인할 수 있습니다. 조회는 readOnly = true 설정이지만 title를 업데이트할 때는 readOnly = false이기 때문에 영속성 컨텍스트가 flush를 진행하면 해당 내용이 데이터베이스에 반영될 까요? 확인해 보겠습니다.\n12345678910111213141516171819202122232425262728293031323334353637383940414243GET http://localhost:8080/api/book/masterHTTP/1.1 200 Content-Type: application/jsonTransfer-Encoding: chunkedDate: Thu, 06 May 2021 13:53:28 GMTKeep-Alive: timeout=60Connection: keep-alive[  &#123;    &quot;title&quot;: &quot;INIT&quot;,    &quot;id&quot;: 1,    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,    &quot;updatedAt&quot;: &quot;2021-05-06T22:42:33&quot;  &#125;,  &#123;    &quot;title&quot;: &quot;INIT&quot;,    &quot;id&quot;: 2,    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,    &quot;updatedAt&quot;: &quot;2021-05-06T22:42:33&quot;  &#125;,  &#123;    &quot;title&quot;: &quot;INIT&quot;,    &quot;id&quot;: 3,    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,    &quot;updatedAt&quot;: &quot;2021-05-06T22:42:33&quot;  &#125;,  &#123;    &quot;title&quot;: &quot;INIT&quot;,    &quot;id&quot;: 4,    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,    &quot;updatedAt&quot;: &quot;2021-05-06T22:42:33&quot;  &#125;,  &#123;    &quot;title&quot;: &quot;INIT&quot;,    &quot;id&quot;: 5,    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,    &quot;updatedAt&quot;: &quot;2021-05-06T22:42:33&quot;  &#125;]Response code: 200; Time: 31ms; Content length: 461 bytes\n결과는 변경되지 않았습니다.\nmaster 조회 이후 업데이트\nselect, update query가 master에서 진행된 것을 확인할 수 있습니다. 마찬가지로 API를 호출해서 결과를 확인해 보겠습니다.\n12345678910111213141516171819202122232425262728293031323334353637383940414243GET http://localhost:8080/api/book/masterHTTP/1.1 200 Content-Type: application/jsonTransfer-Encoding: chunkedDate: Thu, 06 May 2021 14:01:40 GMTKeep-Alive: timeout=60Connection: keep-alive[  &#123;    &quot;title&quot;: &quot;new title(master)&quot;,    &quot;id&quot;: 1,    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,    &quot;updatedAt&quot;: &quot;2021-05-06T22:59:06&quot;  &#125;,  &#123;    &quot;title&quot;: &quot;new title(master)&quot;,    &quot;id&quot;: 2,    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,    &quot;updatedAt&quot;: &quot;2021-05-06T22:59:06&quot;  &#125;,  &#123;    &quot;title&quot;: &quot;new title(master)&quot;,    &quot;id&quot;: 3,    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,    &quot;updatedAt&quot;: &quot;2021-05-06T22:59:06&quot;  &#125;,  &#123;    &quot;title&quot;: &quot;new title(master)&quot;,    &quot;id&quot;: 4,    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,    &quot;updatedAt&quot;: &quot;2021-05-06T22:59:06&quot;  &#125;,  &#123;    &quot;title&quot;: &quot;new title(master)&quot;,    &quot;id&quot;: 5,    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,    &quot;updatedAt&quot;: &quot;2021-05-06T22:59:06&quot;  &#125;]Response code: 200; Time: 51ms; Content length: 526 bytes\n정상적으로 title이 변경된 것을 확인할 수 있습니다.\n다른 트랜잭션에서 Update1234567891011121314151617181920212223242526@Serviceclass BookService(    private val bookRepository: BookRepository) &#123;    @Transactional(readOnly = true)    fun updateSlave() &#123;        println(&quot;updateSlave CurrentTransactionName: $&#123;TransactionSynchronizationManager.getCurrentTransactionName()&#125;&quot;)        bookUpdateService.updateTitle(&quot;new title(slave)&quot;)    &#125;&#125;@Serviceclass BookUpdateService(    private val bookRepository: BookRepository)&#123;    @Transactional(readOnly = false, propagation = Propagation.REQUIRES_NEW)    fun updateTitle(title: String) &#123;        println(&quot;updateTitle CurrentTransactionName: $&#123;TransactionSynchronizationManager.getCurrentTransactionName()&#125;&quot;)        val books = bookRepository.findAll()        for (book in books) &#123;            book.title = title        &#125;        bookRepository.saveAll(books)    &#125;&#125;\nBookUpdateService 클래스를 만들고 updateTitle 메서드를 해당 클래스에서 propagation = Propagation.REQUIRES_NEW 설정을 통해서 새로운 트랜잭션에서 처리하도록 작성하고 /api/book/update/slave를 호출하고 조회 API를 호출해서 결과를 확인해 보겠습니다.\n기존 서비스 코드에서 구현을 하지 않고 BookUpdateService 서비스 코드를 만든 이유는 동일한 Bean에서 @Transactional예상하는 것과 다르게 동작하기 때문입니다. 자세한 내용은 이전 동일한 Bean(Class)에서 @Transactional 동작 방식을 참고해 주세요\n1234567891011121314151617181920GET http://localhost:8080/api/book/slaveHTTP/1.1 200 Content-Type: application/jsonTransfer-Encoding: chunkedDate: Sat, 08 May 2021 12:38:56 GMTKeep-Alive: timeout=60Connection: keep-alive[  &#123;    &quot;title&quot;: &quot;new title(slave)&quot;,    &quot;id&quot;: 1,    &quot;createdAt&quot;: &quot;2021-05-08T21:37:43&quot;,    &quot;updatedAt&quot;: &quot;2021-05-08T21:38:44&quot;  &#125;,  ...]Response code: 200; Time: 107ms; Content length: 521 bytes\n새로운 트랜잭션의 경우 masterDataSource를 바라보게 되며 데이터베이스에 반영되는것을 확인할 수 있습니다.\n\n트랜잭션 이름을 봐도 해당 트랜잭션이 다르다는 것을 확인할 수 있습니다. 즉 com.example.springtransaction.BookService.updateSlave 트랜잭션은 salveDataSoruce, com.example.springtransaction.BookUpdateService.updateTitle는 masterDataSource를 바라봅니다.\n그렇다면 왜 그런것일까?첫 트랜잭션의 설정의 readOnly에 따라 salveDataSoruce, masterDataSource가 결정되며, 동일한 트랜잭션에서는 지정된 readOnly 속성은 변경되지 않습니다. 기존 트랜잭션과 전혀 다른 트랜잭션을 만나게 되면 해당 트랜잭션의 readOnly설정에 따라 DataSource가 결정됩니다. 그렇다면 왜 이렇게 되는 걸까요? 제가 학습했던 내용을 토대로 설명드리기 때문에 틀린 부분이 있을 수도 있습니다.\n스프링의 트랜잭션 동기화\n토비의 스프링 3.1, 361 페이지\n\n스프링은 위와 같은 방식으로 트랜잭션 동기화를 진행합니다. 해당 방식은 트랜잭션을 시작하기 위해 만든 Connection 오브젝트를 특별한 저장소에 보관해두고, 이후에 호출되는 메서드에서 저장된 Connection을 가져다가 사용합니다.\n\n(1) Userservice Connection을 생성\n(2) 생성된 Connection을 트랜잭션 동기화 저장소에 저장, SetAutoCommit(false)를 호출하여 트랜잭션을 시작\n(3) 첫 번째 update() 메서드가 호출되고 (4) 트랜잭션 동기화 저장소에 현재 시작된 트랜잭션을 가진 Connection을 확인합니다. 이 경우는(2)에서 생성한 Connection을 가져옵니다.\n(5) Connection을 이용해 PreparedsStatment을 만들어 해당 SQL을 실행하고 JdbcTemplated는 Connection 닫지 않은 상태로 작업을 마침\n동일한 플로우로 (6), (7), (8) 수행\n또 동일한 플로우로 (9), (10), (11) 수행하며 트랜잭션 내의 모든 작업이 정상적으로 끝났으면 (12) Conntion commit을 호출해 트랜잭션을 완료\n(13) 트랜잭션 저장소가 더 이상 Connection 객체를 저장하지 않도록 이를 제거\n\n위와 같은 플로우로 트랜잭션이 진행됩니다.\n\nupdateSlave() 메서드는 readOnly = true 시작하고, updateTitle() 메서드에서 readOnly = false로 진행 되는 경우\n\n이런 경우에는 updateSlave()에서 Connection(Slave)을 생성 하고 updateTitle()에서 트랜잭션 동기화 저장소에 저장된 트랜잭션을 가진 Connection(Slave) 기반으로 트랜잭션을 시작하게 됩니다. 그러기 때문에 updateTitle() 메서드의 트랜잭션 readOnly = false 설정은 동작하지 않게 됩니다.\n참고\nMySQL 5.7 완벽 분석\nSpring, master-slave dynamic routing datasource 사용하기\n토비의 스프링 3.1\n\n","dateCreated":"2021-05-08T23:33:33+09:00","dateModified":"2025-01-31T06:29:31+09:00","datePublished":"2021-05-08T23:33:33+09:00","description":"대부분의 서비스에서는 데이터베이스를 Master, Slave 구조로 Master에서는 Create, Update, Delete 업무를 진행하고 Slave에서 Read 업무를 진행하는 구조로 설계합니다.","headline":"Spring 레플리케이션 트랜잭션 처리 방식","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://cheese10yun.github.io/spring-transaction/"},"publisher":{"@type":"Organization","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg","logo":{"@type":"ImageObject","url":"yun-icon.jpg"}},"url":"https://cheese10yun.github.io/spring-transaction/","keywords":"Transaction, Spring"}</script>
    <meta name="description" content="대부분의 서비스에서는 데이터베이스를 Master, Slave 구조로 Master에서는 Create, Update, Delete 업무를 진행하고 Slave에서 Read 업무를 진행하는 구조로 설계합니다.">
<meta property="og:type" content="blog">
<meta property="og:title" content="Spring 레플리케이션 트랜잭션 처리 방식">
<meta property="og:url" content="https://cheese10yun.github.io/spring-transaction/index.html">
<meta property="og:site_name" content="Yun Blog">
<meta property="og:description" content="대부분의 서비스에서는 데이터베이스를 Master, Slave 구조로 Master에서는 Create, Update, Delete 업무를 진행하고 Slave에서 Read 업무를 진행하는 구조로 설계합니다.">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://github.com/cheese10yun/TIL/raw/master/assets/mysql-replication3.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/spring-transaction/docs/replication-flow.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/spring-transaction/docs/query-log.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/spring-transaction/docs/query-log-update-in-slave.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/spring-transaction/docs/master-update-result.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/spring-transaction/docs/transaction-name.png">
<meta property="og:image" content="https://raw.githubusercontent.com/cheese10yun/TIL/master/assets/TransactionSynchronizations.png">
<meta property="article:published_time" content="2021-05-08T14:33:33.000Z">
<meta property="article:modified_time" content="2025-01-30T21:29:31.833Z">
<meta property="article:author" content="Yun">
<meta property="article:tag" content="Transaction">
<meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/cheese10yun/TIL/raw/master/assets/mysql-replication3.png">
    
    
        
    
    
        <meta property="og:image" content="https://cheese10yun.github.io/assets/images/yun-icon.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90907312-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90907312-1');
    </script>


    

    
        
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5813739623204880" crossorigin="anonymous"></script>
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Yun Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="링크 열기: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="저자에 대해 더 알아보기"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
                </a>
                <h4 class="sidebar-profile-name">Yun</h4>
                
                    <h5 class="sidebar-profile-bio"><p>기술 블로그</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="카테고리"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">카테고리</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="태그"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">태그</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="아카이브"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">아카이브</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="검색"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">검색</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/cheese10yun"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/rss2.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Spring 레플리케이션 트랜잭션 처리 방식
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2021-05-08T23:33:33+09:00">
	
		    2021/05/08
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>대부분의 서비스에서는 데이터베이스를 Master, Slave 구조로 Master에서는 Create, Update, Delete 업무를 진행하고 Slave에서 Read 업무를 진행하는 구조로 설계합니다. Spring의 Master, Slave 환경에서의 트랜잭션에 대해서 포스팅해보겠습니다.</p>
<h2 id="레플리케이션"><a href="#레플리케이션" class="headerlink" title="레플리케이션"></a>레플리케이션</h2><h3 id="MySQL-레플리케이션"><a href="#MySQL-레플리케이션" class="headerlink" title="MySQL 레플리케이션"></a>MySQL 레플리케이션</h3><p><img src="https://github.com/cheese10yun/TIL/raw/master/assets/mysql-replication3.png"></p>
<p>MySQL은 위와 같은 구조로 마스터 - 슬레이브 구조를 지원합니다. 간략하게 설명하면 다음과 같이 구성되어 있습니다.</p>
<ul>
<li>마스터의 변경을 기록하기 위한 바이너리 로그</li>
<li>슬레이브에 데이터를 전송하기 위한 마스터 스레드</li>
<li>슬레이브에서 데이터를 받아 릴레이 로그에 기록하기 위한 I&#x2F;O 스레드</li>
<li>릴레이 로그에서 데이터를 읽어 재생하기 위한 슬레이브 SQL 스레드</li>
</ul>
<p>MySQL 5.7부터 ACK를 기다리는 시점의 변경이 생겼습니다. 기존 COMMIT을 실행한 다음이 아니라 COMMIT을 실행하기 전에 ACK를 기다리도록 변경되었습니다. 이로 인해 마스터에서 COMMIT이 완료된 트랜잭션은 모두 슬레이브에 확실히 전달되게 되어서 무손실 레플리케이션을 보다 잘 지원하게 되었습니다. 자세한 내용은 <a target="_blank" rel="noopener" href="http://www.yes24.com/Product/Goods/72270172">MySQL 5.7 완벽 분석</a>에 잘 설명되어 있습니다.</p>
<h3 id="RoutingDataSource"><a href="#RoutingDataSource" class="headerlink" title="RoutingDataSource"></a>RoutingDataSource</h3><p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/spring-transaction/docs/replication-flow.png"></p>
<p>트랜잭션에서 <code>readOnly</code> 설정을 기준으로 <code>false</code> 경우 Master DataSource, <code>true</code> 경우 Slave DataSource를 바라보게 설정할 수 있습니다. Master, Slave의 DataSource의 설정은 Spring Boot에서의 순정을 상태를 최대한 이용하려 했습니다. 본 포스팅은 DataSource 코드 구성을 다루는 아니기 때문에 해당 내용은 다른 자료를 보시는 것을 권장드립니다.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">initialization-mode:</span> <span class="string">never</span></span><br><span class="line">        <span class="attr">master:</span></span><br><span class="line">            <span class="attr">hikari:</span></span><br><span class="line">                <span class="attr">jdbc-url:</span> <span class="string">jdbc:mysql://localhost:3306/study?useSSL=false&amp;serverTimezone=UTC&amp;autoReconnect=true&amp;rewriteBatchedStatements=true&amp;logger=Slf4JLogger&amp;profileSQL=false&amp;maxQuerySizeToLog=100000</span></span><br><span class="line">                <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">                <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">                <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">slave:</span></span><br><span class="line">            <span class="attr">hikari:</span></span><br><span class="line">                <span class="attr">jdbc-url:</span> <span class="string">jdbc:mysql://localhost:3307/study?useSSL=false&amp;serverTimezone=UTC&amp;autoReconnect=true&amp;rewriteBatchedStatements=true&amp;logger=Slf4JLogger&amp;profileSQL=false&amp;maxQuerySizeToLog=100000</span></span><br><span class="line">                <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">                <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">                <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure>


<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">val</span> PROPERTIES = <span class="string">&quot;spring.datasource.hikari&quot;</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">val</span> MASTER_DATASOURCE = <span class="string">&quot;masterDataSource&quot;</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">val</span> SLAVE_DATASOURCE = <span class="string">&quot;slaveDataSource&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataSourceConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = [MASTER_DATASOURCE])</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = <span class="string">&quot;spring.datasource.master.hikari&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">masterDataSource</span><span class="params">()</span></span> =</span><br><span class="line">        DataSourceBuilder.create()</span><br><span class="line">            .type(HikariDataSource::<span class="keyword">class</span>.java)</span><br><span class="line">            .build()</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = [SLAVE_DATASOURCE])</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(<span class="string">&quot;spring.datasource.slave.hikari&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">slaveDataSource</span><span class="params">()</span></span> =</span><br><span class="line">        DataSourceBuilder.create()</span><br><span class="line">            .type(HikariDataSource::<span class="keyword">class</span>.java)</span><br><span class="line">            .build()</span><br><span class="line">            .apply &#123; <span class="keyword">this</span>.isReadOnly = <span class="literal">true</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@DependsOn(MASTER_DATASOURCE, SLAVE_DATASOURCE)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">routingDataSource</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="meta">@Qualifier(MASTER_DATASOURCE)</span> masterDataSource: <span class="type">DataSource</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="meta">@Qualifier(SLAVE_DATASOURCE)</span> slaveDataSource: <span class="type">DataSource</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: DataSource &#123;</span><br><span class="line">        <span class="keyword">val</span> routingDataSource = RoutingDataSource()</span><br><span class="line">        <span class="keyword">val</span> dataSources = hashMapOf&lt;Any, Any&gt;()</span><br><span class="line">        dataSources[<span class="string">&quot;master&quot;</span>] = masterDataSource</span><br><span class="line">        dataSources[<span class="string">&quot;slave&quot;</span>] = slaveDataSource</span><br><span class="line">        routingDataSource.setTargetDataSources(dataSources)</span><br><span class="line">        routingDataSource.setDefaultTargetDataSource(masterDataSource)</span><br><span class="line">        <span class="keyword">return</span> routingDataSource</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@DependsOn(<span class="string">&quot;routingDataSource&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">dataSource</span><span class="params">(routingDataSource: <span class="type">DataSource</span>)</span></span> =</span><br><span class="line">        LazyConnectionDataSourceProxy(routingDataSource)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RoutingDataSource</span> : <span class="type">AbstractRoutingDataSource</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">determineCurrentLookupKey</span><span class="params">()</span></span>: Any =</span><br><span class="line">        <span class="keyword">when</span> &#123;</span><br><span class="line">            TransactionSynchronizationManager.isCurrentTransactionReadOnly() -&gt; <span class="string">&quot;slave&quot;</span></span><br><span class="line">            <span class="keyword">else</span> -&gt; <span class="string">&quot;master&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>masterDataSource</code>, <code>routingDataSource</code> DataSource의 Bean을 설정합니다. 각각 3306(Master), 3307(Slave) 포트를 사용하며 해당 디비는 Master, Slave 설정까지 완료되어 있습니다.</p>
<p><code>routingDataSource</code>에서는 <code>masterDataSource</code>, <code>routingDataSource</code> 데이터 소스를 <code>master</code>, <code>slave</code>를 HashMap에 저장합니다. <code>determineCurrentLookupKey</code> 메서드에서 <code>readOnly</code> 설정 여부에 따라 <code>master</code>, <code>slave</code>의 <code>DataSource</code>를 선택하게 됩니다.</p>
<p>마지막으로 기본 <code>dataSource</code> Bean을 생성합니다. 이때 <code>routingDataSource</code> Bean을 이용해서 <code>LazyConnectionDataSourceProxy</code>를 생성합니다.</p>
<h3 id="RoutingDataSource-테스트"><a href="#RoutingDataSource-테스트" class="headerlink" title="RoutingDataSource 테스트"></a>RoutingDataSource 테스트</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(<span class="string">&quot;/api/book&quot;</span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookApi</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> bookRepository: BookRepository</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(<span class="string">&quot;/slave&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getSlave</span><span class="params">()</span></span> = bookRepository.findAll()</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(<span class="string">&quot;/master&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Transactional(readOnly = false)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getMaster</span><span class="params">()</span></span> = bookRepository.findAll()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>/api/book/slave</code>는 <code>readOnly = true</code> 설정으로 Slave를 바라보게 하고, 그와 반대로 <code>/api/book/master</code>는 <code>readOnly = false</code>설정으로 Master를 바라보게 설정하고 API 호출 이후 데이터베이스 로그를 확인해보겠습니다.</p>
<p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/spring-transaction/docs/query-log.png"></p>
<p><code>readOnly</code> 여부에 따라서 DataSource가 적절하게 라우팅 되는 것을 확인할 수 있습니다.</p>
<h2 id="Spring-Transaction-테스트"><a href="#Spring-Transaction-테스트" class="headerlink" title="Spring Transaction 테스트"></a>Spring Transaction 테스트</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AppSetup</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> bookRepository: BookRepository</span><br><span class="line">) : ApplicationRunner &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">(args: <span class="type">ApplicationArguments</span>)</span></span> &#123;</span><br><span class="line">        bookRepository.saveAll(</span><br><span class="line">            (<span class="number">1.</span><span class="number">.5</span>).map &#123; Book(title = <span class="string">&quot;INIT&quot;</span>) &#125;</span><br><span class="line">                .toList()</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Application이 실행될 때 title이 <code>INIT</code>으로 데이터를 5개를 생성하는 코드를 추가했습니다. 각 메서드마다 <code>readOnly</code> 설정을 다루게 두고 업데이트 작업을 진행하게 됩니다.</p>
<h3 id="조회-이후-업데이트"><a href="#조회-이후-업데이트" class="headerlink" title="조회 이후 업데이트"></a>조회 이후 업데이트</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(<span class="string">&quot;/api/book&quot;</span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookApi</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> bookRepository: BookRepository,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> bookService: BookService</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(<span class="string">&quot;/update/slave&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">startSlave</span><span class="params">()</span></span> &#123;</span><br><span class="line">        bookService.updateSlave()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookService</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> bookRepository: BookRepository</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">updateSlave</span><span class="params">()</span></span> &#123;</span><br><span class="line">        updateTitle(<span class="string">&quot;new title(slave)&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(readOnly = false)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">updateMaster</span><span class="params">()</span></span> &#123;</span><br><span class="line">        updateTitle(<span class="string">&quot;new title(master)&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(readOnly = false)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">updateTitle</span><span class="params">(title: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> books = bookRepository.findAll()</span><br><span class="line">        <span class="keyword">for</span> (book <span class="keyword">in</span> books) &#123;</span><br><span class="line">            book.title = title</span><br><span class="line">        &#125;</span><br><span class="line">        bookRepository.saveAll(books)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>updateSlave()</code> 메서드는 <code>readOnly = true</code> 시작하고, <code>updateTitle()</code> 메서드에서 <code>readOnly = false</code>로 진행</li>
<li><code>updateMaster()</code> 메서드는 <code>readOnly = false</code> 시작하고, <code>updateTitle()</code> 메서드에서 <code>readOnly = false</code>로 진행</li>
</ul>
<h4 id="slave-조회-이후-업데이트"><a href="#slave-조회-이후-업데이트" class="headerlink" title="slave 조회 이후 업데이트"></a>slave 조회 이후 업데이트</h4><p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/spring-transaction/docs/query-log-update-in-slave.png"></p>
<p>select query가 slave에서 진행된 것을 확인할 수 있습니다. 조회는 <code>readOnly = true</code> 설정이지만 title를 업데이트할 때는 <code>readOnly = false</code>이기 때문에 영속성 컨텍스트가 flush를 진행하면 해당 내용이 데이터베이스에 반영될 까요? 확인해 보겠습니다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">GET http://localhost:8080/api/book/master</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 </span><br><span class="line">Content-Type: application/json</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Date: Thu, 06 May 2021 13:53:28 GMT</span><br><span class="line">Keep-Alive: timeout=60</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;title&quot;: &quot;INIT&quot;,</span><br><span class="line">    &quot;id&quot;: 1,</span><br><span class="line">    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,</span><br><span class="line">    &quot;updatedAt&quot;: &quot;2021-05-06T22:42:33&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;title&quot;: &quot;INIT&quot;,</span><br><span class="line">    &quot;id&quot;: 2,</span><br><span class="line">    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,</span><br><span class="line">    &quot;updatedAt&quot;: &quot;2021-05-06T22:42:33&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;title&quot;: &quot;INIT&quot;,</span><br><span class="line">    &quot;id&quot;: 3,</span><br><span class="line">    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,</span><br><span class="line">    &quot;updatedAt&quot;: &quot;2021-05-06T22:42:33&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;title&quot;: &quot;INIT&quot;,</span><br><span class="line">    &quot;id&quot;: 4,</span><br><span class="line">    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,</span><br><span class="line">    &quot;updatedAt&quot;: &quot;2021-05-06T22:42:33&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;title&quot;: &quot;INIT&quot;,</span><br><span class="line">    &quot;id&quot;: 5,</span><br><span class="line">    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,</span><br><span class="line">    &quot;updatedAt&quot;: &quot;2021-05-06T22:42:33&quot;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">Response code: 200; Time: 31ms; Content length: 461 bytes</span><br></pre></td></tr></table></figure>
<p>결과는 변경되지 않았습니다.</p>
<h4 id="master-조회-이후-업데이트"><a href="#master-조회-이후-업데이트" class="headerlink" title="master 조회 이후 업데이트"></a>master 조회 이후 업데이트</h4><p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/spring-transaction/docs/master-update-result.png"></p>
<p>select, update query가 master에서 진행된 것을 확인할 수 있습니다. 마찬가지로 API를 호출해서 결과를 확인해 보겠습니다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">GET http://localhost:8080/api/book/master</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 </span><br><span class="line">Content-Type: application/json</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Date: Thu, 06 May 2021 14:01:40 GMT</span><br><span class="line">Keep-Alive: timeout=60</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;title&quot;: &quot;new title(master)&quot;,</span><br><span class="line">    &quot;id&quot;: 1,</span><br><span class="line">    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,</span><br><span class="line">    &quot;updatedAt&quot;: &quot;2021-05-06T22:59:06&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;title&quot;: &quot;new title(master)&quot;,</span><br><span class="line">    &quot;id&quot;: 2,</span><br><span class="line">    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,</span><br><span class="line">    &quot;updatedAt&quot;: &quot;2021-05-06T22:59:06&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;title&quot;: &quot;new title(master)&quot;,</span><br><span class="line">    &quot;id&quot;: 3,</span><br><span class="line">    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,</span><br><span class="line">    &quot;updatedAt&quot;: &quot;2021-05-06T22:59:06&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;title&quot;: &quot;new title(master)&quot;,</span><br><span class="line">    &quot;id&quot;: 4,</span><br><span class="line">    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,</span><br><span class="line">    &quot;updatedAt&quot;: &quot;2021-05-06T22:59:06&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;title&quot;: &quot;new title(master)&quot;,</span><br><span class="line">    &quot;id&quot;: 5,</span><br><span class="line">    &quot;createdAt&quot;: &quot;2021-05-06T22:42:33&quot;,</span><br><span class="line">    &quot;updatedAt&quot;: &quot;2021-05-06T22:59:06&quot;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">Response code: 200; Time: 51ms; Content length: 526 bytes</span><br></pre></td></tr></table></figure>
<p>정상적으로 title이 변경된 것을 확인할 수 있습니다.</p>
<h4 id="다른-트랜잭션에서-Update"><a href="#다른-트랜잭션에서-Update" class="headerlink" title="다른 트랜잭션에서 Update"></a>다른 트랜잭션에서 Update</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookService</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> bookRepository: BookRepository</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">updateSlave</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;updateSlave CurrentTransactionName: <span class="subst">$&#123;TransactionSynchronizationManager.getCurrentTransactionName()&#125;</span>&quot;</span>)</span><br><span class="line">        bookUpdateService.updateTitle(<span class="string">&quot;new title(slave)&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookUpdateService</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> bookRepository: BookRepository</span><br><span class="line">)&#123;</span><br><span class="line">    <span class="meta">@Transactional(readOnly = false, propagation = Propagation.REQUIRES_NEW)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">updateTitle</span><span class="params">(title: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;updateTitle CurrentTransactionName: <span class="subst">$&#123;TransactionSynchronizationManager.getCurrentTransactionName()&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">val</span> books = bookRepository.findAll()</span><br><span class="line">        <span class="keyword">for</span> (book <span class="keyword">in</span> books) &#123;</span><br><span class="line">            book.title = title</span><br><span class="line">        &#125;</span><br><span class="line">        bookRepository.saveAll(books)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>BookUpdateService 클래스를 만들고 <code>updateTitle</code> 메서드를 해당 클래스에서 <code>propagation = Propagation.REQUIRES_NEW</code> 설정을 통해서 새로운 트랜잭션에서 처리하도록 작성하고 <code>/api/book/update/slave</code>를 호출하고 조회 API를 호출해서 결과를 확인해 보겠습니다.</p>
<p>기존 서비스 코드에서 구현을 하지 않고 BookUpdateService 서비스 코드를 만든 이유는 동일한 Bean에서 <code>@Transactional</code>예상하는 것과 다르게 동작하기 때문입니다. 자세한 내용은 이전 동일한 <a href="https://cheese10yun.github.io/spring-transacion-same-bean/">Bean(Class)에서 @Transactional 동작 방식</a>을 참고해 주세요</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET http://localhost:8080/api/book/slave</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 </span><br><span class="line">Content-Type: application/json</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Date: Sat, 08 May 2021 12:38:56 GMT</span><br><span class="line">Keep-Alive: timeout=60</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;title&quot;: &quot;new title(slave)&quot;,</span><br><span class="line">    &quot;id&quot;: 1,</span><br><span class="line">    &quot;createdAt&quot;: &quot;2021-05-08T21:37:43&quot;,</span><br><span class="line">    &quot;updatedAt&quot;: &quot;2021-05-08T21:38:44&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">Response code: 200; Time: 107ms; Content length: 521 bytes</span><br></pre></td></tr></table></figure>
<p>새로운 트랜잭션의 경우 <code>masterDataSource</code>를 바라보게 되며 데이터베이스에 반영되는것을 확인할 수 있습니다.</p>
<p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/spring-transaction/docs/transaction-name.png"></p>
<p>트랜잭션 이름을 봐도 해당 트랜잭션이 다르다는 것을 확인할 수 있습니다. 즉 <code>com.example.springtransaction.BookService.updateSlave</code> 트랜잭션은 <code>salveDataSoruce</code>, <code>com.example.springtransaction.BookUpdateService.updateTitle</code>는 <code>masterDataSource</code>를 바라봅니다.</p>
<h2 id="그렇다면-왜-그런것일까"><a href="#그렇다면-왜-그런것일까" class="headerlink" title="그렇다면 왜 그런것일까?"></a>그렇다면 왜 그런것일까?</h2><p><strong>첫 트랜잭션의 설정의 <code>readOnly</code>에 따라 <code>salveDataSoruce</code>, <code>masterDataSource</code>가 결정되며, 동일한 트랜잭션에서는 지정된 <code>readOnly</code> 속성은 변경되지 않습니다.</strong> 기존 트랜잭션과 전혀 다른 트랜잭션을 만나게 되면 해당 트랜잭션의 <code>readOnly</code>설정에 따라 <code>DataSource</code>가 결정됩니다. 그렇다면 왜 이렇게 되는 걸까요? <strong>제가 학습했던 내용을 토대로 설명드리기 때문에 틀린 부분이 있을 수도 있습니다.</strong></p>
<h3 id="스프링의-트랜잭션-동기화"><a href="#스프링의-트랜잭션-동기화" class="headerlink" title="스프링의 트랜잭션 동기화"></a>스프링의 트랜잭션 동기화</h3><blockquote>
<p><img src="https://raw.githubusercontent.com/cheese10yun/TIL/master/assets/TransactionSynchronizations.png"><br><a target="_blank" rel="noopener" href="http://m.yes24.com/goods/detail/7516911">토비의 스프링 3.1, 361 페이지</a></p>
</blockquote>
<p>스프링은 위와 같은 방식으로 트랜잭션 동기화를 진행합니다. 해당 방식은 트랜잭션을 시작하기 위해 만든 Connection 오브젝트를 특별한 저장소에 보관해두고, 이후에 호출되는 메서드에서 저장된 Connection을 가져다가 사용합니다.</p>
<ul>
<li><code>(1)</code> Userservice Connection을 생성</li>
<li><code>(2)</code> 생성된 Connection을 트랜잭션 동기화 저장소에 저장, SetAutoCommit(false)를 호출하여 트랜잭션을 시작</li>
<li><code>(3)</code> 첫 번째 <code>update()</code> 메서드가 호출되고 <strong><code>(4)</code> 트랜잭션 동기화 저장소에 현재 시작된 트랜잭션을 가진 Connection을 확인합니다. 이 경우는<code>(2)</code>에서 생성한 Connection을 가져옵니다.</strong></li>
<li><code>(5)</code> Connection을 이용해 PreparedsStatment을 만들어 해당 SQL을 실행하고 <strong>JdbcTemplated는 Connection 닫지 않은 상태로 작업을 마침</strong></li>
<li>동일한 플로우로 <code>(6)</code>, <code>(7)</code>, <code>(8)</code> 수행</li>
<li>또 동일한 플로우로 <code>(9)</code>, <code>(10)</code>, <code>(11)</code> 수행하며 <strong>트랜잭션 내의 모든 작업이 정상적으로 끝났으면 <code>(12)</code> Conntion commit을 호출해 트랜잭션을 완료</strong></li>
<li><code>(13)</code> 트랜잭션 저장소가 더 이상 Connection 객체를 저장하지 않도록 이를 제거</li>
</ul>
<p>위와 같은 플로우로 트랜잭션이 진행됩니다.</p>
<blockquote>
<p><code>updateSlave()</code> 메서드는 <code>readOnly = true</code> 시작하고, <code>updateTitle()</code> 메서드에서 <code>readOnly = false</code>로 진행 되는 경우</p>
</blockquote>
<p>이런 경우에는 <code>updateSlave()</code>에서 Connection(Slave)을 생성 하고 <strong><code>updateTitle()</code>에서 트랜잭션 동기화 저장소에 저장된 트랜잭션을 가진 Connection(Slave) 기반으로 트랜잭션을 시작하게 됩니다.</strong> 그러기 때문에 <code>updateTitle()</code> 메서드의 트랜잭션 <code>readOnly = false</code> 설정은 동작하지 않게 됩니다.</p>
<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><ul>
<li><a target="_blank" rel="noopener" href="http://www.yes24.com/Product/Goods/72270172">MySQL 5.7 완벽 분석</a></li>
<li><a target="_blank" rel="noopener" href="https://taes-k.github.io/2020/03/11/sprinig-master-slave-dynamic-routing-datasource/">Spring, master-slave dynamic routing datasource 사용하기</a></li>
<li><a target="_blank" rel="noopener" href="http://m.yes24.com/goods/detail/7516911">토비의 스프링 3.1</a></li>
</ul>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">태그</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/Spring/" rel="tag">Spring</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Transaction/" rel="tag">Transaction</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/exposed/"
                    data-tooltip="Kotlin 기반 경량 ORM Exposed"
                    aria-label="이전: Kotlin 기반 경량 ORM Exposed"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/spring-kotlin/"
                    data-tooltip="Kotlin으로 Spring 개발할 때"
                    aria-label="다음: Kotlin으로 Spring 개발할 때"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-transaction/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-transaction/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://cheese10yun.github.io/spring-transaction/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>


<!-- Comment -->
<!--  utteranc comment -->

<script src="https://utteranc.es/client.js"
        repo="cheese10yun/blog-comment"
        issue-term="title"
        label="Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Yun. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/exposed/"
                    data-tooltip="Kotlin 기반 경량 ORM Exposed"
                    aria-label="이전: Kotlin 기반 경량 ORM Exposed"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/spring-kotlin/"
                    data-tooltip="Kotlin으로 Spring 개발할 때"
                    aria-label="다음: Kotlin으로 Spring 개발할 때"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-transaction/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-transaction/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://cheese10yun.github.io/spring-transaction/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-transaction/"
                        aria-label="Facebook에 공유하기"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Facebook에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-transaction/"
                        aria-label="Twitter에 공유하기"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Twitter에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://cheese10yun.github.io/spring-transaction/"
                        aria-label="Google+에 공유하기"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Google+에 공유하기</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
            <h4 id="about-card-name">Yun</h4>
        
            <div id="about-card-bio"><p>기술 블로그</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
