
<!DOCTYPE html>
<html lang="ko">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Yun Blog">
    <title>Kotlin 기반 경량 ORM Exposed 추가 정리 part 1 - Yun Blog</title>
    <meta name="author" content="Yun">
    
        <meta name="keywords" content="Node,Spring,Spring Boot,Spring Batch,Kotlin,기술 블로그,JPA,Mongo,MySQL,OOP,">
    
    
    
        
            <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss2.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg"},"articleBody":"Exposed 포스팅\nKotlin 기반 경량 ORM Exposed\nKotlin 기반 경량 ORM Exposed 추가 정리 part 2\nKotlin 기반 경량 ORM Exposed 추가 정리 part 3\n\n실제 자주 사용하는 기능들 위주로 다루어 보겠습니다.\nTable Object123456789101112131415object Writers : LongIdTable(&quot;writer&quot;) &#123;    val name = varchar(&quot;name&quot;, 150)    val email = varchar(&quot;email&quot;, 150)    val createdAt = datetime(&quot;created_at&quot;).clientDefault &#123; LocalDateTime.now() &#125;    val updatedAt = datetime(&quot;updated_at&quot;).clientDefault &#123; LocalDateTime.now() &#125;&#125;object Books : LongIdTable(&quot;book&quot;) &#123;    val writer = reference(&quot;writer_id&quot;, Writers)    val title = varchar(&quot;title&quot;, 150)    val status = enumerationByName(&quot;status&quot;, 150, BookStatus::class)    val price = decimal(&quot;price&quot;, 10, 4)    val createdAt = datetime(&quot;created_at&quot;).clientDefault &#123; LocalDateTime.now() &#125;    val updatedAt = datetime(&quot;updated_at&quot;).clientDefault &#123; LocalDateTime.now() &#125;&#125;\n\nTable Object는 이전 포스팅 Exposed: 경량 ORM에서 소개한 적 있어서 중복되는 설명은 진행하지 않고 없는 기능에 대해서 이야기해 보겠습니다.\nclientDefault 기능clientDefault는 클라이언트에서 default 값을 지정할 수 있는 기능입니다. created_at, updated_at과 같은 기본 생성 날짜 같은 칼럼에 사용할 때 유용합니다.\n12345678910111213141516171819class ExposedTest : ExposedTestSupport() &#123;        @Test    fun `writer insert`() &#123;        val connect = Database.connect(dataSource)        transaction(connect) &#123;            //given            // SQL Qury INSERT INTO writer (created_at, email, `name`, updated_at) VALUES (&#x27;2022-05-29T19:46:46.845358&#x27;, &#x27;asd@asd.com&#x27;, &#x27;name&#x27;, &#x27;2022-05-29T19:46:46.845382&#x27;)            val insert = Writers.insert &#123; writer -&gt;                writer[this.name] = &quot;name&quot;                writer[this.email] = &quot;asd@asd.com&quot;            &#125;            //when            then(Writers.createdAt).isNotNull // 2022-05-29T19:46:46.845358            then(Writers.updatedAt).isNotNull // 2022-05-29T19:46:46.845382        &#125;    &#125;&#125;\n\nupdatedAt, createdAt을 값을 insert에서 지정하지 않았지만 clientDefault를 통해서 자동으로 값을 지정되는 것을 확인할 수 있습니다.\n123456789101112131415161718192021222324252627class ExposedTest : ExposedTestSupport() &#123;        @Test    fun `writer updatedAt test`() &#123;        val connect = Database.connect(dataSource)        transaction(connect) &#123;            //given            val insert = Writers.insert &#123; writer -&gt;                writer[this.name] = &quot;name&quot;                writer[this.email] = &quot;asd@asd.com&quot;             &#125;            //when            val id = insert[Writers.id]            // SQL Qury UPDATE writer SET email=&#x27;new@asd.com&#x27;, updated_at=&#x27;2022-05-29T20:08:48.411516&#x27; WHERE writer.id = 27            Writers.update(&#123; Writers.id eq id &#125;)            &#123;                it[this.email] = &quot;new@asd.com&quot;                it[this.updatedAt] = LocalDateTime.now() // 해당 코드가 없는 경우 아래 then 실패            &#125;                        //then            val findWriter = Writers.select(Writers.id eq id).first()            then(insert[Writers.updatedAt]).isNotEqualTo(findWriter[Writers.updatedAt])        &#125;    &#125;&#125;\n\nclientDefault는 생성 시에만 동작하고 업데이트에서는 동작하지 않습니다. 위 업데이트에서 it[this.updatedAt]를 지정하지 않는 경우에는 테스트가 실패하게 됩니다. 즉 칼럼 업데이트는 수기로 진행해야 합니다. 다음은 DAO 방식입니다. JPA로 비교했을 때는 엔티티 방식에 해당합니다.\n1234567891011121314151617181920212223242526272829303132333435363738394041424344class Writer(id: EntityID&lt;Long&gt;) : LongEntity(id) &#123;    companion object : LongEntityClass&lt;Writer&gt;(Writers)    var name by Writers.name    var email by Writers.email    var createdAt by Writers.createdAt    var updatedAt by Writers.updatedAt&#125;class ExposedTest : ExposedTestSupport() &#123;        @Test    fun `writer `() &#123;        val connect = Database.connect(dataSource)        lateinit var id: EntityID&lt;Long&gt;        lateinit var initUpdatedAt: LocalDateTime        transaction(connect) &#123;            //given            val writer = Writer.new &#123;                instance(                    name = &quot;22222&quot;,                    email = &quot;asd@asd&quot;                )            &#125;            id = writer.id            initUpdatedAt = writer.updatedAt        &#125;        transaction(connect) &#123;            //given            // SQL Query UPDATE writer SET email=&#x27;new@sd.com&#x27;, `name`=&#x27;new&#x27;, updated_at=&#x27;2022-05-29T21:00:45.562978&#x27; WHERE id = 36            val findWriter = Writer.findById(id)!!            findWriter.name = &quot;new&quot;            findWriter.email = &quot;new@sd.com&quot;            findWriter.updatedAt = LocalDateTime.now() // 주석시 아래 검증 실패        &#125;        transaction(connect) &#123;            //given            val findWriter = Writer.findById(id)!!            then(initUpdatedAt).isNotEqualTo(findWriter.updatedAt)        &#125;    &#125;&#125;\nDAO 방식도 DSL 방식과 마찬가지로 업데이트를 명시하지 않으면 동작하지 않습니다.\nenumerationByNameEnum 타입에 해당하는 칼럼의 경우 enumerationByName을 사용하면 편리하게 바인딩 가능합니다. 혹시 단순 문자열이 아닌 순번 타입의 경우는 enumeration을 사용하면 됩니다.\n1234567891011121314151617181920212223242526object Books : LongIdTable(&quot;book&quot;) &#123;    val writer = reference(&quot;writer_id&quot;, Writers)    val title = varchar(&quot;title&quot;, 150)    val status = enumerationByName(&quot;status&quot;, 150, BookStatus::class)    val price = decimal(&quot;price&quot;, 10, 4)    val createdAt = datetime(&quot;created_at&quot;).clientDefault &#123; LocalDateTime.now() &#125;    val updatedAt = datetime(&quot;updated_at&quot;).clientDefault &#123; LocalDateTime.now() &#125;&#125;class ExposedTest : ExposedTestSupport() &#123;    @Test    fun `book insert`() &#123;        // SQL Log INSERT INTO book (created_at, price, status, title, updated_at, writer_id) VALUES (&#x27;2022-05-29T21:12:27.464364&#x27;, 1000, &#x27;NONE&#x27;, &#x27;test&#x27;, &#x27;2022-05-29T21:12:27.464374&#x27;, 37)        val book = Books.insert &#123; book -&gt;            book[this.writer] = insertWriter(&quot;asd&quot;, &quot;asd&quot;)[Writers.id]            book[this.title] = &quot;test&quot;            book[this.price] = 1000.toBigDecimal()            book[this.status] = BookStatus.NONE            book[this.createdAt] = LocalDateTime.now()            book[this.updatedAt] = LocalDateTime.now()        &#125;        then(book[Books.status]).isEqualTo(BookStatus.NONE)    &#125;&#125;\n저장 같은 경우는 Enum 객체를 그대로 사용하면 되고 가져오는 것도 동일합니다.\n연관관계 객체 매핑 없는 경우 조인123456789101112131415161718192021fun `연관관계 객체 잠조 조인`() &#123;    val writerId = insertWriter(&quot;yun&quot;, &quot;yun@asd.com&quot;)[Writers.id].value    (1..5).map &#123;        insertBook(&quot;$it-title&quot;, BigDecimal.TEN, writerId)    &#125;    // SELECT book.id, book.title, book.price, writer.`name`, writer.email FROM book INNER JOIN writer ON writer.id = book.writer_id    (Books innerJoin Writers)        .slice(            Books.id,            Books.title,            Books.price,            Writers.name,            Writers.email,        )        .selectAll()        .forEach &#123;            it.fieldIndex            println(&quot;bookId: $&#123;it[Books.id]&#125;, title: $&#123;it[Books.title]&#125;, writerName: $&#123;it[Writers.name]&#125;, writerEmail: $&#123;it[Writers.email]&#125;&quot;)        &#125;&#125;\n연관관계를 객체 기반으로 설정한 경우 위 코드처럼 어렵지 않게 조인을 진행할 수 있습니다. 하지만 객체 연관관계를 설정하지 않는 경우에는 위처럼 조인을 진행할 수 없고 아래와 같은 방법으로 진행해야 합니다.\n123456object Publishers: LongIdTable(&quot;publisher&quot;) &#123;    val writerId = long(&quot;writer_id&quot;)    val corpName = varchar(&quot;corp_name&quot;, 150)    val createdAt = datetime(&quot;created_at&quot;).clientDefault &#123; LocalDateTime.now() &#125;    val updatedAt = datetime(&quot;updated_at&quot;).clientDefault &#123; LocalDateTime.now() &#125;&#125;\n\n연관관계를 객체 기반으로 하는 것이 아니라 단순 long type으로 지정하여 테이블 객체를 선언합니다. JPA에서도 연관관계 탐색의 오용을 경계하는 것처럼 Exposed에서도 동일하게 무리한 객체 연결은 지양하는 것이 바람직하다고 생각합니다.\n123456789101112131415161718192021222324252627282930313233343536class ExposedTest : ExposedTestSupport() &#123;    @Test    fun `연관관계 없는 조인`() &#123;        val connect = Database.connect(dataSource)        transaction(connect) &#123;            val writer = Writers.insert &#123;                it[this.name] = &quot;name&quot;                it[this.email] = &quot;name@add.cpm&quot;            &#125;            val publisher = Publishers.insert &#123;                it[this.writerId] = writer[Writers.id].value                it[this.corpName] = &quot;corp name&quot;            &#125;            Publishers                .join(                    otherTable = Writers, // (1)                    joinType = JoinType.LEFT, // (2)                    additionalConstraint = &#123; // (3)                        Publishers.writerId eq Writers.id                    &#125;                )                .select &#123;                    Publishers.id eq publisher[Publishers.id].value                &#125;                .forEach &#123;                    println(&quot;Publishers.id : $&#123;it[Publishers.id]&#125;&quot;)                    println(&quot;Publishers.corpName : $&#123;it[Publishers.corpName]&#125;&quot;)                    println(&quot;Publishers.writerId : $&#123;it[Publishers.writerId]&#125;&quot;)                    println(&quot;Writers.id : $&#123;it[Writers.id]&#125;&quot;)                    println(&quot;Writers.name : $&#123;it[Writers.name]&#125;&quot;)                    println(&quot;Writers.email : $&#123;it[Writers.email]&#125;&quot;)                &#125;        &#125;    &#125;&#125;\n\n\n(1): 조인할 대상 객체를 지정합니다.\n(2): 조인 타입을 지정합니다.\n(3): 조인 대상의 조건으로 on 절에 해당합니다.\n\n12345678910111213SELECT publisher.id,       publisher.writer_id,       publisher.corp_name,       publisher.created_at,       publisher.updated_at,       writer.id,       writer.`name`,       writer.email,       writer.created_at,       writer.updated_atFROM publisher         LEFT JOIN writer ON (publisher.writer_id = writer.id)WHERE publisher.id = 4\n\n실제 원하는 방식으로 조인이 진행되는 것을 확인할 수 있습니다.\n특정 조건에 따라 join을 해야 하는 경우가 있습니다. 예를 들어 특정 조건에 만족하는 경우 필요 테이블에 조인을 하여 필요 데이터를 가져오는 경우 Exposed에서는 다음과 같이 진행할 수 있습니다.\n12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758class ExposedTest : ExposedTestSupport() &#123;    @Test    fun `연관관계 없는 조인2`() &#123;        val connect = Database.connect(dataSource)        transaction(connect) &#123;            val writer = Writers.insert &#123;                it[this.name] = &quot;name&quot;                it[this.email] = &quot;name@add.cpm&quot;            &#125;            val publisher = Publishers.insert &#123;                it[this.writerId] = writer[Writers.id].value                it[this.corpName] = &quot;corp name&quot;            &#125;            val needJoin = true // (1)             Publishers                .slice(                    Publishers.id,                    Publishers.corpName,                    Publishers.writerId                )                .select &#123;                    Publishers.id eq publisher[Publishers.id].value                &#125;                .apply &#123;                    // (2)                    if (needJoin) &#123;                        this.adjustColumnSet &#123;                            join(                                otherTable = Writers,                                joinType = JoinType.LEFT,                                additionalConstraint = &#123;                                    Publishers.writerId eq Writers.id                                &#125;                            )                        &#125;                        this.adjustSlice &#123;                            // (3)                            slice(it.fields + Writers.id + Writers.name + Writers.email)                        &#125;                    &#125;                &#125;                .forEach &#123;                    println(&quot;Publishers.id : $&#123;it[Publishers.id]&#125;&quot;)                    println(&quot;Publishers.corpName : $&#123;it[Publishers.corpName]&#125;&quot;)                    println(&quot;Publishers.writerId : $&#123;it[Publishers.writerId]&#125;&quot;)                    if (needJoin) &#123;                        println(&quot;Writers.id : $&#123;it[Writers.id]&#125;&quot;)                        println(&quot;Writers.name : $&#123;it[Writers.name]&#125;&quot;)                        println(&quot;Writers.email : $&#123;it[Writers.email]&#125;&quot;)                    &#125;                &#125;        &#125;    &#125;&#125;\n\n(1): 특정 조건에 따라 조인 여부를 결정하는 분기 값\n(2): 조건에 만족하는 경우 조인을 진행\n(3): 조인을 진행한 경우 추가 적으로 필요한 칼럼을 추가\n\n1234567891011121314151617# needJoin = false 경우SELECT publisher.id,       publisher.corp_name,       publisher.writer_idFROM publisherWHERE publisher.id = 7;# needJoin = true 경우SELECT publisher.id,       publisher.corp_name,       publisher.writer_id,       writer.id,       writer.`name`,       writer.emailFROM publisher         LEFT JOIN writer ON (publisher.writer_id = writer.id)WHERE publisher.id = 8\nneedJoin 분기에 따라 쿼리문이 달라지는 것을 확인할 수 있습니다.\n참고\nExposed Wiki\n\n","dateCreated":"2022-05-30T00:00:00+09:00","dateModified":"2025-01-31T04:44:52+09:00","datePublished":"2022-05-30T00:00:00+09:00","description":"실제 자주 사용하는 기능들 위주로 다루어 보겠습니다.","headline":"Kotlin 기반 경량 ORM Exposed 추가 정리 part 1","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://cheese10yun.github.io/2022/05/30/exposed-2/"},"publisher":{"@type":"Organization","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg","logo":{"@type":"ImageObject","url":"yun-icon.jpg"}},"url":"https://cheese10yun.github.io/2022/05/30/exposed-2/","keywords":"ORM, Kotlin, Exposed"}</script>
    <meta name="description" content="실제 자주 사용하는 기능들 위주로 다루어 보겠습니다.">
<meta property="og:type" content="blog">
<meta property="og:title" content="Kotlin 기반 경량 ORM Exposed 추가 정리 part 1">
<meta property="og:url" content="https://cheese10yun.github.io/2022/05/30/exposed-2/index.html">
<meta property="og:site_name" content="Yun Blog">
<meta property="og:description" content="실제 자주 사용하는 기능들 위주로 다루어 보겠습니다.">
<meta property="og:locale" content="ko_KR">
<meta property="article:published_time" content="2022-05-29T15:00:00.000Z">
<meta property="article:modified_time" content="2025-01-30T19:44:52.003Z">
<meta property="article:author" content="Yun">
<meta property="article:tag" content="ORM">
<meta property="article:tag" content="Kotlin">
<meta property="article:tag" content="Exposed">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="https://cheese10yun.github.io/assets/images/yun-icon.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90907312-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90907312-1');
    </script>


    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Yun Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="링크 열기: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="저자에 대해 더 알아보기"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
                </a>
                <h4 class="sidebar-profile-name">Yun</h4>
                
                    <h5 class="sidebar-profile-bio"><p>기술 블로그</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="카테고리"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">카테고리</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="태그"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">태그</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="아카이브"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">아카이브</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="검색"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">검색</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/cheese10yun"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/rss2.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Kotlin 기반 경량 ORM Exposed 추가 정리 part 1
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2022-05-30T00:00:00+09:00">
	
		    2022/05/30
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <h2 id="Exposed-포스팅"><a href="#Exposed-포스팅" class="headerlink" title="Exposed 포스팅"></a>Exposed 포스팅</h2><ul>
<li><a href="https://cheese10yun.github.io/exposed/">Kotlin 기반 경량 ORM Exposed</a></li>
<li><a href="https://cheese10yun.github.io/exposed-2/">Kotlin 기반 경량 ORM Exposed 추가 정리 part 2</a></li>
<li><a href="https://cheese10yun.github.io/exposed-3/">Kotlin 기반 경량 ORM Exposed 추가 정리 part 3</a></li>
</ul>
<p>실제 자주 사용하는 기능들 위주로 다루어 보겠습니다.</p>
<h2 id="Table-Object"><a href="#Table-Object" class="headerlink" title="Table Object"></a>Table Object</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> Writers : LongIdTable(<span class="string">&quot;writer&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> name = varchar(<span class="string">&quot;name&quot;</span>, <span class="number">150</span>)</span><br><span class="line">    <span class="keyword">val</span> email = varchar(<span class="string">&quot;email&quot;</span>, <span class="number">150</span>)</span><br><span class="line">    <span class="keyword">val</span> createdAt = datetime(<span class="string">&quot;created_at&quot;</span>).clientDefault &#123; LocalDateTime.now() &#125;</span><br><span class="line">    <span class="keyword">val</span> updatedAt = datetime(<span class="string">&quot;updated_at&quot;</span>).clientDefault &#123; LocalDateTime.now() &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> Books : LongIdTable(<span class="string">&quot;book&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> writer = reference(<span class="string">&quot;writer_id&quot;</span>, Writers)</span><br><span class="line">    <span class="keyword">val</span> title = varchar(<span class="string">&quot;title&quot;</span>, <span class="number">150</span>)</span><br><span class="line">    <span class="keyword">val</span> status = enumerationByName(<span class="string">&quot;status&quot;</span>, <span class="number">150</span>, BookStatus::<span class="keyword">class</span>)</span><br><span class="line">    <span class="keyword">val</span> price = decimal(<span class="string">&quot;price&quot;</span>, <span class="number">10</span>, <span class="number">4</span>)</span><br><span class="line">    <span class="keyword">val</span> createdAt = datetime(<span class="string">&quot;created_at&quot;</span>).clientDefault &#123; LocalDateTime.now() &#125;</span><br><span class="line">    <span class="keyword">val</span> updatedAt = datetime(<span class="string">&quot;updated_at&quot;</span>).clientDefault &#123; LocalDateTime.now() &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Table Object는 이전 포스팅 <a href="https://cheese10yun.github.io/exposed/">Exposed: 경량 ORM</a>에서 소개한 적 있어서 중복되는 설명은 진행하지 않고 없는 기능에 대해서 이야기해 보겠습니다.</p>
<h2 id="clientDefault-기능"><a href="#clientDefault-기능" class="headerlink" title="clientDefault 기능"></a>clientDefault 기능</h2><p>clientDefault는 클라이언트에서 default 값을 지정할 수 있는 기능입니다. created_at, updated_at과 같은 기본 생성 날짜 같은 칼럼에 사용할 때 유용합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExposedTest</span> : <span class="type">ExposedTestSupport</span>() &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `writer insert`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> connect = Database.connect(dataSource)</span><br><span class="line">        transaction(connect) &#123;</span><br><span class="line">            <span class="comment">//given</span></span><br><span class="line">            <span class="comment">// SQL Qury INSERT INTO writer (created_at, email, `name`, updated_at) VALUES (&#x27;2022-05-29T19:46:46.845358&#x27;, &#x27;asd@asd.com&#x27;, &#x27;name&#x27;, &#x27;2022-05-29T19:46:46.845382&#x27;)</span></span><br><span class="line">            <span class="keyword">val</span> insert = Writers.insert &#123; writer -&gt;</span><br><span class="line">                writer[<span class="keyword">this</span>.name] = <span class="string">&quot;name&quot;</span></span><br><span class="line">                writer[<span class="keyword">this</span>.email] = <span class="string">&quot;asd@asd.com&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//when</span></span><br><span class="line">            then(Writers.createdAt).isNotNull <span class="comment">// 2022-05-29T19:46:46.845358</span></span><br><span class="line">            then(Writers.updatedAt).isNotNull <span class="comment">// 2022-05-29T19:46:46.845382</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>updatedAt, createdAt을 값을 insert에서 지정하지 않았지만 clientDefault를 통해서 자동으로 값을 지정되는 것을 확인할 수 있습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExposedTest</span> : <span class="type">ExposedTestSupport</span>() &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `writer updatedAt test`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> connect = Database.connect(dataSource)</span><br><span class="line">        transaction(connect) &#123;</span><br><span class="line">            <span class="comment">//given</span></span><br><span class="line">            <span class="keyword">val</span> insert = Writers.insert &#123; writer -&gt;</span><br><span class="line">                writer[<span class="keyword">this</span>.name] = <span class="string">&quot;name&quot;</span></span><br><span class="line">                writer[<span class="keyword">this</span>.email] = <span class="string">&quot;asd@asd.com&quot;</span> </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//when</span></span><br><span class="line">            <span class="keyword">val</span> id = insert[Writers.id]</span><br><span class="line">            <span class="comment">// SQL Qury UPDATE writer SET email=&#x27;new@asd.com&#x27;, updated_at=&#x27;2022-05-29T20:08:48.411516&#x27; WHERE writer.id = 27</span></span><br><span class="line">            Writers.update(&#123; Writers.id eq id &#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                it[<span class="keyword">this</span>.email] = <span class="string">&quot;new@asd.com&quot;</span></span><br><span class="line">                it[<span class="keyword">this</span>.updatedAt] = LocalDateTime.now() <span class="comment">// 해당 코드가 없는 경우 아래 then 실패</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//then</span></span><br><span class="line">            <span class="keyword">val</span> findWriter = Writers.select(Writers.id eq id).first()</span><br><span class="line">            then(insert[Writers.updatedAt]).isNotEqualTo(findWriter[Writers.updatedAt])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>clientDefault는 생성 시에만 동작하고 업데이트에서는 동작하지 않습니다. 위 업데이트에서 <code>it[this.updatedAt]</code>를 지정하지 않는 경우에는 테스트가 실패하게 됩니다. 즉 칼럼 업데이트는 수기로 진행해야 합니다. 다음은 DAO 방식입니다. JPA로 비교했을 때는 엔티티 방식에 해당합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Writer</span>(id: EntityID&lt;<span class="built_in">Long</span>&gt;) : LongEntity(id) &#123;</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> : LongEntityClass&lt;Writer&gt;(Writers)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> name <span class="keyword">by</span> Writers.name</span><br><span class="line">    <span class="keyword">var</span> email <span class="keyword">by</span> Writers.email</span><br><span class="line">    <span class="keyword">var</span> createdAt <span class="keyword">by</span> Writers.createdAt</span><br><span class="line">    <span class="keyword">var</span> updatedAt <span class="keyword">by</span> Writers.updatedAt</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExposedTest</span> : <span class="type">ExposedTestSupport</span>() &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `writer `<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> connect = Database.connect(dataSource)</span><br><span class="line">        <span class="keyword">lateinit</span> <span class="keyword">var</span> id: EntityID&lt;<span class="built_in">Long</span>&gt;</span><br><span class="line">        <span class="keyword">lateinit</span> <span class="keyword">var</span> initUpdatedAt: LocalDateTime</span><br><span class="line">        transaction(connect) &#123;</span><br><span class="line">            <span class="comment">//given</span></span><br><span class="line">            <span class="keyword">val</span> writer = Writer.new &#123;</span><br><span class="line">                instance(</span><br><span class="line">                    name = <span class="string">&quot;22222&quot;</span>,</span><br><span class="line">                    email = <span class="string">&quot;asd@asd&quot;</span></span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">            id = writer.id</span><br><span class="line">            initUpdatedAt = writer.updatedAt</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        transaction(connect) &#123;</span><br><span class="line">            <span class="comment">//given</span></span><br><span class="line">            <span class="comment">// SQL Query UPDATE writer SET email=&#x27;new@sd.com&#x27;, `name`=&#x27;new&#x27;, updated_at=&#x27;2022-05-29T21:00:45.562978&#x27; WHERE id = 36</span></span><br><span class="line">            <span class="keyword">val</span> findWriter = Writer.findById(id)!!</span><br><span class="line">            findWriter.name = <span class="string">&quot;new&quot;</span></span><br><span class="line">            findWriter.email = <span class="string">&quot;new@sd.com&quot;</span></span><br><span class="line">            findWriter.updatedAt = LocalDateTime.now() <span class="comment">// 주석시 아래 검증 실패</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        transaction(connect) &#123;</span><br><span class="line">            <span class="comment">//given</span></span><br><span class="line">            <span class="keyword">val</span> findWriter = Writer.findById(id)!!</span><br><span class="line">            then(initUpdatedAt).isNotEqualTo(findWriter.updatedAt)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DAO 방식도 DSL 방식과 마찬가지로 업데이트를 명시하지 않으면 동작하지 않습니다.</p>
<h2 id="enumerationByName"><a href="#enumerationByName" class="headerlink" title="enumerationByName"></a>enumerationByName</h2><p>Enum 타입에 해당하는 칼럼의 경우 enumerationByName을 사용하면 편리하게 바인딩 가능합니다. 혹시 단순 문자열이 아닌 순번 타입의 경우는 enumeration을 사용하면 됩니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> Books : LongIdTable(<span class="string">&quot;book&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> writer = reference(<span class="string">&quot;writer_id&quot;</span>, Writers)</span><br><span class="line">    <span class="keyword">val</span> title = varchar(<span class="string">&quot;title&quot;</span>, <span class="number">150</span>)</span><br><span class="line">    <span class="keyword">val</span> status = enumerationByName(<span class="string">&quot;status&quot;</span>, <span class="number">150</span>, BookStatus::<span class="keyword">class</span>)</span><br><span class="line">    <span class="keyword">val</span> price = decimal(<span class="string">&quot;price&quot;</span>, <span class="number">10</span>, <span class="number">4</span>)</span><br><span class="line">    <span class="keyword">val</span> createdAt = datetime(<span class="string">&quot;created_at&quot;</span>).clientDefault &#123; LocalDateTime.now() &#125;</span><br><span class="line">    <span class="keyword">val</span> updatedAt = datetime(<span class="string">&quot;updated_at&quot;</span>).clientDefault &#123; LocalDateTime.now() &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExposedTest</span> : <span class="type">ExposedTestSupport</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `book insert`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// SQL Log INSERT INTO book (created_at, price, status, title, updated_at, writer_id) VALUES (&#x27;2022-05-29T21:12:27.464364&#x27;, 1000, &#x27;NONE&#x27;, &#x27;test&#x27;, &#x27;2022-05-29T21:12:27.464374&#x27;, 37)</span></span><br><span class="line">        <span class="keyword">val</span> book = Books.insert &#123; book -&gt;</span><br><span class="line">            book[<span class="keyword">this</span>.writer] = insertWriter(<span class="string">&quot;asd&quot;</span>, <span class="string">&quot;asd&quot;</span>)[Writers.id]</span><br><span class="line">            book[<span class="keyword">this</span>.title] = <span class="string">&quot;test&quot;</span></span><br><span class="line">            book[<span class="keyword">this</span>.price] = <span class="number">1000.</span>toBigDecimal()</span><br><span class="line">            book[<span class="keyword">this</span>.status] = BookStatus.NONE</span><br><span class="line">            book[<span class="keyword">this</span>.createdAt] = LocalDateTime.now()</span><br><span class="line">            book[<span class="keyword">this</span>.updatedAt] = LocalDateTime.now()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        then(book[Books.status]).isEqualTo(BookStatus.NONE)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>저장 같은 경우는 Enum 객체를 그대로 사용하면 되고 가져오는 것도 동일합니다.</p>
<h2 id="연관관계-객체-매핑-없는-경우-조인"><a href="#연관관계-객체-매핑-없는-경우-조인" class="headerlink" title="연관관계 객체 매핑 없는 경우 조인"></a>연관관계 객체 매핑 없는 경우 조인</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> `연관관계 객체 잠조 조인`<span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> writerId = insertWriter(<span class="string">&quot;yun&quot;</span>, <span class="string">&quot;yun@asd.com&quot;</span>)[Writers.id].value</span><br><span class="line">    (<span class="number">1.</span><span class="number">.5</span>).map &#123;</span><br><span class="line">        insertBook(<span class="string">&quot;<span class="variable">$it</span>-title&quot;</span>, BigDecimal.TEN, writerId)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SELECT book.id, book.title, book.price, writer.`name`, writer.email FROM book INNER JOIN writer ON writer.id = book.writer_id</span></span><br><span class="line">    (Books innerJoin Writers)</span><br><span class="line">        .slice(</span><br><span class="line">            Books.id,</span><br><span class="line">            Books.title,</span><br><span class="line">            Books.price,</span><br><span class="line">            Writers.name,</span><br><span class="line">            Writers.email,</span><br><span class="line">        )</span><br><span class="line">        .selectAll()</span><br><span class="line">        .forEach &#123;</span><br><span class="line">            it.fieldIndex</span><br><span class="line">            println(<span class="string">&quot;bookId: <span class="subst">$&#123;it[Books.id]&#125;</span>, title: <span class="subst">$&#123;it[Books.title]&#125;</span>, writerName: <span class="subst">$&#123;it[Writers.name]&#125;</span>, writerEmail: <span class="subst">$&#123;it[Writers.email]&#125;</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>연관관계를 객체 기반으로 설정한 경우 위 코드처럼 어렵지 않게 조인을 진행할 수 있습니다. 하지만 객체 연관관계를 설정하지 않는 경우에는 위처럼 조인을 진행할 수 없고 아래와 같은 방법으로 진행해야 합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> Publishers: LongIdTable(<span class="string">&quot;publisher&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> writerId = long(<span class="string">&quot;writer_id&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> corpName = varchar(<span class="string">&quot;corp_name&quot;</span>, <span class="number">150</span>)</span><br><span class="line">    <span class="keyword">val</span> createdAt = datetime(<span class="string">&quot;created_at&quot;</span>).clientDefault &#123; LocalDateTime.now() &#125;</span><br><span class="line">    <span class="keyword">val</span> updatedAt = datetime(<span class="string">&quot;updated_at&quot;</span>).clientDefault &#123; LocalDateTime.now() &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>연관관계를 객체 기반으로 하는 것이 아니라 단순 long type으로 지정하여 테이블 객체를 선언합니다. JPA에서도 연관관계 탐색의 오용을 경계하는 것처럼 Exposed에서도 동일하게 무리한 객체 연결은 지양하는 것이 바람직하다고 생각합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExposedTest</span> : <span class="type">ExposedTestSupport</span>() &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `연관관계 없는 조인`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> connect = Database.connect(dataSource)</span><br><span class="line">        transaction(connect) &#123;</span><br><span class="line">            <span class="keyword">val</span> writer = Writers.insert &#123;</span><br><span class="line">                it[<span class="keyword">this</span>.name] = <span class="string">&quot;name&quot;</span></span><br><span class="line">                it[<span class="keyword">this</span>.email] = <span class="string">&quot;name@add.cpm&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">val</span> publisher = Publishers.insert &#123;</span><br><span class="line">                it[<span class="keyword">this</span>.writerId] = writer[Writers.id].value</span><br><span class="line">                it[<span class="keyword">this</span>.corpName] = <span class="string">&quot;corp name&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Publishers</span><br><span class="line">                .join(</span><br><span class="line">                    otherTable = Writers, <span class="comment">// (1)</span></span><br><span class="line">                    joinType = JoinType.LEFT, <span class="comment">// (2)</span></span><br><span class="line">                    additionalConstraint = &#123; <span class="comment">// (3)</span></span><br><span class="line">                        Publishers.writerId eq Writers.id</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line">                .select &#123;</span><br><span class="line">                    Publishers.id eq publisher[Publishers.id].value</span><br><span class="line">                &#125;</span><br><span class="line">                .forEach &#123;</span><br><span class="line">                    println(<span class="string">&quot;Publishers.id : <span class="subst">$&#123;it[Publishers.id]&#125;</span>&quot;</span>)</span><br><span class="line">                    println(<span class="string">&quot;Publishers.corpName : <span class="subst">$&#123;it[Publishers.corpName]&#125;</span>&quot;</span>)</span><br><span class="line">                    println(<span class="string">&quot;Publishers.writerId : <span class="subst">$&#123;it[Publishers.writerId]&#125;</span>&quot;</span>)</span><br><span class="line">                    println(<span class="string">&quot;Writers.id : <span class="subst">$&#123;it[Writers.id]&#125;</span>&quot;</span>)</span><br><span class="line">                    println(<span class="string">&quot;Writers.name : <span class="subst">$&#123;it[Writers.name]&#125;</span>&quot;</span>)</span><br><span class="line">                    println(<span class="string">&quot;Writers.email : <span class="subst">$&#123;it[Writers.email]&#125;</span>&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>(1): 조인할 대상 객체를 지정합니다.</li>
<li>(2): 조인 타입을 지정합니다.</li>
<li>(3): 조인 대상의 조건으로 on 절에 해당합니다.</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> publisher.id,</span><br><span class="line">       publisher.writer_id,</span><br><span class="line">       publisher.corp_name,</span><br><span class="line">       publisher.created_at,</span><br><span class="line">       publisher.updated_at,</span><br><span class="line">       writer.id,</span><br><span class="line">       writer.`name`,</span><br><span class="line">       writer.email,</span><br><span class="line">       writer.created_at,</span><br><span class="line">       writer.updated_at</span><br><span class="line"><span class="keyword">FROM</span> publisher</span><br><span class="line">         <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> writer <span class="keyword">ON</span> (publisher.writer_id <span class="operator">=</span> writer.id)</span><br><span class="line"><span class="keyword">WHERE</span> publisher.id <span class="operator">=</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>실제 원하는 방식으로 조인이 진행되는 것을 확인할 수 있습니다.</p>
<p>특정 조건에 따라 join을 해야 하는 경우가 있습니다. 예를 들어 특정 조건에 만족하는 경우 필요 테이블에 조인을 하여 필요 데이터를 가져오는 경우 Exposed에서는 다음과 같이 진행할 수 있습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExposedTest</span> : <span class="type">ExposedTestSupport</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `연관관계 없는 조인2`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> connect = Database.connect(dataSource)</span><br><span class="line">        transaction(connect) &#123;</span><br><span class="line">            <span class="keyword">val</span> writer = Writers.insert &#123;</span><br><span class="line">                it[<span class="keyword">this</span>.name] = <span class="string">&quot;name&quot;</span></span><br><span class="line">                it[<span class="keyword">this</span>.email] = <span class="string">&quot;name@add.cpm&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">val</span> publisher = Publishers.insert &#123;</span><br><span class="line">                it[<span class="keyword">this</span>.writerId] = writer[Writers.id].value</span><br><span class="line">                it[<span class="keyword">this</span>.corpName] = <span class="string">&quot;corp name&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">val</span> needJoin = <span class="literal">true</span> <span class="comment">// (1) </span></span><br><span class="line"></span><br><span class="line">            Publishers</span><br><span class="line">                .slice(</span><br><span class="line">                    Publishers.id,</span><br><span class="line">                    Publishers.corpName,</span><br><span class="line">                    Publishers.writerId</span><br><span class="line">                )</span><br><span class="line">                .select &#123;</span><br><span class="line">                    Publishers.id eq publisher[Publishers.id].value</span><br><span class="line">                &#125;</span><br><span class="line">                .apply &#123;</span><br><span class="line">                    <span class="comment">// (2)</span></span><br><span class="line">                    <span class="keyword">if</span> (needJoin) &#123;</span><br><span class="line">                        <span class="keyword">this</span>.adjustColumnSet &#123;</span><br><span class="line">                            join(</span><br><span class="line">                                otherTable = Writers,</span><br><span class="line">                                joinType = JoinType.LEFT,</span><br><span class="line">                                additionalConstraint = &#123;</span><br><span class="line">                                    Publishers.writerId eq Writers.id</span><br><span class="line">                                &#125;</span><br><span class="line">                            )</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">this</span>.adjustSlice &#123;</span><br><span class="line">                            <span class="comment">// (3)</span></span><br><span class="line">                            slice(it.fields + Writers.id + Writers.name + Writers.email)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                .forEach &#123;</span><br><span class="line">                    println(<span class="string">&quot;Publishers.id : <span class="subst">$&#123;it[Publishers.id]&#125;</span>&quot;</span>)</span><br><span class="line">                    println(<span class="string">&quot;Publishers.corpName : <span class="subst">$&#123;it[Publishers.corpName]&#125;</span>&quot;</span>)</span><br><span class="line">                    println(<span class="string">&quot;Publishers.writerId : <span class="subst">$&#123;it[Publishers.writerId]&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">if</span> (needJoin) &#123;</span><br><span class="line">                        println(<span class="string">&quot;Writers.id : <span class="subst">$&#123;it[Writers.id]&#125;</span>&quot;</span>)</span><br><span class="line">                        println(<span class="string">&quot;Writers.name : <span class="subst">$&#123;it[Writers.name]&#125;</span>&quot;</span>)</span><br><span class="line">                        println(<span class="string">&quot;Writers.email : <span class="subst">$&#123;it[Writers.email]&#125;</span>&quot;</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>(1): 특정 조건에 따라 조인 여부를 결정하는 분기 값</li>
<li>(2): 조건에 만족하는 경우 조인을 진행</li>
<li>(3): 조인을 진행한 경우 추가 적으로 필요한 칼럼을 추가</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># needJoin <span class="operator">=</span> <span class="literal">false</span> 경우</span><br><span class="line"><span class="keyword">SELECT</span> publisher.id,</span><br><span class="line">       publisher.corp_name,</span><br><span class="line">       publisher.writer_id</span><br><span class="line"><span class="keyword">FROM</span> publisher</span><br><span class="line"><span class="keyword">WHERE</span> publisher.id <span class="operator">=</span> <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"># needJoin <span class="operator">=</span> <span class="literal">true</span> 경우</span><br><span class="line"><span class="keyword">SELECT</span> publisher.id,</span><br><span class="line">       publisher.corp_name,</span><br><span class="line">       publisher.writer_id,</span><br><span class="line">       writer.id,</span><br><span class="line">       writer.`name`,</span><br><span class="line">       writer.email</span><br><span class="line"><span class="keyword">FROM</span> publisher</span><br><span class="line">         <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> writer <span class="keyword">ON</span> (publisher.writer_id <span class="operator">=</span> writer.id)</span><br><span class="line"><span class="keyword">WHERE</span> publisher.id <span class="operator">=</span> <span class="number">8</span></span><br></pre></td></tr></table></figure>
<p>needJoin 분기에 따라 쿼리문이 달라지는 것을 확인할 수 있습니다.</p>
<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/JetBrains/Exposed/wiki">Exposed Wiki</a></li>
</ul>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">태그</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/Exposed/" rel="tag">Exposed</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Kotlin/" rel="tag">Kotlin</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/ORM/" rel="tag">ORM</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/06/11/spring-cloud-gateway-2/"
                    data-tooltip="Spring Cloud Gateway Error Handling &amp; Filter"
                    aria-label="이전: Spring Cloud Gateway Error Handling &amp; Filter"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/05/28/slueth-fuel/"
                    data-tooltip="Sleuth 분산 환경 트래킹 With Fuel"
                    aria-label="다음: Sleuth 분산 환경 트래킹 With Fuel"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/2022/05/30/exposed-2/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/2022/05/30/exposed-2/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://cheese10yun.github.io/2022/05/30/exposed-2/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>


<!-- Comment -->
<!--  utteranc comment -->

<script src="https://utteranc.es/client.js"
        repo="cheese10yun/blog-comment"
        issue-term="title"
        label="Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Yun. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/06/11/spring-cloud-gateway-2/"
                    data-tooltip="Spring Cloud Gateway Error Handling &amp; Filter"
                    aria-label="이전: Spring Cloud Gateway Error Handling &amp; Filter"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2022/05/28/slueth-fuel/"
                    data-tooltip="Sleuth 분산 환경 트래킹 With Fuel"
                    aria-label="다음: Sleuth 분산 환경 트래킹 With Fuel"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/2022/05/30/exposed-2/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/2022/05/30/exposed-2/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://cheese10yun.github.io/2022/05/30/exposed-2/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/2022/05/30/exposed-2/"
                        aria-label="Facebook에 공유하기"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Facebook에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/2022/05/30/exposed-2/"
                        aria-label="Twitter에 공유하기"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Twitter에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://cheese10yun.github.io/2022/05/30/exposed-2/"
                        aria-label="Google+에 공유하기"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Google+에 공유하기</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
            <h4 id="about-card-name">Yun</h4>
        
            <div id="about-card-bio"><p>기술 블로그</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
