
<!DOCTYPE html>
<html lang="ko">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="naver-site-verification" content="a37ea649edf26e70c3de94f9cb034f9d6e11de3f" />
    <meta name="generator" content="Yun Blog">
    <title>테스트 대역폭 늘리기 - Yun Blog</title>
    <meta name="author" content="Yun">
    
        <meta name="keywords" content="Node,Spring,Spring Boot,Spring Batch,Kotlin,기술 블로그,JPA,Mongo,MySQL,OOP,">
    
    
    
        
            <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss2.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg"},"articleBody":"다양한 케이스에 대한 테스트 대역폭을 늘려서 테스트 코드를 작성하는 것은 중요한 작업입니다. 로직이 복잡하고 다양한 케이스에 대응하는 코드가 있다면 이러한 테스트 대역 폭은 더욱 중요합니다. 본 포스팅은 다양한 케이스에 대한 커버리지를 높이는 방법에 대한 방법에 관한 내용입니다.\nSample Code\n1234567891011121314151617181920212223242526272829303132333435363738394041@Serviceclass OrderService(    private val productQueryService: ProductQueryService,    private val exchangeRateClientImpl: ExchangeRateClientImpl,    private val couponQueryService: CouponQueryService,    private val shopQueryService: ShopQueryService) &#123;    fun order(        productId: Long,        orderDate: LocalDate,        orderAmount: BigDecimal,        shopId: Long,        couponCode: String?    ): String &#123;        // 상품 정보는 Elasticsearch에서 조회         val product = productQueryService.findById(productId)        // 환율 정보는 Redis에서 조회         val exchangeRateResponse = exchangeRateClientImpl.getExchangeRate(orderDate, &quot;USD&quot;, &quot;KRW&quot;)        // 쿠폰 정보는 MySql에서 조회        val coupon = couponQueryService.findByCode(couponCode)        // 가맹점 정보는 MySql에서 조회        val shop = shopQueryService.findById(shopId)        /**         * 복잡한 로직...         * 1. 상품 정보 조회 하여 금액 및 상품 재고 확인, 재고가 없는 경우 예외 처리 등등         * 2. 환율 정보 조회 하여 특정 국가 환율로 계산         * 3. 쿠폰 정보 조회하여 적용 가능한 상품인지 확인, 가맹점과 할인 금액 부담 비율 등등 계산         * 4. 가맹점 정보 조회하여 수수료 정보등 조회         */        // 영속화        val orderNumber = save(            productId,            exchangeRateResponse.amount,        )        return orderNumber    &#125;&#125;\n주문에 대한 sample code가 위처럼 작성되어 있는 경우 적어도 10~20개의 시나리오에 대한 테스트는 필요하다고 생각합니다. 하지만 해당 테스트 코드를 작성하기 위해서는 많은 어려움이 있습니다. 서비스 구조가 커지면 특정 문제를 해결하기 위한 다양한 인프라를 갖추게 됩니다. 위 코드도 각 데이터 특성에 맞는 저장소에 저장하고 조회하고 있습니다. 이런 경우 테스트 코드를 작성하기 위해서는 Given 절에 해당하는 곳에서 해당 인프라에 대한 데이터 셋업이 반드시 필요합니다. 이 작업의 어려움 때문에 다양한 케이스의 테스트 코드 작성이 어렵다고 생각합니다.\n중요한 것은 관심사\n테스트 코드를 작성하는 것은 해당 코드의 주요 관심사에 대한 테스트 코드를 작성하는 것입니다. 그렇다면 위 코드의 중요 관심사는 각각의 인프라에서의 조회, 복잡한 로직...에의 데이터 처리입니다. 두 가지 관심사에 대한 테스트 코드를 작성해야 하고 그 다양한 테스트 케이스에 대한 커버를 해야 하기 때문에 어려움이 있는 것입니다. 물론 중요 관심사라는 것은 대부분 명확하게 나눠지지 않고 항상 애매합니다. 로직이 복잡할수록 이러한 현상이 나타납니다. 그러기 때문에 테스트 코드를 작성하다 보면 설계의 경계선에 대한 피드백을 받을 수 있다는 점이 매우 유용한 장점이라고 생각합니다.\n각각의 인프라 조회 관심사\n123456789101112131415161718192021222324252627282930313233@Serviceclass OrderService(    private val productQueryService: ProductQueryService,    private val exchangeRateClientImpl: ExchangeRateClientImpl,    private val couponQueryService: CouponQueryService,    private val shopQueryService: ShopQueryService) &#123;    fun order(        productId: Long,        orderDate: LocalDate,        orderAmount: BigDecimal,        shopId: Long,        couponCode: String?    ): String &#123;        // 상품 정보는 Elasticsearch에서 조회        val product = productQueryService.findById(productId)        // 환율 정보는 Redis에서 조회        val exchangeRateResponse = exchangeRateClientImpl.getExchangeRate(orderDate, &quot;USD&quot;, &quot;KRW&quot;)        // 쿠폰 정보는 MySql에서 조회        val coupon = couponQueryService.findByCode(couponCode)        // 가맹점 정보는 MySql에서 조회        val shop = shopQueryService.findById(shopId)                // 복잡한 로직... OrderServiceSupport 객체로 위임        val order = OrderServiceSupport().order(...)        val order = save(order)        return order.orderNumber    &#125;&#125;\n복잡한 로직...관련 로직을 OrderServiceSupport 객체로 위임합니다. 해당 코드의 주관심사는 다양한 인프라에 해당하는 조회를 정상적으로 진행했는지에 대한 코드를 작성합니다. 각각의 인프라 조회는 해당 서비스 로직에서 주요 관심사로 보고 테스트를 진행하기 때문에 order에서는 중복적인 테스트는 불필요하다고 생각하며 몇 가지 간단한 케이스에 대해서 Order 객체가 영속 화가 알맞게 되었는지 검증하는 테스트 코드를 작성합니다.\n복잡한 로직(데이터 처리) 관심사\n12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364/** * Spring Bean Context와 인프라스트럭처의 관련 코드가 없는 순수한 POJO */class OrderServiceSupport &#123;    /**     * 각각의 인프라의 조회 책임을 위임 하여 복잡한 로직 작성... 에대한 관심사만 갖는다.     */    fun order(        product: Product,        orderDate: LocalDate,        orderAmount: BigDecimal,        exchangeRateResponse: ExchangeRateResponse,        shop: Shop,        coupon: Coupon?,    ): Order &#123;        /**         * 복잡한 로직...         * 1. 상품 정보 조회 하여 금액 및 상품 재고 확인, 재고가 없는 경우 예외 처리 등등         * 2. 환율 정보 조회 하여 특정 국가 환율로 계산         * 3. 쿠폰 정보 조회하여 적용 가능한 상품인지 확인, 가맹점과 할인 금액 부담 비율 등등 계산         * 4. 가맹점 정보 조회하여 수수료 정보등 조회         */        return Order(            ...        )    &#125;&#125;internal class OrderServiceSupportTest &#123;    @Test    internal fun `쿠폰 적용 없는 주문 생성`() &#123;        //given        // 순수하게 POJO 기반으로 데이터를 만들고 테스트를 진행하기 때문에 자연스럽게 비즈니스 로직에만 집중 할 수 있습니다.        val product = Product(            productId = ...,            amount = ...,            currency = ...        )        val orderDate = LocalDate.of(2022, 2, 2)        val orderAmount = 100.toBigDecimal()        val exchangeRateResponse = ExchangeRateResponse(            1222.12.toBigDecimal()        )        val shop = Shop(            feeRate = 0.023.toBigDecimal()        )        //when        val order = OrderServiceSupport().order(            product = product,            orderDate = orderDate,            orderAmount = orderAmount,            exchangeRateResponse = exchangeRateResponse,            shop = shop,            coupon = null,        )        //then        // 복잡한 로직..에 대한 검증    &#125;&#125;\n복잡한 로직(데이터 처리) 관심사만 갖는 객체를 만들어 해당 데이터에 대한 처리를 진행합니다. 이때 해당 객체는 Spring Bean Context 및 인프라스트럭처의 관련 코드가 없이 동작하는 순수한 POJO 객체로 만들어 데이터 처리를 진행합니다. Given 절에서 외부 환경에 대한 의존성이 없이 다양한 테스트 케이스를 쉽게 작성할 수 있으며 인프라 및 기타 환경에 구애받지 않기 때문에 비즈니스 로직의 관심사에만 자연스럽게 집중할 수 있게 됩니다.\n","dateCreated":"2022-10-16T00:00:00+09:00","dateModified":"2025-01-31T20:33:58+09:00","datePublished":"2022-10-16T00:00:00+09:00","description":"다양한 케이스에 대한 테스트 대역폭을 늘려서 테스트 코드를 작성하는 것은 중요한 작업입니다. 로직이 복잡하고 다양한 케이스에 대응하는 코드가 있다면 이러한 테스트 대역 폭은 더욱 중요합니다.","headline":"테스트 대역폭 늘리기","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://cheese10yun.github.io/test-bandwidth/"},"publisher":{"@type":"Organization","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg","logo":{"@type":"ImageObject","url":"yun-icon.jpg"}},"url":"https://cheese10yun.github.io/test-bandwidth/","keywords":"Test"}</script>
    <meta name="description" content="다양한 케이스에 대한 테스트 대역폭을 늘려서 테스트 코드를 작성하는 것은 중요한 작업입니다. 로직이 복잡하고 다양한 케이스에 대응하는 코드가 있다면 이러한 테스트 대역 폭은 더욱 중요합니다.">
<meta property="og:type" content="blog">
<meta property="og:title" content="테스트 대역폭 늘리기">
<meta property="og:url" content="https://cheese10yun.github.io/test-bandwidth/index.html">
<meta property="og:site_name" content="Yun Blog">
<meta property="og:description" content="다양한 케이스에 대한 테스트 대역폭을 늘려서 테스트 코드를 작성하는 것은 중요한 작업입니다. 로직이 복잡하고 다양한 케이스에 대응하는 코드가 있다면 이러한 테스트 대역 폭은 더욱 중요합니다.">
<meta property="og:locale" content="ko_KR">
<meta property="article:published_time" content="2022-10-15T15:00:00.000Z">
<meta property="article:modified_time" content="2025-01-31T11:33:58.195Z">
<meta property="article:author" content="Yun">
<meta property="article:tag" content="Test">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="https://cheese10yun.github.io/assets/images/yun-icon.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90907312-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90907312-1');
    </script>


    

    
        
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5813739623204880" crossorigin="anonymous"></script>
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Yun Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="링크 열기: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="저자에 대해 더 알아보기"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
                </a>
                <h4 class="sidebar-profile-name">Yun</h4>
                
                    <h5 class="sidebar-profile-bio"><p>기술 블로그</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="카테고리"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">카테고리</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="태그"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">태그</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="아카이브"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">아카이브</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="검색"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">검색</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/cheese10yun"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/rss2.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            테스트 대역폭 늘리기
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2022-10-16T00:00:00+09:00">
	
		    2022/10/16
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>다양한 케이스에 대한 테스트 대역폭을 늘려서 테스트 코드를 작성하는 것은 중요한 작업입니다. 로직이 복잡하고 다양한 케이스에 대응하는 코드가 있다면 이러한 테스트 대역 폭은 더욱 중요합니다. 본 포스팅은 다양한 케이스에 대한 커버리지를 높이는 방법에 대한 방법에 관한 내용입니다.</p>
<h2 id="Sample-Code">Sample Code</h2>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderService</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> productQueryService: ProductQueryService,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> exchangeRateClientImpl: ExchangeRateClientImpl,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> couponQueryService: CouponQueryService,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> shopQueryService: ShopQueryService</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">order</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        productId: <span class="type">Long</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        orderDate: <span class="type">LocalDate</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        orderAmount: <span class="type">BigDecimal</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        shopId: <span class="type">Long</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        couponCode: <span class="type">String</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: String &#123;</span><br><span class="line">        <span class="comment">// 상품 정보는 Elasticsearch에서 조회 </span></span><br><span class="line">        <span class="keyword">val</span> product = productQueryService.findById(productId)</span><br><span class="line">        <span class="comment">// 환율 정보는 Redis에서 조회 </span></span><br><span class="line">        <span class="keyword">val</span> exchangeRateResponse = exchangeRateClientImpl.getExchangeRate(orderDate, <span class="string">&quot;USD&quot;</span>, <span class="string">&quot;KRW&quot;</span>)</span><br><span class="line">        <span class="comment">// 쿠폰 정보는 MySql에서 조회</span></span><br><span class="line">        <span class="keyword">val</span> coupon = couponQueryService.findByCode(couponCode)</span><br><span class="line">        <span class="comment">// 가맹점 정보는 MySql에서 조회</span></span><br><span class="line">        <span class="keyword">val</span> shop = shopQueryService.findById(shopId)</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 복잡한 로직...</span></span><br><span class="line"><span class="comment">         * 1. 상품 정보 조회 하여 금액 및 상품 재고 확인, 재고가 없는 경우 예외 처리 등등</span></span><br><span class="line"><span class="comment">         * 2. 환율 정보 조회 하여 특정 국가 환율로 계산</span></span><br><span class="line"><span class="comment">         * 3. 쿠폰 정보 조회하여 적용 가능한 상품인지 확인, 가맹점과 할인 금액 부담 비율 등등 계산</span></span><br><span class="line"><span class="comment">         * 4. 가맹점 정보 조회하여 수수료 정보등 조회</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 영속화</span></span><br><span class="line">        <span class="keyword">val</span> orderNumber = save(</span><br><span class="line">            productId,</span><br><span class="line">            exchangeRateResponse.amount,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> orderNumber</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>주문에 대한 sample code가 위처럼 작성되어 있는 경우 적어도 10~20개의 시나리오에 대한 테스트는 필요하다고 생각합니다. 하지만 해당 테스트 코드를 작성하기 위해서는 많은 어려움이 있습니다. 서비스 구조가 커지면 특정 문제를 해결하기 위한 다양한 인프라를 갖추게 됩니다. 위 코드도 각 데이터 특성에 맞는 저장소에 저장하고 조회하고 있습니다. 이런 경우 테스트 코드를 작성하기 위해서는 Given 절에 해당하는 곳에서 해당 인프라에 대한 데이터 셋업이 반드시 필요합니다. <strong>이 작업의 어려움 때문에 다양한 케이스의 테스트 코드 작성이 어렵다고 생각합니다.</strong></p>
<h2 id="중요한-것은-관심사">중요한 것은 관심사</h2>
<p>테스트 코드를 작성하는 것은 해당 코드의 주요 관심사에 대한 테스트 코드를 작성하는 것입니다. 그렇다면 위 코드의 중요 관심사는 각각의 인프라에서의 조회, <code>복잡한 로직...</code>에의 데이터 처리입니다. 두 가지 관심사에 대한 테스트 코드를 작성해야 하고 그 다양한 테스트 케이스에 대한 커버를 해야 하기 때문에 어려움이 있는 것입니다. 물론 중요 관심사라는 것은 대부분 명확하게 나눠지지 않고 항상 애매합니다. 로직이 복잡할수록 이러한 현상이 나타납니다. 그러기 때문에 테스트 코드를 작성하다 보면 설계의 경계선에 대한 피드백을 받을 수 있다는 점이 매우 유용한 장점이라고 생각합니다.</p>
<h3 id="각각의-인프라-조회-관심사">각각의 인프라 조회 관심사</h3>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderService</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> productQueryService: ProductQueryService,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> exchangeRateClientImpl: ExchangeRateClientImpl,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> couponQueryService: CouponQueryService,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> shopQueryService: ShopQueryService</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">order</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        productId: <span class="type">Long</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        orderDate: <span class="type">LocalDate</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        orderAmount: <span class="type">BigDecimal</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        shopId: <span class="type">Long</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        couponCode: <span class="type">String</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: String &#123;</span><br><span class="line">        <span class="comment">// 상품 정보는 Elasticsearch에서 조회</span></span><br><span class="line">        <span class="keyword">val</span> product = productQueryService.findById(productId)</span><br><span class="line">        <span class="comment">// 환율 정보는 Redis에서 조회</span></span><br><span class="line">        <span class="keyword">val</span> exchangeRateResponse = exchangeRateClientImpl.getExchangeRate(orderDate, <span class="string">&quot;USD&quot;</span>, <span class="string">&quot;KRW&quot;</span>)</span><br><span class="line">        <span class="comment">// 쿠폰 정보는 MySql에서 조회</span></span><br><span class="line">        <span class="keyword">val</span> coupon = couponQueryService.findByCode(couponCode)</span><br><span class="line">        <span class="comment">// 가맹점 정보는 MySql에서 조회</span></span><br><span class="line">        <span class="keyword">val</span> shop = shopQueryService.findById(shopId)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 복잡한 로직... OrderServiceSupport 객체로 위임</span></span><br><span class="line">        <span class="keyword">val</span> order = OrderServiceSupport().order(...)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> order = save(order)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> order.orderNumber</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>복잡한 로직...</code>관련 로직을 OrderServiceSupport 객체로 위임합니다. 해당 코드의 주관심사는 다양한 인프라에 해당하는 조회를 정상적으로 진행했는지에 대한 코드를 작성합니다. 각각의 인프라 조회는 해당 서비스 로직에서 주요 관심사로 보고 테스트를 진행하기 때문에 order에서는 중복적인 테스트는 불필요하다고 생각하며 몇 가지 간단한 케이스에 대해서 Order 객체가 영속 화가 알맞게 되었는지 검증하는 테스트 코드를 작성합니다.</p>
<h3 id="복잡한-로직-데이터-처리-관심사">복잡한 로직(데이터 처리) 관심사</h3>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Spring Bean Context와 인프라스트럭처의 관련 코드가 없는 순수한 POJO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderServiceSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 각각의 인프라의 조회 책임을 위임 하여 복잡한 로직 작성... 에대한 관심사만 갖는다.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">order</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        product: <span class="type">Product</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        orderDate: <span class="type">LocalDate</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        orderAmount: <span class="type">BigDecimal</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        exchangeRateResponse: <span class="type">ExchangeRateResponse</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        shop: <span class="type">Shop</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        coupon: <span class="type">Coupon</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: Order &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 복잡한 로직...</span></span><br><span class="line"><span class="comment">         * 1. 상품 정보 조회 하여 금액 및 상품 재고 확인, 재고가 없는 경우 예외 처리 등등</span></span><br><span class="line"><span class="comment">         * 2. 환율 정보 조회 하여 특정 국가 환율로 계산</span></span><br><span class="line"><span class="comment">         * 3. 쿠폰 정보 조회하여 적용 가능한 상품인지 확인, 가맹점과 할인 금액 부담 비율 등등 계산</span></span><br><span class="line"><span class="comment">         * 4. 가맹점 정보 조회하여 수수료 정보등 조회</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> Order(</span><br><span class="line">            ...</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">OrderServiceSupportTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> `쿠폰 적용 없는 주문 생성`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">//given</span></span><br><span class="line">        <span class="comment">// 순수하게 POJO 기반으로 데이터를 만들고 테스트를 진행하기 때문에 자연스럽게 비즈니스 로직에만 집중 할 수 있습니다.</span></span><br><span class="line">        <span class="keyword">val</span> product = Product(</span><br><span class="line">            productId = ...,</span><br><span class="line">            amount = ...,</span><br><span class="line">            currency = ...</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">val</span> orderDate = LocalDate.of(<span class="number">2022</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">val</span> orderAmount = <span class="number">100.</span>toBigDecimal()</span><br><span class="line">        <span class="keyword">val</span> exchangeRateResponse = ExchangeRateResponse(</span><br><span class="line">            <span class="number">1222.12</span>.toBigDecimal()</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">val</span> shop = Shop(</span><br><span class="line">            feeRate = <span class="number">0.023</span>.toBigDecimal()</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment">//when</span></span><br><span class="line">        <span class="keyword">val</span> order = OrderServiceSupport().order(</span><br><span class="line">            product = product,</span><br><span class="line">            orderDate = orderDate,</span><br><span class="line">            orderAmount = orderAmount,</span><br><span class="line">            exchangeRateResponse = exchangeRateResponse,</span><br><span class="line">            shop = shop,</span><br><span class="line">            coupon = <span class="literal">null</span>,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment">//then</span></span><br><span class="line">        <span class="comment">// 복잡한 로직..에 대한 검증</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>복잡한 로직(데이터 처리) 관심사만 갖는 객체를 만들어 해당 데이터에 대한 처리를 진행합니다. <strong>이때 해당 객체는 Spring Bean Context 및 인프라스트럭처의 관련 코드가 없이 동작하는 순수한 POJO 객체로 만들어 데이터 처리를 진행합니다.</strong> Given 절에서 외부 환경에 대한 의존성이 없이 다양한 테스트 케이스를 쉽게 작성할 수 있으며 인프라 및 기타 환경에 구애받지 않기 때문에 비즈니스 로직의 관심사에만 자연스럽게 집중할 수 있게 됩니다.</p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">태그</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/Test/" rel="tag">Test</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/mysql-batch-update/"
                    data-tooltip="MySQL Batch Update 성능 측정 및 분석"
                    aria-label="이전: MySQL Batch Update 성능 측정 및 분석"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/external-infrastructure-testing/"
                    data-tooltip="외부 인프라스트럭처 테스트 Mocking 테스트를 대하는 관점"
                    aria-label="다음: 외부 인프라스트럭처 테스트 Mocking 테스트를 대하는 관점"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/test-bandwidth/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/test-bandwidth/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://cheese10yun.github.io/test-bandwidth/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>


<!-- Comment -->
<!--  utteranc comment -->

<script src="https://utteranc.es/client.js"
        repo="cheese10yun/blog-comment"
        issue-term="title"
        label="Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Yun. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/mysql-batch-update/"
                    data-tooltip="MySQL Batch Update 성능 측정 및 분석"
                    aria-label="이전: MySQL Batch Update 성능 측정 및 분석"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/external-infrastructure-testing/"
                    data-tooltip="외부 인프라스트럭처 테스트 Mocking 테스트를 대하는 관점"
                    aria-label="다음: 외부 인프라스트럭처 테스트 Mocking 테스트를 대하는 관점"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/test-bandwidth/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/test-bandwidth/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://cheese10yun.github.io/test-bandwidth/"
                    title="Google+에 공유하기"
                    aria-label="Google+에 공유하기"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/test-bandwidth/"
                        aria-label="Facebook에 공유하기"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Facebook에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/test-bandwidth/"
                        aria-label="Twitter에 공유하기"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Twitter에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://cheese10yun.github.io/test-bandwidth/"
                        aria-label="Google+에 공유하기"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Google+에 공유하기</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
            <h4 id="about-card-name">Yun</h4>
        
            <div id="about-card-bio"><p>기술 블로그</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
