
<!DOCTYPE html>
<html lang="ko">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="sBAfGubPxv1ol5QEVGgOJ4ggp5spK-zFFXpK-Pd2xZM" />
    <meta name="naver-site-verification" content="a37ea649edf26e70c3de94f9cb034f9d6e11de3f" />
    <meta name="generator" content="Yun Blog">
    <title>Spring Social Part 2 데이터베이스에 회원 정보 저장 - Yun Blog</title>
    <meta name="author" content="Yun">
    
        <meta name="keywords" content="Node,Spring,Spring Boot,Spring Batch,Kotlin,기술 블로그,JPA,Mongo,MySQL,OOP,">
    
    
    
        
            <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss2.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg"},"articleBody":"전체 코드는 Github를 확인해주세요.\nstep-01: Google, Facebook 간단한 소셜 인증에서 소셜 기반으로 인증 처리를 진행했습니다. 이번 차례에서는 해당 정보를 데이터베이스에 영속화 시키는 간단한 예제로 Data JPA, H2를 이용하겠습니다.\n테이블#\n\nuser_connection : 소셜에서 넘겨준 프로필에 대한 테이블\nuser : 해당 프로젝트의 user 테이블\n\n전체적은 플로우는 다음과 같습니다.\n\n소셜에서 회원 인증 \n인증된 회원정보 데이터베이스 조회\n조회되는 경우 -&gt; 기존 유저로 판단, 조화된 정보기반으로 인증처리\n조회되지 않은 경우 -&gt; 신규 유저로 판단, user_connection, user 테이블 저장 저장된 정보기반으로 인증처리\n\n\n\nSecurity#12345678910111213141516171819202122232425262728293031public class SecurityConfig extends WebSecurityConfigurerAdapter &#123;    @Override    protected void configure(HttpSecurity http) throws Exception &#123;        // @formatter:off        ...\t\thttp.antMatcher(&quot;/**&quot;).authorizeRequests().antMatchers(&quot;/&quot;, &quot;/login**&quot;).permitAll().anyRequest()                ...\t\t\t\t.addFilterBefore(ssoFilter(), BasicAuthenticationFilter.class);\t\t// @formatter:on    &#125;    private Filter ssoFilter() &#123;        CompositeFilter filter = new CompositeFilter();        List&lt;Filter&gt; filters = new ArrayList&lt;&gt;();        filters.add(ssoFilter(google(), new GoogleOAuth2ClientAuthenticationProcessingFilter(socialService)));        filters.add(ssoFilter(facebook(), new FacebookOAuth2ClientAuthenticationProcessingFilter(socialService)));        filter.setFilters(filters);        return filter;    &#125;    private Filter ssoFilter(ClientResources client, OAuth2ClientAuthenticationProcessingFilter filter) &#123;        OAuth2RestTemplate restTemplate = new OAuth2RestTemplate(client.getClient(), oauth2ClientContext);        filter.setRestTemplate(restTemplate);        UserInfoTokenServices tokenServices = new UserInfoTokenServices(client.getResource().getUserInfoUri(), client.getClient().getClientId());        filter.setTokenServices(tokenServices);        tokenServices.setRestTemplate(restTemplate);        return filter;    &#125;&#125;\nstep-01: Google, Facebook 간단한 소셜 인증의 SecurityConfig 에서 조금 변경한 내용입니다.\n달라진 점은 크게 없고 GoogleOAuth2ClientAuthenticationProcessingFilter, FacebookOAuth2ClientAuthenticationProcessingFilter의 클래스를 기반으로 필터에 등록시켰습니다. 이때 소셜 가입 및 로그인 처리를 담당하는 SocialService를 생성자를 통해서 주입해주었습니다.\nOAuth2ClientAuthenticationProcessingFilter#1234567891011121314151617181920212223242526public class FacebookOAuth2ClientAuthenticationProcessingFilter extends OAuth2ClientAuthenticationProcessingFilter &#123;    private ObjectMapper mapper = new ObjectMapper();    private SocialService socialService;    public FacebookOAuth2ClientAuthenticationProcessingFilter(SocialService socialService) &#123;        super(&quot;/login/facebook&quot;);        this.socialService = socialService;        mapper.configure(DeserializationConfig.Feature.FAIL_ON_UNKNOWN_PROPERTIES, false);    &#125;    @Override    protected void successfulAuthentication(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authResult) throws IOException, ServletException &#123;        final OAuth2AccessToken accessToken = restTemplate.getAccessToken(); // 토큰 정보 가져옴        final OAuth2Authentication auth = (OAuth2Authentication) authResult;        final Object details = auth.getUserAuthentication().getDetails(); // 소셜에서 넘겨 받은 정보를 details에 저장        final FacebookUserDetails userDetails = mapper.convertValue(details, FacebookUserDetails.class); // Object mapper를 이용해서 객체 변환        userDetails.setAccessToken(accessToken); // access token 정보도 저장        final UserConnection userConnection = UserConnection.valueOf(userDetails); // UserConnection를 userDetails 기반으로 생성        final UsernamePasswordAuthenticationToken authenticationToken = socialService.doAuthentication(userConnection); // SocialService를 이용해서 인증 절차 진행        super.successfulAuthentication(request, response, chain, authenticationToken);    &#125;&#125;\nOAuth2ClientAuthenticationProcessingFilter 클래스를 상속 받아서 구현한 클래스입니다. successfulAuthentication 메서드는 소셜 인증을 성공되면 호출되는 메서드입니다. 가장 중\nrestTemplate.getAccessToken() 메서드를 통해서 해당 유저의 access token 정보를 가져옵니다.\n인자로 넘겨받은 authResult 객체에 소셜에서 넘겨받은 정보를 details 객체에 넘겨받습니다. 이때 넘겨받은 정보를 ObejctMapper를 이용해서 FacebookUserDetails로 변환 합니다.\nstep-01: Google, Facebook 간단한 소셜 인증에서 보셨듯 소셜에 넘겨주는 profile 객체는 LinkedHashMap의 형태입니다. 실제 런타임 전까지는 정확한 자료형을 확인하기가 어렵습니다. 그래서 FacebookUserDetails DTO 클래스 이용하는 것이 가독성 및 유지 보수하기 좋다고 생각합니다.\nFacebookUserDetails 객체를 기반으로 UserConnection 객체를 만듭니다. UserConnection 객체는 아래에서 설명하겠습니다.\ndoAuthentication 메서드#12345678910111213public UsernamePasswordAuthenticationToken doAuthentication(UserConnection userConnection) &#123;    if (userService.isExistUser(userConnection)) &#123;        // 기존 회원일 경우에는 데이터베이스에서 조회해서 인증 처리        final User user = userService.findBySocial(userConnection);        return setAuthenticationToken(user);    &#125; else &#123;        // 새 회원일 경우 회원가입 이후 인증 처리        final User user = userService.signUp(userConnection);        return setAuthenticationToken(user);    &#125;&#125;\nData JPA에 대한 설명은 하지 않겠습니다. 데이터베이스에서 회원 존재 유무를 확인 후 기존 회원일 경우는 바로 인증 회원 정보를 리턴합니다. 그렇지 않고 신규 회원일 경우에는 회원 가입을 진행 시킵니다. 이때 user_conncection, user 테이블에 두 곳 모두 저장시킵니다.\n12345678910111213141516Hibernate:     insert     into        user_connection        (access_token, display_name, email, expire_time, image_url, profile_url, provider, provider_id, id)     values        (?, ?, ?, ?, ?, ?, ?, ?, ?)Hibernate:     insert     into        user        (email, nickname, provider_id, id)     values        (?, ?, ?, ?)\n신규 가입일 경우 쿼리입니다. user_connection, user 테이블에 각각 insert가 되는 것을 확인할 수 있습니다.\nUserConnection#12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758@Table(name = &quot;user&quot;)@NoArgsConstructor(access = AccessLevel.PROTECTED)@Getterpublic class User &#123;    @Id @GeneratedValue(strategy = GenerationType.AUTO)private long id;    ...    @OneToOne(cascade = CascadeType.PERSIST)    @JoinColumn(name = &quot;provider_id&quot;, referencedColumnName = &quot;provider_id&quot;, nullable = false, updatable = false, unique = true)    private UserConnection social;    @Builder    private User(String email, String nickname, UserConnection social) &#123;        this.email = email;        this.nickname = nickname;        this.social = social;    &#125;    public static User signUp(UserConnection userConnection) &#123;        return User.builder()                .email(userConnection.getEmail())                .nickname(userConnection.getDisplayName())                .social(userConnection)                .build();    &#125;&#125;@Entity@Table(name = &quot;user_connection&quot;)@NoArgsConstructor(access = AccessLevel.PROTECTED)public class UserConnection &#123;    @Id @GeneratedValue(strategy = GenerationType.AUTO) private long id;    @Column(name = &quot;email&quot;) private String email;    @Column(name = &quot;provider&quot;) @Enumerated(EnumType.STRING) private ProviderType provider;    @Column(name = &quot;provider_id&quot;, unique = true, nullable = false) private String providerId;    @Column(name = &quot;display_name&quot;) private String displayName;    @Column(name = &quot;profile_url&quot;) private String profileUrl;    @Column(name = &quot;image_url&quot;) private String imageUrl;    @Column(name = &quot;access_token&quot;) private String accessToken;    @Column(name = &quot;expire_time&quot;) private long expireTime;    ...    public static UserConnection valueOf(GoogleUserDetails userDetails) &#123;        return UserConnection.builder()                .expireTime(userDetails.getExpiration())                .accessToken(userDetails.getAccess_token())                .providerId(userDetails.getSub())                .email(userDetails.getEmail())                .displayName(userDetails.getName())                .imageUrl(userDetails.getPicture())                .provider(ProviderType.GOOGLE)                .profileUrl(userDetails.getProfile())                .build();    &#125;&#125;\n\n코드는 길지만 말하고자 하는 것은 단순합니다. 지금 프로젝트에서는 소셜 가입 외에는 회원 인증 절차(회원가입)가 없다는 가정입니다. \n그렇다는 것은 UserConnection 객체가 만들어지는 이유는 단 한 가지입니다. Google, Facebook를 통한 회원 인증일 경우입니다. UserConnection 위의 코드를 보시면 알겠지만 UserConnection 객체를 만들 수 있는 것은 방법은 valueOf 객체뿐입니다. (JPA 프록시객체 때문에 protected 생성자는 만들어야 합니다.)\n이 처럼 객체의 생성도 명확한 근거 외에는 생성을 제한하는 좋은 구조라고 생각합니다. 또 User 객체도 마찬가지입니다. 소셜 회원 가입 이외에는 회원가입이 없으므로 User 객체는 UserConnection를 기반으로 만드는 방법 말고 제공하지 않는 것도 마찬가지입니다.\n","dateCreated":"2018-09-23T00:00:00+09:00","dateModified":"2025-01-31T19:49:45+09:00","datePublished":"2018-09-23T00:00:00+09:00","description":"Spring Social을 사용하여 소셜 로그인(예: Facebook, Google) 기능을 Spring 애플리케이션에 통합하는 방법을 다룹니다.","headline":"Spring Social Part 2 데이터베이스에 회원 정보 저장","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://cheese10yun.github.io/spring-social-02/"},"publisher":{"@type":"Organization","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg","logo":{"@type":"ImageObject","url":"yun-icon.jpg"}},"url":"https://cheese10yun.github.io/spring-social-02/","keywords":"Spring, OAuth2"}</script>
    <meta name="description" content="Spring Social을 사용하여 소셜 로그인(예: Facebook, Google) 기능을 Spring 애플리케이션에 통합하는 방법을 다룹니다.">
<meta property="og:type" content="blog">
<meta property="og:title" content="Spring Social Part 2 데이터베이스에 회원 정보 저장">
<meta property="og:url" content="https://cheese10yun.github.io/spring-social-02/index.html">
<meta property="og:site_name" content="Yun Blog">
<meta property="og:description" content="Spring Social을 사용하여 소셜 로그인(예: Facebook, Google) 기능을 Spring 애플리케이션에 통합하는 방법을 다룹니다.">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://github.com/cheese10yun/spring-security-oauth2-social/blob/master/assets/social-table.png?raw=true">
<meta property="article:published_time" content="2018-09-22T15:00:00.000Z">
<meta property="article:modified_time" content="2025-01-31T10:49:45.028Z">
<meta property="article:author" content="Yun">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="OAuth2">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/cheese10yun/spring-security-oauth2-social/blob/master/assets/social-table.png?raw=true">
    
    
        
    
    
        <meta property="og:image" content="https://cheese10yun.github.io/assets/images/yun-icon.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90907312-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90907312-1');
    </script>


    

    
        
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5813739623204880" crossorigin="anonymous"></script>
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Yun Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="링크 열기: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="저자에 대해 더 알아보기"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
                </a>
                <h4 class="sidebar-profile-name">Yun</h4>
                
                    <h5 class="sidebar-profile-bio"><p>기술 블로그</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="태그"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">태그</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="아카이브"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">아카이브</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/cheese10yun"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/rss2.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Spring Social Part 2 데이터베이스에 회원 정보 저장
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2018-09-23T00:00:00+09:00">
	
		    2018/09/23
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>전체 코드는 <a target="_blank" rel="noopener" href="https://github.com/cheese10yun/spring-security-oauth2-social">Github</a>를 확인해주세요.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/cheese10yun/spring-security-oauth2-social/blob/master/doc/step-01.md">step-01: Google, Facebook 간단한 소셜 인증</a>에서 소셜 기반으로 인증 처리를 진행했습니다. 이번 차례에서는 해당 정보를 데이터베이스에 영속화 시키는 간단한 예제로 Data JPA, H2를 이용하겠습니다.</p>
<h2><span id="teibeul">테이블</span><a href="#teibeul" class="header-anchor">#</a></h2><p><img src="https://github.com/cheese10yun/spring-security-oauth2-social/blob/master/assets/social-table.png?raw=true" alt="social-table"></p>
<ul>
<li>user_connection : 소셜에서 넘겨준 프로필에 대한 테이블</li>
<li>user : 해당 프로젝트의 user 테이블</li>
</ul>
<p>전체적은 플로우는 다음과 같습니다.</p>
<ol>
<li>소셜에서 회원 인증 </li>
<li>인증된 회원정보 데이터베이스 조회<ul>
<li>조회되는 경우 -&gt; 기존 유저로 판단, 조화된 정보기반으로 인증처리</li>
<li>조회되지 않은 경우 -&gt; 신규 유저로 판단, user_connection, user 테이블 저장 저장된 정보기반으로 인증처리</li>
</ul>
</li>
</ol>
<h2><span id="security">Security</span><a href="#security" class="header-anchor">#</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// @formatter:off</span></span><br><span class="line">        ...</span><br><span class="line">		http.antMatcher(<span class="string">&quot;/**&quot;</span>).authorizeRequests().antMatchers(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/login**&quot;</span>).permitAll().anyRequest()</span><br><span class="line">                ...</span><br><span class="line">				.addFilterBefore(ssoFilter(), BasicAuthenticationFilter.class);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// @formatter:on</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Filter <span class="title function_">ssoFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CompositeFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CompositeFilter</span>();</span><br><span class="line">        List&lt;Filter&gt; filters = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        filters.add(ssoFilter(google(), <span class="keyword">new</span> <span class="title class_">GoogleOAuth2ClientAuthenticationProcessingFilter</span>(socialService)));</span><br><span class="line">        filters.add(ssoFilter(facebook(), <span class="keyword">new</span> <span class="title class_">FacebookOAuth2ClientAuthenticationProcessingFilter</span>(socialService)));</span><br><span class="line">        filter.setFilters(filters);</span><br><span class="line">        <span class="keyword">return</span> filter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Filter <span class="title function_">ssoFilter</span><span class="params">(ClientResources client, OAuth2ClientAuthenticationProcessingFilter filter)</span> &#123;</span><br><span class="line">        <span class="type">OAuth2RestTemplate</span> <span class="variable">restTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OAuth2RestTemplate</span>(client.getClient(), oauth2ClientContext);</span><br><span class="line">        filter.setRestTemplate(restTemplate);</span><br><span class="line">        <span class="type">UserInfoTokenServices</span> <span class="variable">tokenServices</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserInfoTokenServices</span>(client.getResource().getUserInfoUri(), client.getClient().getClientId());</span><br><span class="line">        filter.setTokenServices(tokenServices);</span><br><span class="line">        tokenServices.setRestTemplate(restTemplate);</span><br><span class="line">        <span class="keyword">return</span> filter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://github.com/cheese10yun/spring-security-oauth2-social/blob/master/doc/step-01.md">step-01: Google, Facebook 간단한 소셜 인증</a>의 SecurityConfig 에서 조금 변경한 내용입니다.</p>
<p>달라진 점은 크게 없고 GoogleOAuth2ClientAuthenticationProcessingFilter, FacebookOAuth2ClientAuthenticationProcessingFilter의 클래스를 기반으로 필터에 등록시켰습니다. 이때 소셜 가입 및 로그인 처리를 담당하는 SocialService를 생성자를 통해서 주입해주었습니다.</p>
<h2><span id="oauth2clientauthenticationprocessingfilter">OAuth2ClientAuthenticationProcessingFilter</span><a href="#oauth2clientauthenticationprocessingfilter" class="header-anchor">#</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FacebookOAuth2ClientAuthenticationProcessingFilter</span> <span class="keyword">extends</span> <span class="title class_">OAuth2ClientAuthenticationProcessingFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="keyword">private</span> SocialService socialService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FacebookOAuth2ClientAuthenticationProcessingFilter</span><span class="params">(SocialService socialService)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="string">&quot;/login/facebook&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.socialService = socialService;</span><br><span class="line">        mapper.configure(DeserializationConfig.Feature.FAIL_ON_UNKNOWN_PROPERTIES, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">successfulAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authResult)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">OAuth2AccessToken</span> <span class="variable">accessToken</span> <span class="operator">=</span> restTemplate.getAccessToken(); <span class="comment">// 토큰 정보 가져옴</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">OAuth2Authentication</span> <span class="variable">auth</span> <span class="operator">=</span> (OAuth2Authentication) authResult;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">details</span> <span class="operator">=</span> auth.getUserAuthentication().getDetails(); <span class="comment">// 소셜에서 넘겨 받은 정보를 details에 저장</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">FacebookUserDetails</span> <span class="variable">userDetails</span> <span class="operator">=</span> mapper.convertValue(details, FacebookUserDetails.class); <span class="comment">// Object mapper를 이용해서 객체 변환</span></span><br><span class="line">        userDetails.setAccessToken(accessToken); <span class="comment">// access token 정보도 저장</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">UserConnection</span> <span class="variable">userConnection</span> <span class="operator">=</span> UserConnection.valueOf(userDetails); <span class="comment">// UserConnection를 userDetails 기반으로 생성</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authenticationToken</span> <span class="operator">=</span> socialService.doAuthentication(userConnection); <span class="comment">// SocialService를 이용해서 인증 절차 진행</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">super</span>.successfulAuthentication(request, response, chain, authenticationToken);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>OAuth2ClientAuthenticationProcessingFilter 클래스를 상속 받아서 구현한 클래스입니다. successfulAuthentication 메서드는 소셜 인증을 성공되면 호출되는 메서드입니다. 가장 중</p>
<p><code>restTemplate.getAccessToken()</code> 메서드를 통해서 해당 유저의 access token 정보를 가져옵니다.</p>
<p>인자로 넘겨받은 authResult 객체에 소셜에서 넘겨받은 정보를 details 객체에 넘겨받습니다. 이때 넘겨받은 정보를 ObejctMapper를 이용해서 FacebookUserDetails로 변환 합니다.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/cheese10yun/spring-security-oauth2-social/blob/master/doc/step-01.md#%EB%82%B4%EB%B6%80-%EC%BD%94%EB%93%9C">step-01: Google, Facebook 간단한 소셜 인증</a>에서 보셨듯 소셜에 넘겨주는 profile 객체는 LinkedHashMap의 형태입니다. 실제 런타임 전까지는 정확한 자료형을 확인하기가 어렵습니다. 그래서 FacebookUserDetails DTO 클래스 이용하는 것이 가독성 및 유지 보수하기 좋다고 생각합니다.</p>
<p>FacebookUserDetails 객체를 기반으로 UserConnection 객체를 만듭니다. UserConnection 객체는 아래에서 설명하겠습니다.</p>
<h3><span id="doauthentication-meseodeu">doAuthentication 메서드</span><a href="#doauthentication-meseodeu" class="header-anchor">#</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> UsernamePasswordAuthenticationToken <span class="title function_">doAuthentication</span><span class="params">(UserConnection userConnection)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (userService.isExistUser(userConnection)) &#123;</span><br><span class="line">        <span class="comment">// 기존 회원일 경우에는 데이터베이스에서 조회해서 인증 처리</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.findBySocial(userConnection);</span><br><span class="line">        <span class="keyword">return</span> setAuthenticationToken(user);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 새 회원일 경우 회원가입 이후 인증 처리</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.signUp(userConnection);</span><br><span class="line">        <span class="keyword">return</span> setAuthenticationToken(user);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Data JPA에 대한 설명은 하지 않겠습니다. 데이터베이스에서 회원 존재 유무를 확인 후 기존 회원일 경우는 바로 인증 회원 정보를 리턴합니다. 그렇지 않고 신규 회원일 경우에는 회원 가입을 진행 시킵니다. 이때 user_conncection, user 테이블에 두 곳 모두 저장시킵니다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: </span><br><span class="line">    insert </span><br><span class="line">    into</span><br><span class="line">        user_connection</span><br><span class="line">        (access_token, display_name, email, expire_time, image_url, profile_url, provider, provider_id, id) </span><br><span class="line">    values</span><br><span class="line">        (?, ?, ?, ?, ?, ?, ?, ?, ?)</span><br><span class="line"></span><br><span class="line">Hibernate: </span><br><span class="line">    insert </span><br><span class="line">    into</span><br><span class="line">        user</span><br><span class="line">        (email, nickname, provider_id, id) </span><br><span class="line">    values</span><br><span class="line">        (?, ?, ?, ?)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>신규 가입일 경우 쿼리입니다. user_connection, user 테이블에 각각 insert가 되는 것을 확인할 수 있습니다.</p>
<h2><span id="userconnection">UserConnection</span><a href="#userconnection" class="header-anchor">#</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table(name = &quot;user&quot;)</span></span><br><span class="line"><span class="meta">@NoArgsConstructor(access = AccessLevel.PROTECTED)</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue(strategy = GenerationType.AUTO)</span><span class="keyword">private</span> <span class="type">long</span> id;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToOne(cascade = CascadeType.PERSIST)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;provider_id&quot;, referencedColumnName = &quot;provider_id&quot;, nullable = false, updatable = false, unique = true)</span></span><br><span class="line">    <span class="keyword">private</span> UserConnection social;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Builder</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">User</span><span class="params">(String email, String nickname, UserConnection social)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">        <span class="built_in">this</span>.nickname = nickname;</span><br><span class="line">        <span class="built_in">this</span>.social = social;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> User <span class="title function_">signUp</span><span class="params">(UserConnection userConnection)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> User.builder()</span><br><span class="line">                .email(userConnection.getEmail())</span><br><span class="line">                .nickname(userConnection.getDisplayName())</span><br><span class="line">                .social(userConnection)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;user_connection&quot;)</span></span><br><span class="line"><span class="meta">@NoArgsConstructor(access = AccessLevel.PROTECTED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConnection</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue(strategy = GenerationType.AUTO)</span> <span class="keyword">private</span> <span class="type">long</span> id;</span><br><span class="line">    <span class="meta">@Column(name = &quot;email&quot;)</span> <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="meta">@Column(name = &quot;provider&quot;)</span> <span class="meta">@Enumerated(EnumType.STRING)</span> <span class="keyword">private</span> ProviderType provider;</span><br><span class="line">    <span class="meta">@Column(name = &quot;provider_id&quot;, unique = true, nullable = false)</span> <span class="keyword">private</span> String providerId;</span><br><span class="line">    <span class="meta">@Column(name = &quot;display_name&quot;)</span> <span class="keyword">private</span> String displayName;</span><br><span class="line">    <span class="meta">@Column(name = &quot;profile_url&quot;)</span> <span class="keyword">private</span> String profileUrl;</span><br><span class="line">    <span class="meta">@Column(name = &quot;image_url&quot;)</span> <span class="keyword">private</span> String imageUrl;</span><br><span class="line">    <span class="meta">@Column(name = &quot;access_token&quot;)</span> <span class="keyword">private</span> String accessToken;</span><br><span class="line">    <span class="meta">@Column(name = &quot;expire_time&quot;)</span> <span class="keyword">private</span> <span class="type">long</span> expireTime;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UserConnection <span class="title function_">valueOf</span><span class="params">(GoogleUserDetails userDetails)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> UserConnection.builder()</span><br><span class="line">                .expireTime(userDetails.getExpiration())</span><br><span class="line">                .accessToken(userDetails.getAccess_token())</span><br><span class="line">                .providerId(userDetails.getSub())</span><br><span class="line">                .email(userDetails.getEmail())</span><br><span class="line">                .displayName(userDetails.getName())</span><br><span class="line">                .imageUrl(userDetails.getPicture())</span><br><span class="line">                .provider(ProviderType.GOOGLE)</span><br><span class="line">                .profileUrl(userDetails.getProfile())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>코드는 길지만 말하고자 하는 것은 단순합니다. 지금 프로젝트에서는 소셜 가입 외에는 회원 인증 절차(회원가입)가 없다는 가정입니다. </p>
<p>그렇다는 것은 UserConnection 객체가 만들어지는 이유는 단 한 가지입니다. Google, Facebook를 통한 회원 인증일 경우입니다. UserConnection 위의 코드를 보시면 알겠지만 UserConnection 객체를 만들 수 있는 것은 방법은 <code>valueOf</code> 객체뿐입니다. (JPA 프록시객체 때문에 protected 생성자는 만들어야 합니다.)</p>
<p>이 처럼 객체의 생성도 명확한 근거 외에는 생성을 제한하는 좋은 구조라고 생각합니다. 또 User 객체도 마찬가지입니다. 소셜 회원 가입 이외에는 회원가입이 없으므로 User 객체는 UserConnection를 기반으로 만드는 방법 말고 제공하지 않는 것도 마찬가지입니다.</p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">태그</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/OAuth2/" rel="tag">OAuth2</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Spring/" rel="tag">Spring</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/oauth2/"
                    data-tooltip="OAuth2 인증 방식 정리"
                    aria-label="이전: OAuth2 인증 방식 정리"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/spring-social/"
                    data-tooltip="Spring Social Part 1 Google, Facebook 간단한 소셜 인증"
                    aria-label="다음: Spring Social Part 1 Google, Facebook 간단한 소셜 인증"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-social-02/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-social-02/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        

                
                    <!--  utteranc comment -->

<script src="https://utteranc.es/client.js"
        repo="cheese10yun/blog-comment"
        issue-term="title"
        label="Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                

            
        
    </div>
</article>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Yun. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/oauth2/"
                    data-tooltip="OAuth2 인증 방식 정리"
                    aria-label="이전: OAuth2 인증 방식 정리"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/spring-social/"
                    data-tooltip="Spring Social Part 1 Google, Facebook 간단한 소셜 인증"
                    aria-label="다음: Spring Social Part 1 Google, Facebook 간단한 소셜 인증"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-social-02/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-social-02/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-social-02/"
                        aria-label="Facebook에 공유하기"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Facebook에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-social-02/"
                        aria-label="Twitter에 공유하기"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Twitter에 공유하기</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
            <h4 id="about-card-name">Yun</h4>
        
            <div id="about-card-bio"><p>기술 블로그</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
